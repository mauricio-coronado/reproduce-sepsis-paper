{
  "cells": [
    {
      "cell_type": "markdown",
      "metadata": {
        "id": "view-in-github",
        "colab_type": "text"
      },
      "source": [
        "<a href=\"https://colab.research.google.com/github/mauricio-coronado/reproduce-sepsis-paper/blob/main/data-extraction\" target=\"_parent\"><img src=\"https://colab.research.google.com/assets/colab-badge.svg\" alt=\"Open In Colab\"/></a>"
      ]
    },
    {
      "cell_type": "markdown",
      "metadata": {
        "id": "YI3bzd4hGSFb"
      },
      "source": [
        "# Data extraction\n",
        "\n",
        "The goal of these exercises are to guide you through data extraction for a real clinical study in MIMIC.\n",
        "\n",
        "Requirements:\n",
        "\n",
        "* Access to the MIMIC datasets on BigQuery.\n",
        "    * You need a Google project which you can bill usage to. When you first create a Google account, you are given $300 credit which is more than enough.\n",
        "    * Pin the `physionet-data` project on the BigQuery page. [Pinning is described on the BigQuery Web UI documentation from Google](https://cloud.google.com/bigquery/docs/bigquery-web-ui).\n",
        "\n",
        "Our first few cells will be a bit of setup."
      ]
    },
    {
      "cell_type": "markdown",
      "source": [
        "## Setup\n",
        "\n",
        "We need to:\n",
        "\n",
        "1. Authenticate with Google.\n",
        "2. Import libraries.\n",
        "3. Set the `project-id` which will be used for billing query costs. Query costs for this tutorial are typically ~0.01 - 0.05 USD."
      ],
      "metadata": {
        "id": "izcgHUeNKdgT"
      }
    },
    {
      "cell_type": "markdown",
      "source": [
        "We need to authenticate this notebook with Google Cloud Platform (GCP) in order to query MIMIC on BigQuery. The above cell will allow this Colab notebook to access BigQuery and run queries on it using your account."
      ],
      "metadata": {
        "id": "k1FY5NEgErPn"
      }
    },
    {
      "cell_type": "code",
      "source": [
        "# Access data using Google BigQuery.\n",
        "from google.colab import auth\n",
        "from google.cloud import bigquery\n",
        "\n",
        "# the below variables are used throughout the notebook - do not change them!\n",
        "subject_ids = [10000032, 10001884, 10002223, 10002495, 10002443, 10003400, 10005866]\n",
        "id_str = ','.join([str(s) for s in subject_ids])\n",
        "\n",
        "# You only need to authenticate once per session.\n",
        "auth.authenticate_user()"
      ],
      "metadata": {
        "id": "tFh-ZXDHEUod"
      },
      "execution_count": 1,
      "outputs": []
    },
    {
      "cell_type": "code",
      "execution_count": null,
      "metadata": {
        "id": "m_s5R2dgGSFk",
        "colab": {
          "base_uri": "https://localhost:8080/",
          "height": 81
        },
        "outputId": "bce8e0b3-d1e1-41ce-8f44-d8994ca214ff"
      },
      "outputs": [
        {
          "output_type": "display_data",
          "data": {
            "text/plain": [
              "   subject_id gender  anchor_age  anchor_year anchor_year_group dod\n",
              "0    10012853      F          91         2175       2014 - 2016 NaT"
            ],
            "text/html": [
              "\n",
              "  <div id=\"df-14c2abd2-1559-49f8-b26f-aec4bee741a3\">\n",
              "    <div class=\"colab-df-container\">\n",
              "      <div>\n",
              "<style scoped>\n",
              "    .dataframe tbody tr th:only-of-type {\n",
              "        vertical-align: middle;\n",
              "    }\n",
              "\n",
              "    .dataframe tbody tr th {\n",
              "        vertical-align: top;\n",
              "    }\n",
              "\n",
              "    .dataframe thead th {\n",
              "        text-align: right;\n",
              "    }\n",
              "</style>\n",
              "<table border=\"1\" class=\"dataframe\">\n",
              "  <thead>\n",
              "    <tr style=\"text-align: right;\">\n",
              "      <th></th>\n",
              "      <th>subject_id</th>\n",
              "      <th>gender</th>\n",
              "      <th>anchor_age</th>\n",
              "      <th>anchor_year</th>\n",
              "      <th>anchor_year_group</th>\n",
              "      <th>dod</th>\n",
              "    </tr>\n",
              "  </thead>\n",
              "  <tbody>\n",
              "    <tr>\n",
              "      <th>0</th>\n",
              "      <td>10012853</td>\n",
              "      <td>F</td>\n",
              "      <td>91</td>\n",
              "      <td>2175</td>\n",
              "      <td>2014 - 2016</td>\n",
              "      <td>NaT</td>\n",
              "    </tr>\n",
              "  </tbody>\n",
              "</table>\n",
              "</div>\n",
              "      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-14c2abd2-1559-49f8-b26f-aec4bee741a3')\"\n",
              "              title=\"Convert this dataframe to an interactive table.\"\n",
              "              style=\"display:none;\">\n",
              "        \n",
              "  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n",
              "       width=\"24px\">\n",
              "    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n",
              "    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n",
              "  </svg>\n",
              "      </button>\n",
              "      \n",
              "  <style>\n",
              "    .colab-df-container {\n",
              "      display:flex;\n",
              "      flex-wrap:wrap;\n",
              "      gap: 12px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert {\n",
              "      background-color: #E8F0FE;\n",
              "      border: none;\n",
              "      border-radius: 50%;\n",
              "      cursor: pointer;\n",
              "      display: none;\n",
              "      fill: #1967D2;\n",
              "      height: 32px;\n",
              "      padding: 0 0 0 0;\n",
              "      width: 32px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert:hover {\n",
              "      background-color: #E2EBFA;\n",
              "      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n",
              "      fill: #174EA6;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert {\n",
              "      background-color: #3B4455;\n",
              "      fill: #D2E3FC;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert:hover {\n",
              "      background-color: #434B5C;\n",
              "      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n",
              "      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n",
              "      fill: #FFFFFF;\n",
              "    }\n",
              "  </style>\n",
              "\n",
              "      <script>\n",
              "        const buttonEl =\n",
              "          document.querySelector('#df-14c2abd2-1559-49f8-b26f-aec4bee741a3 button.colab-df-convert');\n",
              "        buttonEl.style.display =\n",
              "          google.colab.kernel.accessAllowed ? 'block' : 'none';\n",
              "\n",
              "        async function convertToInteractive(key) {\n",
              "          const element = document.querySelector('#df-14c2abd2-1559-49f8-b26f-aec4bee741a3');\n",
              "          const dataTable =\n",
              "            await google.colab.kernel.invokeFunction('convertToInteractive',\n",
              "                                                     [key], {});\n",
              "          if (!dataTable) return;\n",
              "\n",
              "          const docLinkHtml = 'Like what you see? Visit the ' +\n",
              "            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n",
              "            + ' to learn more about interactive tables.';\n",
              "          element.innerHTML = '';\n",
              "          dataTable['output_type'] = 'display_data';\n",
              "          await google.colab.output.renderOutput(dataTable, element);\n",
              "          const docLink = document.createElement('div');\n",
              "          docLink.innerHTML = docLinkHtml;\n",
              "          element.appendChild(docLink);\n",
              "        }\n",
              "      </script>\n",
              "    </div>\n",
              "  </div>\n",
              "  "
            ]
          },
          "metadata": {}
        }
      ],
      "source": [
        "# Import libraries\n",
        "from datetime import timedelta\n",
        "import os\n",
        "\n",
        "import numpy as np\n",
        "import pandas as pd\n",
        "import matplotlib.pyplot as plt\n",
        "\n",
        "# below imports are used for pretty pandas dataframes and plots\n",
        "from IPython.display import display, HTML\n",
        "%matplotlib inline\n",
        "plt.style.use('ggplot')\n",
        "\n",
        "# Set up environment variables\n",
        "project_id = 'kind-lab'\n",
        "os.environ[\"GOOGLE_CLOUD_PROJECT\"] = project_id\n",
        "\n",
        "# Read data from BigQuery into pandas dataframes.\n",
        "def run_query(query, project_id=project_id):\n",
        "    return pd.io.gbq.read_gbq(\n",
        "        query,\n",
        "        project_id=project_id,\n",
        "        dialect=\"standard\"\n",
        "    )\n",
        "\n",
        "if project_id == 'CHANGE-ME':\n",
        "  raise ValueError('You must change project_id to your GCP project at the top of this cell.')\n",
        "\n",
        "# test it works\n",
        "df = run_query(\"\"\"\n",
        "SELECT *\n",
        "FROM `physionet-data.mimic_core.patients`\n",
        "WHERE subject_id = 10012853\n",
        "\"\"\")\n",
        "assert df.shape[0] >= 1, 'unable to query MIMIC!'\n",
        "display(df)"
      ]
    },
    {
      "cell_type": "markdown",
      "source": [
        "If the above raises an error, you'll need to double check you've set your project correctly, and ensure that you have [requested access to MIMIC-IV on Google BigQuery via the PhysioNet project page](https://mimic-iv.mit.edu/docs/access/cloud/#accessing-mimic-iv-on-the-cloud)."
      ],
      "metadata": {
        "id": "mIrdJee-K9vA"
      }
    },
    {
      "cell_type": "markdown",
      "source": [
        "## Derived tables\n",
        "\n",
        "Derived tables have been created by the community to support research into MIMIC-IV. The source code for these tables is publicly available on the MIMIC-Code GitHub repository: https://github.com/MIT-LCP/mimic-code/tree/main/mimic-iv/concepts\n",
        "\n",
        "For example, vital signs are commonly measured for ICU patients, and recorded in *chartevents*. We can look at a subset of data for a set of `subject_id` defined by `subject_ids`."
      ],
      "metadata": {
        "id": "Z9Q71ajJGVZQ"
      }
    },
    {
      "cell_type": "code",
      "source": [
        "df = run_query(f'''\n",
        "SELECT ce.subject_id, ce.charttime, ce.itemid, di.label\n",
        ", ce.value, ce.valueuom\n",
        "FROM `physionet-data.mimic_icu.chartevents` ce\n",
        "INNER JOIN `physionet-data.mimic_icu.d_items` di\n",
        "    ON ce.itemid = di.itemid\n",
        "WHERE subject_id IN ({id_str})\n",
        "LIMIT 1000\n",
        "''')\n",
        "df = df.sort_values(['subject_id', 'charttime', 'label'])\n",
        "\n",
        "# display any row mentioning pressure\n",
        "idx = df['label'].str.contains('Pressure')\n",
        "display(df.loc[idx])"
      ],
      "metadata": {
        "id": "_rume4aOGt7M",
        "colab": {
          "base_uri": "https://localhost:8080/",
          "height": 424
        },
        "outputId": "f41e5cec-b305-4222-e66b-72dc5c53530b"
      },
      "execution_count": null,
      "outputs": [
        {
          "output_type": "display_data",
          "data": {
            "text/plain": [
              "     subject_id           charttime  itemid  \\\n",
              "1      10000032 2180-07-23 21:47:00  223752   \n",
              "120    10001884 2131-01-11 20:01:00  220181   \n",
              "76     10001884 2131-01-11 23:01:00  220179   \n",
              "113    10001884 2131-01-12 19:01:00  220181   \n",
              "87     10001884 2131-01-13 17:01:00  220180   \n",
              "..          ...                 ...     ...   \n",
              "945    10005866 2149-10-03 11:26:00  220235   \n",
              "186    10005866 2149-10-03 17:05:00  220051   \n",
              "179    10005866 2149-10-03 18:40:00  220050   \n",
              "180    10005866 2149-10-03 19:00:00  220050   \n",
              "182    10005866 2149-10-04 16:00:00  220050   \n",
              "\n",
              "                                       label value valueuom  \n",
              "1    Non-Invasive Blood Pressure Alarm - Low    85     mmHg  \n",
              "120         Non Invasive Blood Pressure mean   109     mmHg  \n",
              "76      Non Invasive Blood Pressure systolic   129     mmHg  \n",
              "113         Non Invasive Blood Pressure mean    94     mmHg  \n",
              "87     Non Invasive Blood Pressure diastolic    80     mmHg  \n",
              "..                                       ...   ...      ...  \n",
              "945                    Arterial CO2 Pressure    32     mmHg  \n",
              "186        Arterial Blood Pressure diastolic    63     mmHg  \n",
              "179         Arterial Blood Pressure systolic   105     mmHg  \n",
              "180         Arterial Blood Pressure systolic    94     mmHg  \n",
              "182         Arterial Blood Pressure systolic   115     mmHg  \n",
              "\n",
              "[90 rows x 6 columns]"
            ],
            "text/html": [
              "\n",
              "  <div id=\"df-afcd2b88-1f69-4282-a305-d3d748e1c346\">\n",
              "    <div class=\"colab-df-container\">\n",
              "      <div>\n",
              "<style scoped>\n",
              "    .dataframe tbody tr th:only-of-type {\n",
              "        vertical-align: middle;\n",
              "    }\n",
              "\n",
              "    .dataframe tbody tr th {\n",
              "        vertical-align: top;\n",
              "    }\n",
              "\n",
              "    .dataframe thead th {\n",
              "        text-align: right;\n",
              "    }\n",
              "</style>\n",
              "<table border=\"1\" class=\"dataframe\">\n",
              "  <thead>\n",
              "    <tr style=\"text-align: right;\">\n",
              "      <th></th>\n",
              "      <th>subject_id</th>\n",
              "      <th>charttime</th>\n",
              "      <th>itemid</th>\n",
              "      <th>label</th>\n",
              "      <th>value</th>\n",
              "      <th>valueuom</th>\n",
              "    </tr>\n",
              "  </thead>\n",
              "  <tbody>\n",
              "    <tr>\n",
              "      <th>1</th>\n",
              "      <td>10000032</td>\n",
              "      <td>2180-07-23 21:47:00</td>\n",
              "      <td>223752</td>\n",
              "      <td>Non-Invasive Blood Pressure Alarm - Low</td>\n",
              "      <td>85</td>\n",
              "      <td>mmHg</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>120</th>\n",
              "      <td>10001884</td>\n",
              "      <td>2131-01-11 20:01:00</td>\n",
              "      <td>220181</td>\n",
              "      <td>Non Invasive Blood Pressure mean</td>\n",
              "      <td>109</td>\n",
              "      <td>mmHg</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>76</th>\n",
              "      <td>10001884</td>\n",
              "      <td>2131-01-11 23:01:00</td>\n",
              "      <td>220179</td>\n",
              "      <td>Non Invasive Blood Pressure systolic</td>\n",
              "      <td>129</td>\n",
              "      <td>mmHg</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>113</th>\n",
              "      <td>10001884</td>\n",
              "      <td>2131-01-12 19:01:00</td>\n",
              "      <td>220181</td>\n",
              "      <td>Non Invasive Blood Pressure mean</td>\n",
              "      <td>94</td>\n",
              "      <td>mmHg</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>87</th>\n",
              "      <td>10001884</td>\n",
              "      <td>2131-01-13 17:01:00</td>\n",
              "      <td>220180</td>\n",
              "      <td>Non Invasive Blood Pressure diastolic</td>\n",
              "      <td>80</td>\n",
              "      <td>mmHg</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>...</th>\n",
              "      <td>...</td>\n",
              "      <td>...</td>\n",
              "      <td>...</td>\n",
              "      <td>...</td>\n",
              "      <td>...</td>\n",
              "      <td>...</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>945</th>\n",
              "      <td>10005866</td>\n",
              "      <td>2149-10-03 11:26:00</td>\n",
              "      <td>220235</td>\n",
              "      <td>Arterial CO2 Pressure</td>\n",
              "      <td>32</td>\n",
              "      <td>mmHg</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>186</th>\n",
              "      <td>10005866</td>\n",
              "      <td>2149-10-03 17:05:00</td>\n",
              "      <td>220051</td>\n",
              "      <td>Arterial Blood Pressure diastolic</td>\n",
              "      <td>63</td>\n",
              "      <td>mmHg</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>179</th>\n",
              "      <td>10005866</td>\n",
              "      <td>2149-10-03 18:40:00</td>\n",
              "      <td>220050</td>\n",
              "      <td>Arterial Blood Pressure systolic</td>\n",
              "      <td>105</td>\n",
              "      <td>mmHg</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>180</th>\n",
              "      <td>10005866</td>\n",
              "      <td>2149-10-03 19:00:00</td>\n",
              "      <td>220050</td>\n",
              "      <td>Arterial Blood Pressure systolic</td>\n",
              "      <td>94</td>\n",
              "      <td>mmHg</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>182</th>\n",
              "      <td>10005866</td>\n",
              "      <td>2149-10-04 16:00:00</td>\n",
              "      <td>220050</td>\n",
              "      <td>Arterial Blood Pressure systolic</td>\n",
              "      <td>115</td>\n",
              "      <td>mmHg</td>\n",
              "    </tr>\n",
              "  </tbody>\n",
              "</table>\n",
              "<p>90 rows Ã— 6 columns</p>\n",
              "</div>\n",
              "      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-afcd2b88-1f69-4282-a305-d3d748e1c346')\"\n",
              "              title=\"Convert this dataframe to an interactive table.\"\n",
              "              style=\"display:none;\">\n",
              "        \n",
              "  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n",
              "       width=\"24px\">\n",
              "    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n",
              "    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n",
              "  </svg>\n",
              "      </button>\n",
              "      \n",
              "  <style>\n",
              "    .colab-df-container {\n",
              "      display:flex;\n",
              "      flex-wrap:wrap;\n",
              "      gap: 12px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert {\n",
              "      background-color: #E8F0FE;\n",
              "      border: none;\n",
              "      border-radius: 50%;\n",
              "      cursor: pointer;\n",
              "      display: none;\n",
              "      fill: #1967D2;\n",
              "      height: 32px;\n",
              "      padding: 0 0 0 0;\n",
              "      width: 32px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert:hover {\n",
              "      background-color: #E2EBFA;\n",
              "      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n",
              "      fill: #174EA6;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert {\n",
              "      background-color: #3B4455;\n",
              "      fill: #D2E3FC;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert:hover {\n",
              "      background-color: #434B5C;\n",
              "      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n",
              "      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n",
              "      fill: #FFFFFF;\n",
              "    }\n",
              "  </style>\n",
              "\n",
              "      <script>\n",
              "        const buttonEl =\n",
              "          document.querySelector('#df-afcd2b88-1f69-4282-a305-d3d748e1c346 button.colab-df-convert');\n",
              "        buttonEl.style.display =\n",
              "          google.colab.kernel.accessAllowed ? 'block' : 'none';\n",
              "\n",
              "        async function convertToInteractive(key) {\n",
              "          const element = document.querySelector('#df-afcd2b88-1f69-4282-a305-d3d748e1c346');\n",
              "          const dataTable =\n",
              "            await google.colab.kernel.invokeFunction('convertToInteractive',\n",
              "                                                     [key], {});\n",
              "          if (!dataTable) return;\n",
              "\n",
              "          const docLinkHtml = 'Like what you see? Visit the ' +\n",
              "            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n",
              "            + ' to learn more about interactive tables.';\n",
              "          element.innerHTML = '';\n",
              "          dataTable['output_type'] = 'display_data';\n",
              "          await google.colab.output.renderOutput(dataTable, element);\n",
              "          const docLink = document.createElement('div');\n",
              "          docLink.innerHTML = docLinkHtml;\n",
              "          element.appendChild(docLink);\n",
              "        }\n",
              "      </script>\n",
              "    </div>\n",
              "  </div>\n",
              "  "
            ]
          },
          "metadata": {}
        }
      ]
    },
    {
      "cell_type": "markdown",
      "source": [
        "From the above, we again see the common entity-attribute-value model:\n",
        "\n",
        "- entity: `subject_id` + `charttime`\n",
        "- attribute: `Non Invasive Blood Pressure diastolic`\n",
        "- value: a number (e.g. 80, 63, etc)\n",
        "\n",
        "... and so on. We can extract columns for just the blood pressure by \"pivoting\" the data. Explicitly, this involves grouping by the entities, and aggregating over the values for specific entities.\n"
      ],
      "metadata": {
        "id": "mt6SZKxOHFGg"
      }
    },
    {
      "cell_type": "code",
      "source": [
        "df = run_query(f'''\n",
        "SELECT ce.subject_id, ce.charttime\n",
        ", MAX(CASE WHEN ce.itemid = 220179 THEN ce.valuenum ELSE NULL END) AS nibp_systolic\n",
        ", MAX(CASE WHEN ce.itemid = 220180 THEN ce.valuenum ELSE NULL END) AS nibp_diastolic\n",
        ", MAX(CASE WHEN ce.itemid = 220181 THEN ce.valuenum ELSE NULL END) AS nibp_mean\n",
        "FROM `physionet-data.mimic_icu.chartevents` ce\n",
        "WHERE subject_id IN ({id_str})\n",
        "GROUP BY subject_id, charttime\n",
        "''')\n",
        "df = df.sort_values(['subject_id', 'charttime'])\n",
        "display(df.head())"
      ],
      "metadata": {
        "id": "eDkquQFWGwTp",
        "colab": {
          "base_uri": "https://localhost:8080/",
          "height": 206
        },
        "outputId": "8689de9f-09fe-4bf9-dccd-6163157e0f94"
      },
      "execution_count": null,
      "outputs": [
        {
          "output_type": "display_data",
          "data": {
            "text/plain": [
              "      subject_id           charttime  nibp_systolic  nibp_diastolic  nibp_mean\n",
              "883     10000032 2180-07-23 12:36:00            NaN             NaN        NaN\n",
              "2054    10000032 2180-07-23 13:06:00            NaN             NaN        NaN\n",
              "227     10000032 2180-07-23 14:00:00            NaN             NaN        NaN\n",
              "4059    10000032 2180-07-23 14:11:00           84.0            48.0       56.0\n",
              "4046    10000032 2180-07-23 14:12:00            NaN             NaN        NaN"
            ],
            "text/html": [
              "\n",
              "  <div id=\"df-a541c6b2-63e4-4913-ad15-573a64a52bf7\">\n",
              "    <div class=\"colab-df-container\">\n",
              "      <div>\n",
              "<style scoped>\n",
              "    .dataframe tbody tr th:only-of-type {\n",
              "        vertical-align: middle;\n",
              "    }\n",
              "\n",
              "    .dataframe tbody tr th {\n",
              "        vertical-align: top;\n",
              "    }\n",
              "\n",
              "    .dataframe thead th {\n",
              "        text-align: right;\n",
              "    }\n",
              "</style>\n",
              "<table border=\"1\" class=\"dataframe\">\n",
              "  <thead>\n",
              "    <tr style=\"text-align: right;\">\n",
              "      <th></th>\n",
              "      <th>subject_id</th>\n",
              "      <th>charttime</th>\n",
              "      <th>nibp_systolic</th>\n",
              "      <th>nibp_diastolic</th>\n",
              "      <th>nibp_mean</th>\n",
              "    </tr>\n",
              "  </thead>\n",
              "  <tbody>\n",
              "    <tr>\n",
              "      <th>883</th>\n",
              "      <td>10000032</td>\n",
              "      <td>2180-07-23 12:36:00</td>\n",
              "      <td>NaN</td>\n",
              "      <td>NaN</td>\n",
              "      <td>NaN</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>2054</th>\n",
              "      <td>10000032</td>\n",
              "      <td>2180-07-23 13:06:00</td>\n",
              "      <td>NaN</td>\n",
              "      <td>NaN</td>\n",
              "      <td>NaN</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>227</th>\n",
              "      <td>10000032</td>\n",
              "      <td>2180-07-23 14:00:00</td>\n",
              "      <td>NaN</td>\n",
              "      <td>NaN</td>\n",
              "      <td>NaN</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>4059</th>\n",
              "      <td>10000032</td>\n",
              "      <td>2180-07-23 14:11:00</td>\n",
              "      <td>84.0</td>\n",
              "      <td>48.0</td>\n",
              "      <td>56.0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>4046</th>\n",
              "      <td>10000032</td>\n",
              "      <td>2180-07-23 14:12:00</td>\n",
              "      <td>NaN</td>\n",
              "      <td>NaN</td>\n",
              "      <td>NaN</td>\n",
              "    </tr>\n",
              "  </tbody>\n",
              "</table>\n",
              "</div>\n",
              "      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-a541c6b2-63e4-4913-ad15-573a64a52bf7')\"\n",
              "              title=\"Convert this dataframe to an interactive table.\"\n",
              "              style=\"display:none;\">\n",
              "        \n",
              "  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n",
              "       width=\"24px\">\n",
              "    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n",
              "    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n",
              "  </svg>\n",
              "      </button>\n",
              "      \n",
              "  <style>\n",
              "    .colab-df-container {\n",
              "      display:flex;\n",
              "      flex-wrap:wrap;\n",
              "      gap: 12px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert {\n",
              "      background-color: #E8F0FE;\n",
              "      border: none;\n",
              "      border-radius: 50%;\n",
              "      cursor: pointer;\n",
              "      display: none;\n",
              "      fill: #1967D2;\n",
              "      height: 32px;\n",
              "      padding: 0 0 0 0;\n",
              "      width: 32px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert:hover {\n",
              "      background-color: #E2EBFA;\n",
              "      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n",
              "      fill: #174EA6;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert {\n",
              "      background-color: #3B4455;\n",
              "      fill: #D2E3FC;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert:hover {\n",
              "      background-color: #434B5C;\n",
              "      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n",
              "      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n",
              "      fill: #FFFFFF;\n",
              "    }\n",
              "  </style>\n",
              "\n",
              "      <script>\n",
              "        const buttonEl =\n",
              "          document.querySelector('#df-a541c6b2-63e4-4913-ad15-573a64a52bf7 button.colab-df-convert');\n",
              "        buttonEl.style.display =\n",
              "          google.colab.kernel.accessAllowed ? 'block' : 'none';\n",
              "\n",
              "        async function convertToInteractive(key) {\n",
              "          const element = document.querySelector('#df-a541c6b2-63e4-4913-ad15-573a64a52bf7');\n",
              "          const dataTable =\n",
              "            await google.colab.kernel.invokeFunction('convertToInteractive',\n",
              "                                                     [key], {});\n",
              "          if (!dataTable) return;\n",
              "\n",
              "          const docLinkHtml = 'Like what you see? Visit the ' +\n",
              "            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n",
              "            + ' to learn more about interactive tables.';\n",
              "          element.innerHTML = '';\n",
              "          dataTable['output_type'] = 'display_data';\n",
              "          await google.colab.output.renderOutput(dataTable, element);\n",
              "          const docLink = document.createElement('div');\n",
              "          docLink.innerHTML = docLinkHtml;\n",
              "          element.appendChild(docLink);\n",
              "        }\n",
              "      </script>\n",
              "    </div>\n",
              "  </div>\n",
              "  "
            ]
          },
          "metadata": {}
        }
      ]
    },
    {
      "cell_type": "markdown",
      "source": [
        "Not every row has a blood pressure - we could add in a filter to those rows using `itemid` if we chose.\n",
        "\n",
        "Finding data like this is necessary, but it can be hard! Luckily, a lot of it has already been done. If we look at the vitalsign query in the measurement folder of mimic-code: https://github.com/MIT-LCP/mimic-code/blob/main/mimic-iv/concepts/measurement/vitalsign.sql\n",
        "\n",
        "```sql\n",
        "-- This query pivots the vital signs for the entire patient stay.\n",
        "-- Vital signs include heart rate, blood pressure, respiration rate, and temperature\n",
        "select\n",
        "    ce.subject_id\n",
        "  , ce.stay_id\n",
        "  , ce.charttime\n",
        "  , AVG(case when itemid in (220045) and valuenum > 0 and valuenum < 300 then valuenum else null end) as heart_rate\n",
        "  , AVG(case when itemid in (220179,220050) and valuenum > 0 and valuenum < 400 then valuenum else null end) as sbp\n",
        "  , AVG(case when itemid in (220180,220051) and valuenum > 0 and valuenum < 300 then valuenum else null end) as dbp\n",
        "  , AVG(case when itemid in (220052,220181,225312) and valuenum > 0 and valuenum < 300 then valuenum else null end) as mbp\n",
        "  , AVG(case when itemid = 220179 and valuenum > 0 and valuenum < 400 then valuenum else null end) as sbp_ni\n",
        "  , AVG(case when itemid = 220180 and valuenum > 0 and valuenum < 300 then valuenum else null end) as dbp_ni\n",
        "  , AVG(case when itemid = 220181 and valuenum > 0 and valuenum < 300 then valuenum else null end) as mbp_ni\n",
        "  , AVG(case when itemid in (220210,224690) and valuenum > 0 and valuenum < 70 then valuenum else null end) as resp_rate\n",
        "  , ROUND(\n",
        "      AVG(case when itemid in (223761) and valuenum > 70 and valuenum < 120 then (valuenum-32)/1.8 -- converted to degC in valuenum call\n",
        "              when itemid in (223762) and valuenum > 10 and valuenum < 50  then valuenum else null end)\n",
        "    , 2) as temperature\n",
        "  , MAX(CASE WHEN itemid = 224642 THEN value ELSE NULL END) AS temperature_site\n",
        "  , AVG(case when itemid in (220277) and valuenum > 0 and valuenum <= 100 then valuenum else null end) as spo2\n",
        "  , AVG(case when itemid in (225664,220621,226537) and valuenum > 0 then valuenum else null end) as glucose\n",
        "  FROM mimic_icu.chartevents ce\n",
        "  where ce.stay_id IS NOT NULL\n",
        "  and ce.itemid in\n",
        "  (\n",
        "    220045, -- Heart Rate\n",
        "    225309, -- ART BP Systolic\n",
        "    225310, -- ART BP Diastolic\n",
        "    225312, -- ART BP Mean\n",
        "    220050, -- Arterial Blood Pressure systolic\n",
        "    220051, -- Arterial Blood Pressure diastolic\n",
        "    220052, -- Arterial Blood Pressure mean\n",
        "    220179, -- Non Invasive Blood Pressure systolic\n",
        "    220180, -- Non Invasive Blood Pressure diastolic\n",
        "    220181, -- Non Invasive Blood Pressure mean\n",
        "    220210, -- Respiratory Rate\n",
        "    224690, -- Respiratory Rate (Total)\n",
        "    220277, -- SPO2, peripheral\n",
        "    -- GLUCOSE, both lab and fingerstick\n",
        "    225664, -- Glucose finger stick\n",
        "    220621, -- Glucose (serum)\n",
        "    226537, -- Glucose (whole blood)\n",
        "    -- TEMPERATURE\n",
        "    223762, -- \"Temperature Celsius\"\n",
        "    223761,  -- \"Temperature Fahrenheit\"\n",
        "    224642 -- Temperature Site\n",
        "    -- 226329 -- Blood Temperature CCO (C)\n",
        ")\n",
        "group by ce.subject_id, ce.stay_id, ce.charttime\n",
        ";\n",
        "```"
      ],
      "metadata": {
        "id": "CTVC58f_H4uW"
      }
    },
    {
      "cell_type": "markdown",
      "source": [
        "The above already has all the `itemid` pivoted for vital signs. We can run this code if we want and we'll get the pivoted vital signs. For convenience, there is already a BigQuery dataset called `mimic_derived` which already stores the output of every concept in the repo. The table names are matched to the file names, so the output of the `vitalsign.sql` query can be found in `physionet-data.mimic_derived.vitalsign`, and we can query it directly."
      ],
      "metadata": {
        "id": "kvn1ImawILGI"
      }
    },
    {
      "cell_type": "code",
      "source": [
        "df = run_query(f'''\n",
        "SELECT tbl.*\n",
        "FROM `physionet-data.mimic_derived.vitalsign` tbl\n",
        "WHERE subject_id IN ({id_str})\n",
        "''')\n",
        "df = df.sort_values(['charttime'])\n",
        "display(df.head())"
      ],
      "metadata": {
        "id": "5kMR9G_9IIkL",
        "colab": {
          "base_uri": "https://localhost:8080/",
          "height": 206
        },
        "outputId": "1ff8902d-0583-47be-98ab-e862b17644a7"
      },
      "execution_count": null,
      "outputs": [
        {
          "output_type": "display_data",
          "data": {
            "text/plain": [
              "      subject_id   stay_id           charttime  heart_rate    sbp   dbp   mbp  \\\n",
              "1043    10001884  37510196 2131-01-11 04:00:00         NaN    NaN   NaN   NaN   \n",
              "2108    10001884  37510196 2131-01-11 04:20:00         NaN    NaN   NaN   NaN   \n",
              "83      10001884  37510196 2131-01-11 04:22:00        38.0    NaN   NaN   NaN   \n",
              "58      10001884  37510196 2131-01-11 04:25:00         NaN  180.0  12.0  46.0   \n",
              "673     10001884  37510196 2131-01-11 05:00:00        60.0    NaN   NaN   NaN   \n",
              "\n",
              "      sbp_ni  dbp_ni  mbp_ni  resp_rate  temperature temperature_site   spo2  \\\n",
              "1043     NaN     NaN     NaN       20.0          NaN             None    NaN   \n",
              "2108     NaN     NaN     NaN       16.0          NaN             None  100.0   \n",
              "83       NaN     NaN     NaN        NaN          NaN             None    NaN   \n",
              "58     180.0    12.0    46.0        NaN          NaN             None    NaN   \n",
              "673      NaN     NaN     NaN       10.0          NaN             None   98.0   \n",
              "\n",
              "      glucose  \n",
              "1043      NaN  \n",
              "2108      NaN  \n",
              "83        NaN  \n",
              "58        NaN  \n",
              "673       NaN  "
            ],
            "text/html": [
              "\n",
              "  <div id=\"df-44ccc83a-e5a0-4fd1-bb7e-8db7bca355e5\">\n",
              "    <div class=\"colab-df-container\">\n",
              "      <div>\n",
              "<style scoped>\n",
              "    .dataframe tbody tr th:only-of-type {\n",
              "        vertical-align: middle;\n",
              "    }\n",
              "\n",
              "    .dataframe tbody tr th {\n",
              "        vertical-align: top;\n",
              "    }\n",
              "\n",
              "    .dataframe thead th {\n",
              "        text-align: right;\n",
              "    }\n",
              "</style>\n",
              "<table border=\"1\" class=\"dataframe\">\n",
              "  <thead>\n",
              "    <tr style=\"text-align: right;\">\n",
              "      <th></th>\n",
              "      <th>subject_id</th>\n",
              "      <th>stay_id</th>\n",
              "      <th>charttime</th>\n",
              "      <th>heart_rate</th>\n",
              "      <th>sbp</th>\n",
              "      <th>dbp</th>\n",
              "      <th>mbp</th>\n",
              "      <th>sbp_ni</th>\n",
              "      <th>dbp_ni</th>\n",
              "      <th>mbp_ni</th>\n",
              "      <th>resp_rate</th>\n",
              "      <th>temperature</th>\n",
              "      <th>temperature_site</th>\n",
              "      <th>spo2</th>\n",
              "      <th>glucose</th>\n",
              "    </tr>\n",
              "  </thead>\n",
              "  <tbody>\n",
              "    <tr>\n",
              "      <th>1043</th>\n",
              "      <td>10001884</td>\n",
              "      <td>37510196</td>\n",
              "      <td>2131-01-11 04:00:00</td>\n",
              "      <td>NaN</td>\n",
              "      <td>NaN</td>\n",
              "      <td>NaN</td>\n",
              "      <td>NaN</td>\n",
              "      <td>NaN</td>\n",
              "      <td>NaN</td>\n",
              "      <td>NaN</td>\n",
              "      <td>20.0</td>\n",
              "      <td>NaN</td>\n",
              "      <td>None</td>\n",
              "      <td>NaN</td>\n",
              "      <td>NaN</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>2108</th>\n",
              "      <td>10001884</td>\n",
              "      <td>37510196</td>\n",
              "      <td>2131-01-11 04:20:00</td>\n",
              "      <td>NaN</td>\n",
              "      <td>NaN</td>\n",
              "      <td>NaN</td>\n",
              "      <td>NaN</td>\n",
              "      <td>NaN</td>\n",
              "      <td>NaN</td>\n",
              "      <td>NaN</td>\n",
              "      <td>16.0</td>\n",
              "      <td>NaN</td>\n",
              "      <td>None</td>\n",
              "      <td>100.0</td>\n",
              "      <td>NaN</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>83</th>\n",
              "      <td>10001884</td>\n",
              "      <td>37510196</td>\n",
              "      <td>2131-01-11 04:22:00</td>\n",
              "      <td>38.0</td>\n",
              "      <td>NaN</td>\n",
              "      <td>NaN</td>\n",
              "      <td>NaN</td>\n",
              "      <td>NaN</td>\n",
              "      <td>NaN</td>\n",
              "      <td>NaN</td>\n",
              "      <td>NaN</td>\n",
              "      <td>NaN</td>\n",
              "      <td>None</td>\n",
              "      <td>NaN</td>\n",
              "      <td>NaN</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>58</th>\n",
              "      <td>10001884</td>\n",
              "      <td>37510196</td>\n",
              "      <td>2131-01-11 04:25:00</td>\n",
              "      <td>NaN</td>\n",
              "      <td>180.0</td>\n",
              "      <td>12.0</td>\n",
              "      <td>46.0</td>\n",
              "      <td>180.0</td>\n",
              "      <td>12.0</td>\n",
              "      <td>46.0</td>\n",
              "      <td>NaN</td>\n",
              "      <td>NaN</td>\n",
              "      <td>None</td>\n",
              "      <td>NaN</td>\n",
              "      <td>NaN</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>673</th>\n",
              "      <td>10001884</td>\n",
              "      <td>37510196</td>\n",
              "      <td>2131-01-11 05:00:00</td>\n",
              "      <td>60.0</td>\n",
              "      <td>NaN</td>\n",
              "      <td>NaN</td>\n",
              "      <td>NaN</td>\n",
              "      <td>NaN</td>\n",
              "      <td>NaN</td>\n",
              "      <td>NaN</td>\n",
              "      <td>10.0</td>\n",
              "      <td>NaN</td>\n",
              "      <td>None</td>\n",
              "      <td>98.0</td>\n",
              "      <td>NaN</td>\n",
              "    </tr>\n",
              "  </tbody>\n",
              "</table>\n",
              "</div>\n",
              "      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-44ccc83a-e5a0-4fd1-bb7e-8db7bca355e5')\"\n",
              "              title=\"Convert this dataframe to an interactive table.\"\n",
              "              style=\"display:none;\">\n",
              "        \n",
              "  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n",
              "       width=\"24px\">\n",
              "    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n",
              "    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n",
              "  </svg>\n",
              "      </button>\n",
              "      \n",
              "  <style>\n",
              "    .colab-df-container {\n",
              "      display:flex;\n",
              "      flex-wrap:wrap;\n",
              "      gap: 12px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert {\n",
              "      background-color: #E8F0FE;\n",
              "      border: none;\n",
              "      border-radius: 50%;\n",
              "      cursor: pointer;\n",
              "      display: none;\n",
              "      fill: #1967D2;\n",
              "      height: 32px;\n",
              "      padding: 0 0 0 0;\n",
              "      width: 32px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert:hover {\n",
              "      background-color: #E2EBFA;\n",
              "      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n",
              "      fill: #174EA6;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert {\n",
              "      background-color: #3B4455;\n",
              "      fill: #D2E3FC;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert:hover {\n",
              "      background-color: #434B5C;\n",
              "      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n",
              "      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n",
              "      fill: #FFFFFF;\n",
              "    }\n",
              "  </style>\n",
              "\n",
              "      <script>\n",
              "        const buttonEl =\n",
              "          document.querySelector('#df-44ccc83a-e5a0-4fd1-bb7e-8db7bca355e5 button.colab-df-convert');\n",
              "        buttonEl.style.display =\n",
              "          google.colab.kernel.accessAllowed ? 'block' : 'none';\n",
              "\n",
              "        async function convertToInteractive(key) {\n",
              "          const element = document.querySelector('#df-44ccc83a-e5a0-4fd1-bb7e-8db7bca355e5');\n",
              "          const dataTable =\n",
              "            await google.colab.kernel.invokeFunction('convertToInteractive',\n",
              "                                                     [key], {});\n",
              "          if (!dataTable) return;\n",
              "\n",
              "          const docLinkHtml = 'Like what you see? Visit the ' +\n",
              "            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n",
              "            + ' to learn more about interactive tables.';\n",
              "          element.innerHTML = '';\n",
              "          dataTable['output_type'] = 'display_data';\n",
              "          await google.colab.output.renderOutput(dataTable, element);\n",
              "          const docLink = document.createElement('div');\n",
              "          docLink.innerHTML = docLinkHtml;\n",
              "          element.appendChild(docLink);\n",
              "        }\n",
              "      </script>\n",
              "    </div>\n",
              "  </div>\n",
              "  "
            ]
          },
          "metadata": {}
        }
      ]
    },
    {
      "cell_type": "markdown",
      "source": [
        "You can verify the values above are the same as the ones we originally looked at directly from the `chartevents`.\n",
        "\n",
        "Using derived views will make extracting data much faster - so keep an eye out for them! Just be aware that these concepts are written by the community, so (1) as always, there may be more data cleaning necessary, and (2) they may not perfectly match your study requirements."
      ],
      "metadata": {
        "id": "8D-hPP5OIufe"
      }
    },
    {
      "cell_type": "markdown",
      "source": [
        "## Exercise questions\n",
        "\n",
        "We are going to study atrial fibrillation - a heart arrhythmia in which the atria cease to contract normally during the cardiac cycle.\n",
        "\n",
        "![Atrial fibrillation.jpeg](data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEASABIAAD/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wAARCAJsAwUDASIAAhEBAxEB/8QAHAABAAEFAQEAAAAAAAAAAAAAAAMCBAUGBwEI/8QAXRAAAQMCAQgIAQoCBgUIBwcFAQACAwQRBQYSEyExQVFhBxQiIzJCUnGBCCQzQ2KRobHB0RVyU4KSorLhFjREc8IXJTU4s9Lw8RgmN1RjdZQnNkWDk6PDVmR0hNP/xAAbAQEAAwEBAQEAAAAAAAAAAAAAAQMEAgUGB//EAD8RAAIBAgQCCAUDAwIFBAMAAAABAgMRBBIhMUFRBRNhcZGxwdEiMoGh8BQj4TNCUgZTFSRicvE0Q7LCgpLi/9oADAMBAAIRAxEAPwD6pREQBERAEREAREQBERAEREAREQBERAEREAREQBERAEREAREQBERAEREAREQBERAEREAREQBERAEREAREQBERAEREAREQBERAEREAREQBERAEREAREQBERAEREAREQBERAEREAREQBERAEREAREQBERAEREAREQBERAEREAREQBERAEREAREQBERAEREAREQBERAEREAREQBERAEREAREQBERAEREAREQBERAEREAREQBERAEREAREQBERAEREAREQBERAEREAREQBERAEREAREQBERAEREAREQBERAEREAREQBERAEREAREQBERAEREAREQBERAEREAREQBERAEREAREQBERAEREAREQBERAEREAREQBERAEREAREQBERAEREBisfyjwXJ2OGTHsVocNjmcWxuq52xB5GsgXOtZRjmvYHMIc1wuCDcEL56+VzQx4o7ILD53ujiq8VNO97drQ/MaSPa6zPydcraxgxLo9yofbKHJ1xhjLjrnpmmzSOObdvu0tPFAdcnx3CqfG6fB58RpI8VqGGSGjdK0SyNF7uazaR2Xa+RWRXBMsv+t3kP8A/KZP8NSur5c5bYBkNhTa/KWvZSRPdmxMsXySu4NaNZ57hvsgNkRcmwrp8yMrMSpqKuOKYO6pIEMu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)\n",
        "\n"
      ],
      "metadata": {
        "id": "D-NV5WM3FqLI"
      }
    },
    {
      "cell_type": "markdown",
      "source": [
        "Atrial fibrillation is a common condition in the ICU, but management of it is still an open research question. We will work through exercises to prepare a cohort and extract data for an atrial fibrillation study. In all exercises, you may do everything in one query or break it up into multiple queries, depending on complexity."
      ],
      "metadata": {
        "id": "ZD9q8RLVP7RC"
      }
    },
    {
      "cell_type": "markdown",
      "source": [
        "### Beginning cohort\n",
        "\n",
        "To give you a leg up, we'll define the first criteria: age >= 16. Happily, there is a [derived table for age](https://github.com/MIT-LCP/mimic-code/blob/main/mimic-iv/concepts/demographics/age.sql)!"
      ],
      "metadata": {
        "id": "udXFpV1vRSL4"
      }
    },
    {
      "cell_type": "code",
      "source": [
        "df = run_query(f'''\n",
        "SELECT ie.subject_id, ie.hadm_id, ie.stay_id\n",
        ", CASE WHEN age.anchor_age >= 16 THEN 0 ELSE 1 END AS exclude_non_adult\n",
        "FROM `physionet-data.mimic_icu.icustays` ie\n",
        "INNER JOIN `physionet-data.mimic_derived.age` age\n",
        "    ON ie.hadm_id = age.hadm_id\n",
        "WHERE ie.subject_id IN ({id_str})\n",
        "''')\n",
        "display(df)"
      ],
      "metadata": {
        "id": "ax7IMLA_P5Bj",
        "colab": {
          "base_uri": "https://localhost:8080/",
          "height": 332
        },
        "outputId": "98e882fd-93d7-4670-fe76-51fb1ebac8c3"
      },
      "execution_count": null,
      "outputs": [
        {
          "output_type": "display_data",
          "data": {
            "text/plain": [
              "   subject_id   hadm_id   stay_id  exclude_non_adult\n",
              "0    10002223  22494570  39638202                  0\n",
              "1    10002495  24982426  36753294                  0\n",
              "2    10002443  21329021  35044219                  0\n",
              "3    10003400  23559586  38383343                  0\n",
              "4    10001884  26184834  37510196                  0\n",
              "5    10000032  29079034  39553978                  0\n",
              "6    10005866  20364112  34170353                  0\n",
              "7    10003400  20214994  32128372                  0\n",
              "8    10003400  23559586  34577403                  0"
            ],
            "text/html": [
              "\n",
              "  <div id=\"df-6c9d8cc2-f360-427a-9665-293eba428806\">\n",
              "    <div class=\"colab-df-container\">\n",
              "      <div>\n",
              "<style scoped>\n",
              "    .dataframe tbody tr th:only-of-type {\n",
              "        vertical-align: middle;\n",
              "    }\n",
              "\n",
              "    .dataframe tbody tr th {\n",
              "        vertical-align: top;\n",
              "    }\n",
              "\n",
              "    .dataframe thead th {\n",
              "        text-align: right;\n",
              "    }\n",
              "</style>\n",
              "<table border=\"1\" class=\"dataframe\">\n",
              "  <thead>\n",
              "    <tr style=\"text-align: right;\">\n",
              "      <th></th>\n",
              "      <th>subject_id</th>\n",
              "      <th>hadm_id</th>\n",
              "      <th>stay_id</th>\n",
              "      <th>exclude_non_adult</th>\n",
              "    </tr>\n",
              "  </thead>\n",
              "  <tbody>\n",
              "    <tr>\n",
              "      <th>0</th>\n",
              "      <td>10002223</td>\n",
              "      <td>22494570</td>\n",
              "      <td>39638202</td>\n",
              "      <td>0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>1</th>\n",
              "      <td>10002495</td>\n",
              "      <td>24982426</td>\n",
              "      <td>36753294</td>\n",
              "      <td>0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>2</th>\n",
              "      <td>10002443</td>\n",
              "      <td>21329021</td>\n",
              "      <td>35044219</td>\n",
              "      <td>0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>3</th>\n",
              "      <td>10003400</td>\n",
              "      <td>23559586</td>\n",
              "      <td>38383343</td>\n",
              "      <td>0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>4</th>\n",
              "      <td>10001884</td>\n",
              "      <td>26184834</td>\n",
              "      <td>37510196</td>\n",
              "      <td>0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>5</th>\n",
              "      <td>10000032</td>\n",
              "      <td>29079034</td>\n",
              "      <td>39553978</td>\n",
              "      <td>0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>6</th>\n",
              "      <td>10005866</td>\n",
              "      <td>20364112</td>\n",
              "      <td>34170353</td>\n",
              "      <td>0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>7</th>\n",
              "      <td>10003400</td>\n",
              "      <td>20214994</td>\n",
              "      <td>32128372</td>\n",
              "      <td>0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>8</th>\n",
              "      <td>10003400</td>\n",
              "      <td>23559586</td>\n",
              "      <td>34577403</td>\n",
              "      <td>0</td>\n",
              "    </tr>\n",
              "  </tbody>\n",
              "</table>\n",
              "</div>\n",
              "      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-6c9d8cc2-f360-427a-9665-293eba428806')\"\n",
              "              title=\"Convert this dataframe to an interactive table.\"\n",
              "              style=\"display:none;\">\n",
              "        \n",
              "  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n",
              "       width=\"24px\">\n",
              "    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n",
              "    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n",
              "  </svg>\n",
              "      </button>\n",
              "      \n",
              "  <style>\n",
              "    .colab-df-container {\n",
              "      display:flex;\n",
              "      flex-wrap:wrap;\n",
              "      gap: 12px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert {\n",
              "      background-color: #E8F0FE;\n",
              "      border: none;\n",
              "      border-radius: 50%;\n",
              "      cursor: pointer;\n",
              "      display: none;\n",
              "      fill: #1967D2;\n",
              "      height: 32px;\n",
              "      padding: 0 0 0 0;\n",
              "      width: 32px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert:hover {\n",
              "      background-color: #E2EBFA;\n",
              "      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n",
              "      fill: #174EA6;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert {\n",
              "      background-color: #3B4455;\n",
              "      fill: #D2E3FC;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert:hover {\n",
              "      background-color: #434B5C;\n",
              "      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n",
              "      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n",
              "      fill: #FFFFFF;\n",
              "    }\n",
              "  </style>\n",
              "\n",
              "      <script>\n",
              "        const buttonEl =\n",
              "          document.querySelector('#df-6c9d8cc2-f360-427a-9665-293eba428806 button.colab-df-convert');\n",
              "        buttonEl.style.display =\n",
              "          google.colab.kernel.accessAllowed ? 'block' : 'none';\n",
              "\n",
              "        async function convertToInteractive(key) {\n",
              "          const element = document.querySelector('#df-6c9d8cc2-f360-427a-9665-293eba428806');\n",
              "          const dataTable =\n",
              "            await google.colab.kernel.invokeFunction('convertToInteractive',\n",
              "                                                     [key], {});\n",
              "          if (!dataTable) return;\n",
              "\n",
              "          const docLinkHtml = 'Like what you see? Visit the ' +\n",
              "            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n",
              "            + ' to learn more about interactive tables.';\n",
              "          element.innerHTML = '';\n",
              "          dataTable['output_type'] = 'display_data';\n",
              "          await google.colab.output.renderOutput(dataTable, element);\n",
              "          const docLink = document.createElement('div');\n",
              "          docLink.innerHTML = docLinkHtml;\n",
              "          element.appendChild(docLink);\n",
              "        }\n",
              "      </script>\n",
              "    </div>\n",
              "  </div>\n",
              "  "
            ]
          },
          "metadata": {}
        }
      ]
    },
    {
      "cell_type": "markdown",
      "source": [
        "### Cohort\n",
        "\n",
        "Question 1: Copy the above query into the code cell below. Add the following exclusions:\n",
        "\n",
        "- ICU readmission, i.e., exclude all `stay_id` for a given `subject_id` *except* the one which occurred first, temporally.\n",
        "- Exclude stays with an ICU length of stay <= 4 hours.\n",
        "- Exclude stays whose admission source was another hospital.\n",
        "\n",
        "The result should be a single dataframe with the `subject_id`, `hadm_id`, `stay_id`, and the exclusion columns. Create a single column for each exclusion criteria prefixed with `exclude_`. The exclusion columns should only contain 0s or 1s."
      ],
      "metadata": {
        "id": "913Z5BDKSBMl"
      }
    },
    {
      "cell_type": "code",
      "source": [
        "df = run_query(f'''\n",
        "SELECT ie.subject_id, ie.hadm_id, ie.stay_id\n",
        ", CASE WHEN age.anchor_age >= 16 THEN 0 ELSE 1 END AS exclude_non_adult\n",
        ", CASE WHEN ie.LOS > 4/24 THEN 0 ELSE 1 END AS exclude_short_stays\n",
        ", CASE WHEN ROW_NUMBER() OVER (PARTITION BY ie.subject_id ORDER BY ie.intime) = 1 THEN 0 ELSE 1 END AS exclude_readmission\n",
        ", CASE WHEN cd.admission_location = \"TRANSFER FROM HOSPITAL\" THEN 1 ELSE 0 END as exclude_other_hospitals\n",
        "FROM `physionet-data.mimic_icu.icustays` ie\n",
        "INNER JOIN `physionet-data.mimic_derived.age` age\n",
        "    ON ie.hadm_id = age.hadm_id\n",
        "LEFT JOIN `physionet-data.mimic_core.admissions`  cd\n",
        "    ON ie.hadm_id = cd.hadm_id\n",
        "WHERE ie.subject_id IN ({id_str})\n",
        "''')\n",
        "# note \"inplace\" -> this argument tells the dataframe to be modified in-place\n",
        "# i.e., we don't need to do df = df.sort_values(), we can just call the function as-is\n",
        "# be careful with inplace! if you do:\n",
        "#   df = df.sort_values(inplace=True), it will set `df` to None\n",
        "# ... because you're using it wrong (either re-assign the variable, or use the inplace arg, but not both!)\n",
        "df.sort_values('subject_id', inplace=True)\n",
        "display(df)"
      ],
      "metadata": {
        "id": "3Ay9BUp8LD2K",
        "colab": {
          "base_uri": "https://localhost:8080/",
          "height": 332
        },
        "outputId": "8ab53dc5-c07a-429e-9915-df4cec5f1cc8"
      },
      "execution_count": null,
      "outputs": [
        {
          "output_type": "display_data",
          "data": {
            "text/plain": [
              "   subject_id   hadm_id   stay_id  exclude_non_adult  exclude_short_stays  \\\n",
              "6    10000032  29079034  39553978                  0                    0   \n",
              "8    10001884  26184834  37510196                  0                    0   \n",
              "5    10002223  22494570  39638202                  0                    0   \n",
              "3    10002443  21329021  35044219                  0                    0   \n",
              "7    10002495  24982426  36753294                  0                    0   \n",
              "0    10003400  20214994  32128372                  0                    0   \n",
              "1    10003400  23559586  34577403                  0                    0   \n",
              "2    10003400  23559586  38383343                  0                    0   \n",
              "4    10005866  20364112  34170353                  0                    0   \n",
              "\n",
              "   exclude_readmission  exclude_other_hospitals  \n",
              "6                    0                        0  \n",
              "8                    0                        0  \n",
              "5                    0                        0  \n",
              "3                    0                        1  \n",
              "7                    0                        1  \n",
              "0                    0                        0  \n",
              "1                    1                        1  \n",
              "2                    1                        1  \n",
              "4                    0                        0  "
            ],
            "text/html": [
              "\n",
              "  <div id=\"df-26c0e7ab-dc07-44f1-94ec-68c5b5c78528\">\n",
              "    <div class=\"colab-df-container\">\n",
              "      <div>\n",
              "<style scoped>\n",
              "    .dataframe tbody tr th:only-of-type {\n",
              "        vertical-align: middle;\n",
              "    }\n",
              "\n",
              "    .dataframe tbody tr th {\n",
              "        vertical-align: top;\n",
              "    }\n",
              "\n",
              "    .dataframe thead th {\n",
              "        text-align: right;\n",
              "    }\n",
              "</style>\n",
              "<table border=\"1\" class=\"dataframe\">\n",
              "  <thead>\n",
              "    <tr style=\"text-align: right;\">\n",
              "      <th></th>\n",
              "      <th>subject_id</th>\n",
              "      <th>hadm_id</th>\n",
              "      <th>stay_id</th>\n",
              "      <th>exclude_non_adult</th>\n",
              "      <th>exclude_short_stays</th>\n",
              "      <th>exclude_readmission</th>\n",
              "      <th>exclude_other_hospitals</th>\n",
              "    </tr>\n",
              "  </thead>\n",
              "  <tbody>\n",
              "    <tr>\n",
              "      <th>6</th>\n",
              "      <td>10000032</td>\n",
              "      <td>29079034</td>\n",
              "      <td>39553978</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>8</th>\n",
              "      <td>10001884</td>\n",
              "      <td>26184834</td>\n",
              "      <td>37510196</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>5</th>\n",
              "      <td>10002223</td>\n",
              "      <td>22494570</td>\n",
              "      <td>39638202</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>3</th>\n",
              "      <td>10002443</td>\n",
              "      <td>21329021</td>\n",
              "      <td>35044219</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>1</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>7</th>\n",
              "      <td>10002495</td>\n",
              "      <td>24982426</td>\n",
              "      <td>36753294</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>1</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>0</th>\n",
              "      <td>10003400</td>\n",
              "      <td>20214994</td>\n",
              "      <td>32128372</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>1</th>\n",
              "      <td>10003400</td>\n",
              "      <td>23559586</td>\n",
              "      <td>34577403</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>1</td>\n",
              "      <td>1</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>2</th>\n",
              "      <td>10003400</td>\n",
              "      <td>23559586</td>\n",
              "      <td>38383343</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>1</td>\n",
              "      <td>1</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>4</th>\n",
              "      <td>10005866</td>\n",
              "      <td>20364112</td>\n",
              "      <td>34170353</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "    </tr>\n",
              "  </tbody>\n",
              "</table>\n",
              "</div>\n",
              "      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-26c0e7ab-dc07-44f1-94ec-68c5b5c78528')\"\n",
              "              title=\"Convert this dataframe to an interactive table.\"\n",
              "              style=\"display:none;\">\n",
              "        \n",
              "  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n",
              "       width=\"24px\">\n",
              "    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n",
              "    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n",
              "  </svg>\n",
              "      </button>\n",
              "      \n",
              "  <style>\n",
              "    .colab-df-container {\n",
              "      display:flex;\n",
              "      flex-wrap:wrap;\n",
              "      gap: 12px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert {\n",
              "      background-color: #E8F0FE;\n",
              "      border: none;\n",
              "      border-radius: 50%;\n",
              "      cursor: pointer;\n",
              "      display: none;\n",
              "      fill: #1967D2;\n",
              "      height: 32px;\n",
              "      padding: 0 0 0 0;\n",
              "      width: 32px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert:hover {\n",
              "      background-color: #E2EBFA;\n",
              "      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n",
              "      fill: #174EA6;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert {\n",
              "      background-color: #3B4455;\n",
              "      fill: #D2E3FC;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert:hover {\n",
              "      background-color: #434B5C;\n",
              "      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n",
              "      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n",
              "      fill: #FFFFFF;\n",
              "    }\n",
              "  </style>\n",
              "\n",
              "      <script>\n",
              "        const buttonEl =\n",
              "          document.querySelector('#df-26c0e7ab-dc07-44f1-94ec-68c5b5c78528 button.colab-df-convert');\n",
              "        buttonEl.style.display =\n",
              "          google.colab.kernel.accessAllowed ? 'block' : 'none';\n",
              "\n",
              "        async function convertToInteractive(key) {\n",
              "          const element = document.querySelector('#df-26c0e7ab-dc07-44f1-94ec-68c5b5c78528');\n",
              "          const dataTable =\n",
              "            await google.colab.kernel.invokeFunction('convertToInteractive',\n",
              "                                                     [key], {});\n",
              "          if (!dataTable) return;\n",
              "\n",
              "          const docLinkHtml = 'Like what you see? Visit the ' +\n",
              "            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n",
              "            + ' to learn more about interactive tables.';\n",
              "          element.innerHTML = '';\n",
              "          dataTable['output_type'] = 'display_data';\n",
              "          await google.colab.output.renderOutput(dataTable, element);\n",
              "          const docLink = document.createElement('div');\n",
              "          docLink.innerHTML = docLinkHtml;\n",
              "          element.appendChild(docLink);\n",
              "        }\n",
              "      </script>\n",
              "    </div>\n",
              "  </div>\n",
              "  "
            ]
          },
          "metadata": {}
        }
      ]
    },
    {
      "cell_type": "markdown",
      "source": [
        "Question 2: Write a query which extracts the first heart rate during the ICU stay.\n",
        "\n",
        "The resultant dataframe should have `subject_id`, `stay_id`, `charttime`, and the first heart rate."
      ],
      "metadata": {
        "id": "Mjs52i-VTs0H"
      }
    },
    {
      "cell_type": "code",
      "source": [
        "df = run_query(f'''\n",
        "SELECT ce.subject_id, ce.stay_id, ce.charttime, di.label, ce.valuenum\n",
        ", FIRST_VALUE(ce.valuenum) OVER (PARTITION BY ce.stay_id ORDER BY ce.charttime) AS first_heart_rate\n",
        "FROM `physionet-data.mimic_icu.chartevents` ce\n",
        "INNER JOIN `physionet-data.mimic_icu.d_items` di\n",
        "    ON ce.itemid = di.itemid\n",
        "WHERE ce.subject_id IN ({id_str}) AND ce.itemid = 220045\n",
        "''')\n",
        "display(df)"
      ],
      "metadata": {
        "id": "jk3kX0Bwbp6r",
        "colab": {
          "base_uri": "https://localhost:8080/",
          "height": 424
        },
        "outputId": "98b44eb5-908c-4174-b2c1-975ccc4bd849"
      },
      "execution_count": null,
      "outputs": [
        {
          "output_type": "display_data",
          "data": {
            "text/plain": [
              "      subject_id   stay_id           charttime       label  valuenum  \\\n",
              "0       10001884  37510196 2131-01-11 04:22:00  Heart Rate      38.0   \n",
              "1       10001884  37510196 2131-01-11 05:00:00  Heart Rate      60.0   \n",
              "2       10001884  37510196 2131-01-11 06:00:00  Heart Rate      72.0   \n",
              "3       10001884  37510196 2131-01-11 06:44:00  Heart Rate      71.0   \n",
              "4       10001884  37510196 2131-01-11 06:47:00  Heart Rate      71.0   \n",
              "...          ...       ...                 ...         ...       ...   \n",
              "1388    10003400  34577403 2137-08-13 13:00:00  Heart Rate      85.0   \n",
              "1389    10003400  34577403 2137-08-13 14:00:00  Heart Rate      85.0   \n",
              "1390    10003400  34577403 2137-08-13 15:00:00  Heart Rate      90.0   \n",
              "1391    10003400  34577403 2137-08-13 16:00:00  Heart Rate      91.0   \n",
              "1392    10003400  34577403 2137-08-13 17:00:00  Heart Rate      85.0   \n",
              "\n",
              "      first_heart_rate  \n",
              "0                 38.0  \n",
              "1                 38.0  \n",
              "2                 38.0  \n",
              "3                 38.0  \n",
              "4                 38.0  \n",
              "...                ...  \n",
              "1388              97.0  \n",
              "1389              97.0  \n",
              "1390              97.0  \n",
              "1391              97.0  \n",
              "1392              97.0  \n",
              "\n",
              "[1393 rows x 6 columns]"
            ],
            "text/html": [
              "\n",
              "  <div id=\"df-0234221f-d43b-4d73-a402-29c899719438\">\n",
              "    <div class=\"colab-df-container\">\n",
              "      <div>\n",
              "<style scoped>\n",
              "    .dataframe tbody tr th:only-of-type {\n",
              "        vertical-align: middle;\n",
              "    }\n",
              "\n",
              "    .dataframe tbody tr th {\n",
              "        vertical-align: top;\n",
              "    }\n",
              "\n",
              "    .dataframe thead th {\n",
              "        text-align: right;\n",
              "    }\n",
              "</style>\n",
              "<table border=\"1\" class=\"dataframe\">\n",
              "  <thead>\n",
              "    <tr style=\"text-align: right;\">\n",
              "      <th></th>\n",
              "      <th>subject_id</th>\n",
              "      <th>stay_id</th>\n",
              "      <th>charttime</th>\n",
              "      <th>label</th>\n",
              "      <th>valuenum</th>\n",
              "      <th>first_heart_rate</th>\n",
              "    </tr>\n",
              "  </thead>\n",
              "  <tbody>\n",
              "    <tr>\n",
              "      <th>0</th>\n",
              "      <td>10001884</td>\n",
              "      <td>37510196</td>\n",
              "      <td>2131-01-11 04:22:00</td>\n",
              "      <td>Heart Rate</td>\n",
              "      <td>38.0</td>\n",
              "      <td>38.0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>1</th>\n",
              "      <td>10001884</td>\n",
              "      <td>37510196</td>\n",
              "      <td>2131-01-11 05:00:00</td>\n",
              "      <td>Heart Rate</td>\n",
              "      <td>60.0</td>\n",
              "      <td>38.0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>2</th>\n",
              "      <td>10001884</td>\n",
              "      <td>37510196</td>\n",
              "      <td>2131-01-11 06:00:00</td>\n",
              "      <td>Heart Rate</td>\n",
              "      <td>72.0</td>\n",
              "      <td>38.0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>3</th>\n",
              "      <td>10001884</td>\n",
              "      <td>37510196</td>\n",
              "      <td>2131-01-11 06:44:00</td>\n",
              "      <td>Heart Rate</td>\n",
              "      <td>71.0</td>\n",
              "      <td>38.0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>4</th>\n",
              "      <td>10001884</td>\n",
              "      <td>37510196</td>\n",
              "      <td>2131-01-11 06:47:00</td>\n",
              "      <td>Heart Rate</td>\n",
              "      <td>71.0</td>\n",
              "      <td>38.0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>...</th>\n",
              "      <td>...</td>\n",
              "      <td>...</td>\n",
              "      <td>...</td>\n",
              "      <td>...</td>\n",
              "      <td>...</td>\n",
              "      <td>...</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>1388</th>\n",
              "      <td>10003400</td>\n",
              "      <td>34577403</td>\n",
              "      <td>2137-08-13 13:00:00</td>\n",
              "      <td>Heart Rate</td>\n",
              "      <td>85.0</td>\n",
              "      <td>97.0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>1389</th>\n",
              "      <td>10003400</td>\n",
              "      <td>34577403</td>\n",
              "      <td>2137-08-13 14:00:00</td>\n",
              "      <td>Heart Rate</td>\n",
              "      <td>85.0</td>\n",
              "      <td>97.0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>1390</th>\n",
              "      <td>10003400</td>\n",
              "      <td>34577403</td>\n",
              "      <td>2137-08-13 15:00:00</td>\n",
              "      <td>Heart Rate</td>\n",
              "      <td>90.0</td>\n",
              "      <td>97.0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>1391</th>\n",
              "      <td>10003400</td>\n",
              "      <td>34577403</td>\n",
              "      <td>2137-08-13 16:00:00</td>\n",
              "      <td>Heart Rate</td>\n",
              "      <td>91.0</td>\n",
              "      <td>97.0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>1392</th>\n",
              "      <td>10003400</td>\n",
              "      <td>34577403</td>\n",
              "      <td>2137-08-13 17:00:00</td>\n",
              "      <td>Heart Rate</td>\n",
              "      <td>85.0</td>\n",
              "      <td>97.0</td>\n",
              "    </tr>\n",
              "  </tbody>\n",
              "</table>\n",
              "<p>1393 rows Ã— 6 columns</p>\n",
              "</div>\n",
              "      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-0234221f-d43b-4d73-a402-29c899719438')\"\n",
              "              title=\"Convert this dataframe to an interactive table.\"\n",
              "              style=\"display:none;\">\n",
              "        \n",
              "  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n",
              "       width=\"24px\">\n",
              "    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n",
              "    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n",
              "  </svg>\n",
              "      </button>\n",
              "      \n",
              "  <style>\n",
              "    .colab-df-container {\n",
              "      display:flex;\n",
              "      flex-wrap:wrap;\n",
              "      gap: 12px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert {\n",
              "      background-color: #E8F0FE;\n",
              "      border: none;\n",
              "      border-radius: 50%;\n",
              "      cursor: pointer;\n",
              "      display: none;\n",
              "      fill: #1967D2;\n",
              "      height: 32px;\n",
              "      padding: 0 0 0 0;\n",
              "      width: 32px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert:hover {\n",
              "      background-color: #E2EBFA;\n",
              "      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n",
              "      fill: #174EA6;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert {\n",
              "      background-color: #3B4455;\n",
              "      fill: #D2E3FC;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert:hover {\n",
              "      background-color: #434B5C;\n",
              "      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n",
              "      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n",
              "      fill: #FFFFFF;\n",
              "    }\n",
              "  </style>\n",
              "\n",
              "      <script>\n",
              "        const buttonEl =\n",
              "          document.querySelector('#df-0234221f-d43b-4d73-a402-29c899719438 button.colab-df-convert');\n",
              "        buttonEl.style.display =\n",
              "          google.colab.kernel.accessAllowed ? 'block' : 'none';\n",
              "\n",
              "        async function convertToInteractive(key) {\n",
              "          const element = document.querySelector('#df-0234221f-d43b-4d73-a402-29c899719438');\n",
              "          const dataTable =\n",
              "            await google.colab.kernel.invokeFunction('convertToInteractive',\n",
              "                                                     [key], {});\n",
              "          if (!dataTable) return;\n",
              "\n",
              "          const docLinkHtml = 'Like what you see? Visit the ' +\n",
              "            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n",
              "            + ' to learn more about interactive tables.';\n",
              "          element.innerHTML = '';\n",
              "          dataTable['output_type'] = 'display_data';\n",
              "          await google.colab.output.renderOutput(dataTable, element);\n",
              "          const docLink = document.createElement('div');\n",
              "          docLink.innerHTML = docLinkHtml;\n",
              "          element.appendChild(docLink);\n",
              "        }\n",
              "      </script>\n",
              "    </div>\n",
              "  </div>\n",
              "  "
            ]
          },
          "metadata": {}
        }
      ]
    },
    {
      "cell_type": "markdown",
      "source": [
        "Question 3: Write a query which extracts the first heart rhythm during the ICU stay.\n",
        "\n",
        "The resultant dataframe should have `subject_id`, `stay_id`, `charttime`, and the first heart rhythm."
      ],
      "metadata": {
        "id": "wk-0003tqV34"
      }
    },
    {
      "cell_type": "code",
      "source": [
        "df = run_query(f\"\"\"\n",
        "SELECT \n",
        "      di.label\n",
        "    , di.itemid\n",
        "FROM `physionet-data.mimic_icu.d_items` di\n",
        "WHERE di.label = \"Heart Rhythm\"\n",
        "\"\"\")\n",
        "display(df)"
      ],
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/",
          "height": 81
        },
        "id": "tZkJPnNXq90_",
        "outputId": "761a4971-7009-4d68-a523-2e8657a3f2ea"
      },
      "execution_count": null,
      "outputs": [
        {
          "output_type": "display_data",
          "data": {
            "text/plain": [
              "          label  itemid\n",
              "0  Heart Rhythm  220048"
            ],
            "text/html": [
              "\n",
              "  <div id=\"df-0b3bf0fc-2e4b-42d2-9e72-f86318a2acb5\">\n",
              "    <div class=\"colab-df-container\">\n",
              "      <div>\n",
              "<style scoped>\n",
              "    .dataframe tbody tr th:only-of-type {\n",
              "        vertical-align: middle;\n",
              "    }\n",
              "\n",
              "    .dataframe tbody tr th {\n",
              "        vertical-align: top;\n",
              "    }\n",
              "\n",
              "    .dataframe thead th {\n",
              "        text-align: right;\n",
              "    }\n",
              "</style>\n",
              "<table border=\"1\" class=\"dataframe\">\n",
              "  <thead>\n",
              "    <tr style=\"text-align: right;\">\n",
              "      <th></th>\n",
              "      <th>label</th>\n",
              "      <th>itemid</th>\n",
              "    </tr>\n",
              "  </thead>\n",
              "  <tbody>\n",
              "    <tr>\n",
              "      <th>0</th>\n",
              "      <td>Heart Rhythm</td>\n",
              "      <td>220048</td>\n",
              "    </tr>\n",
              "  </tbody>\n",
              "</table>\n",
              "</div>\n",
              "      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-0b3bf0fc-2e4b-42d2-9e72-f86318a2acb5')\"\n",
              "              title=\"Convert this dataframe to an interactive table.\"\n",
              "              style=\"display:none;\">\n",
              "        \n",
              "  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n",
              "       width=\"24px\">\n",
              "    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n",
              "    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n",
              "  </svg>\n",
              "      </button>\n",
              "      \n",
              "  <style>\n",
              "    .colab-df-container {\n",
              "      display:flex;\n",
              "      flex-wrap:wrap;\n",
              "      gap: 12px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert {\n",
              "      background-color: #E8F0FE;\n",
              "      border: none;\n",
              "      border-radius: 50%;\n",
              "      cursor: pointer;\n",
              "      display: none;\n",
              "      fill: #1967D2;\n",
              "      height: 32px;\n",
              "      padding: 0 0 0 0;\n",
              "      width: 32px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert:hover {\n",
              "      background-color: #E2EBFA;\n",
              "      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n",
              "      fill: #174EA6;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert {\n",
              "      background-color: #3B4455;\n",
              "      fill: #D2E3FC;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert:hover {\n",
              "      background-color: #434B5C;\n",
              "      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n",
              "      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n",
              "      fill: #FFFFFF;\n",
              "    }\n",
              "  </style>\n",
              "\n",
              "      <script>\n",
              "        const buttonEl =\n",
              "          document.querySelector('#df-0b3bf0fc-2e4b-42d2-9e72-f86318a2acb5 button.colab-df-convert');\n",
              "        buttonEl.style.display =\n",
              "          google.colab.kernel.accessAllowed ? 'block' : 'none';\n",
              "\n",
              "        async function convertToInteractive(key) {\n",
              "          const element = document.querySelector('#df-0b3bf0fc-2e4b-42d2-9e72-f86318a2acb5');\n",
              "          const dataTable =\n",
              "            await google.colab.kernel.invokeFunction('convertToInteractive',\n",
              "                                                     [key], {});\n",
              "          if (!dataTable) return;\n",
              "\n",
              "          const docLinkHtml = 'Like what you see? Visit the ' +\n",
              "            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n",
              "            + ' to learn more about interactive tables.';\n",
              "          element.innerHTML = '';\n",
              "          dataTable['output_type'] = 'display_data';\n",
              "          await google.colab.output.renderOutput(dataTable, element);\n",
              "          const docLink = document.createElement('div');\n",
              "          docLink.innerHTML = docLinkHtml;\n",
              "          element.appendChild(docLink);\n",
              "        }\n",
              "      </script>\n",
              "    </div>\n",
              "  </div>\n",
              "  "
            ]
          },
          "metadata": {}
        }
      ]
    },
    {
      "cell_type": "code",
      "source": [
        "df = run_query(f'''\n",
        "SELECT ce.subject_id, ce.stay_id, ce.charttime, di.label, ce.value\n",
        ", FIRST_VALUE(ce.value) OVER (PARTITION BY ce.stay_id ORDER BY ce.charttime) AS first_heart_rate\n",
        "FROM `physionet-data.mimic_icu.chartevents` ce\n",
        "INNER JOIN `physionet-data.mimic_icu.d_items` di\n",
        "    ON ce.itemid = di.itemid\n",
        "WHERE ce.subject_id IN ({id_str}) AND ce.itemid = 220048\n",
        "''')\n",
        "df.sort_values('subject_id', inplace=True)\n",
        "display(df)"
      ],
      "metadata": {
        "id": "AKnnZM09qVeQ",
        "colab": {
          "base_uri": "https://localhost:8080/",
          "height": 424
        },
        "outputId": "d00fad62-ab08-41e4-c22a-0340c1663461"
      },
      "execution_count": null,
      "outputs": [
        {
          "output_type": "display_data",
          "data": {
            "text/plain": [
              "      subject_id   stay_id           charttime         label  \\\n",
              "1308    10000032  39553978 2180-07-23 21:00:00  Heart Rhythm   \n",
              "1300    10000032  39553978 2180-07-23 14:00:00  Heart Rhythm   \n",
              "1301    10000032  39553978 2180-07-23 14:30:00  Heart Rhythm   \n",
              "1302    10000032  39553978 2180-07-23 15:00:00  Heart Rhythm   \n",
              "1307    10000032  39553978 2180-07-23 20:00:00  Heart Rhythm   \n",
              "...          ...       ...                 ...           ...   \n",
              "30      10005866  34170353 2149-10-03 18:00:00  Heart Rhythm   \n",
              "29      10005866  34170353 2149-10-03 17:00:00  Heart Rhythm   \n",
              "28      10005866  34170353 2149-10-03 16:00:00  Heart Rhythm   \n",
              "39      10005866  34170353 2149-10-04 03:00:00  Heart Rhythm   \n",
              "0       10005866  34170353 2149-10-02 12:00:00  Heart Rhythm   \n",
              "\n",
              "                        value   first_heart_rate  \n",
              "1308        SR (Sinus Rhythm)  SR (Sinus Rhythm)  \n",
              "1300        SR (Sinus Rhythm)  SR (Sinus Rhythm)  \n",
              "1301        SR (Sinus Rhythm)  SR (Sinus Rhythm)  \n",
              "1302        SR (Sinus Rhythm)  SR (Sinus Rhythm)  \n",
              "1307  ST (Sinus Tachycardia)   SR (Sinus Rhythm)  \n",
              "...                       ...                ...  \n",
              "30          SR (Sinus Rhythm)  SR (Sinus Rhythm)  \n",
              "29          SR (Sinus Rhythm)  SR (Sinus Rhythm)  \n",
              "28          SR (Sinus Rhythm)  SR (Sinus Rhythm)  \n",
              "39          SR (Sinus Rhythm)  SR (Sinus Rhythm)  \n",
              "0           SR (Sinus Rhythm)  SR (Sinus Rhythm)  \n",
              "\n",
              "[1309 rows x 6 columns]"
            ],
            "text/html": [
              "\n",
              "  <div id=\"df-382fab12-b3c0-4e51-a42b-d3004c4b9b89\">\n",
              "    <div class=\"colab-df-container\">\n",
              "      <div>\n",
              "<style scoped>\n",
              "    .dataframe tbody tr th:only-of-type {\n",
              "        vertical-align: middle;\n",
              "    }\n",
              "\n",
              "    .dataframe tbody tr th {\n",
              "        vertical-align: top;\n",
              "    }\n",
              "\n",
              "    .dataframe thead th {\n",
              "        text-align: right;\n",
              "    }\n",
              "</style>\n",
              "<table border=\"1\" class=\"dataframe\">\n",
              "  <thead>\n",
              "    <tr style=\"text-align: right;\">\n",
              "      <th></th>\n",
              "      <th>subject_id</th>\n",
              "      <th>stay_id</th>\n",
              "      <th>charttime</th>\n",
              "      <th>label</th>\n",
              "      <th>value</th>\n",
              "      <th>first_heart_rate</th>\n",
              "    </tr>\n",
              "  </thead>\n",
              "  <tbody>\n",
              "    <tr>\n",
              "      <th>1308</th>\n",
              "      <td>10000032</td>\n",
              "      <td>39553978</td>\n",
              "      <td>2180-07-23 21:00:00</td>\n",
              "      <td>Heart Rhythm</td>\n",
              "      <td>SR (Sinus Rhythm)</td>\n",
              "      <td>SR (Sinus Rhythm)</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>1300</th>\n",
              "      <td>10000032</td>\n",
              "      <td>39553978</td>\n",
              "      <td>2180-07-23 14:00:00</td>\n",
              "      <td>Heart Rhythm</td>\n",
              "      <td>SR (Sinus Rhythm)</td>\n",
              "      <td>SR (Sinus Rhythm)</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>1301</th>\n",
              "      <td>10000032</td>\n",
              "      <td>39553978</td>\n",
              "      <td>2180-07-23 14:30:00</td>\n",
              "      <td>Heart Rhythm</td>\n",
              "      <td>SR (Sinus Rhythm)</td>\n",
              "      <td>SR (Sinus Rhythm)</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>1302</th>\n",
              "      <td>10000032</td>\n",
              "      <td>39553978</td>\n",
              "      <td>2180-07-23 15:00:00</td>\n",
              "      <td>Heart Rhythm</td>\n",
              "      <td>SR (Sinus Rhythm)</td>\n",
              "      <td>SR (Sinus Rhythm)</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>1307</th>\n",
              "      <td>10000032</td>\n",
              "      <td>39553978</td>\n",
              "      <td>2180-07-23 20:00:00</td>\n",
              "      <td>Heart Rhythm</td>\n",
              "      <td>ST (Sinus Tachycardia)</td>\n",
              "      <td>SR (Sinus Rhythm)</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>...</th>\n",
              "      <td>...</td>\n",
              "      <td>...</td>\n",
              "      <td>...</td>\n",
              "      <td>...</td>\n",
              "      <td>...</td>\n",
              "      <td>...</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>30</th>\n",
              "      <td>10005866</td>\n",
              "      <td>34170353</td>\n",
              "      <td>2149-10-03 18:00:00</td>\n",
              "      <td>Heart Rhythm</td>\n",
              "      <td>SR (Sinus Rhythm)</td>\n",
              "      <td>SR (Sinus Rhythm)</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>29</th>\n",
              "      <td>10005866</td>\n",
              "      <td>34170353</td>\n",
              "      <td>2149-10-03 17:00:00</td>\n",
              "      <td>Heart Rhythm</td>\n",
              "      <td>SR (Sinus Rhythm)</td>\n",
              "      <td>SR (Sinus Rhythm)</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>28</th>\n",
              "      <td>10005866</td>\n",
              "      <td>34170353</td>\n",
              "      <td>2149-10-03 16:00:00</td>\n",
              "      <td>Heart Rhythm</td>\n",
              "      <td>SR (Sinus Rhythm)</td>\n",
              "      <td>SR (Sinus Rhythm)</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>39</th>\n",
              "      <td>10005866</td>\n",
              "      <td>34170353</td>\n",
              "      <td>2149-10-04 03:00:00</td>\n",
              "      <td>Heart Rhythm</td>\n",
              "      <td>SR (Sinus Rhythm)</td>\n",
              "      <td>SR (Sinus Rhythm)</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>0</th>\n",
              "      <td>10005866</td>\n",
              "      <td>34170353</td>\n",
              "      <td>2149-10-02 12:00:00</td>\n",
              "      <td>Heart Rhythm</td>\n",
              "      <td>SR (Sinus Rhythm)</td>\n",
              "      <td>SR (Sinus Rhythm)</td>\n",
              "    </tr>\n",
              "  </tbody>\n",
              "</table>\n",
              "<p>1309 rows Ã— 6 columns</p>\n",
              "</div>\n",
              "      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-382fab12-b3c0-4e51-a42b-d3004c4b9b89')\"\n",
              "              title=\"Convert this dataframe to an interactive table.\"\n",
              "              style=\"display:none;\">\n",
              "        \n",
              "  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n",
              "       width=\"24px\">\n",
              "    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n",
              "    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n",
              "  </svg>\n",
              "      </button>\n",
              "      \n",
              "  <style>\n",
              "    .colab-df-container {\n",
              "      display:flex;\n",
              "      flex-wrap:wrap;\n",
              "      gap: 12px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert {\n",
              "      background-color: #E8F0FE;\n",
              "      border: none;\n",
              "      border-radius: 50%;\n",
              "      cursor: pointer;\n",
              "      display: none;\n",
              "      fill: #1967D2;\n",
              "      height: 32px;\n",
              "      padding: 0 0 0 0;\n",
              "      width: 32px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert:hover {\n",
              "      background-color: #E2EBFA;\n",
              "      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n",
              "      fill: #174EA6;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert {\n",
              "      background-color: #3B4455;\n",
              "      fill: #D2E3FC;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert:hover {\n",
              "      background-color: #434B5C;\n",
              "      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n",
              "      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n",
              "      fill: #FFFFFF;\n",
              "    }\n",
              "  </style>\n",
              "\n",
              "      <script>\n",
              "        const buttonEl =\n",
              "          document.querySelector('#df-382fab12-b3c0-4e51-a42b-d3004c4b9b89 button.colab-df-convert');\n",
              "        buttonEl.style.display =\n",
              "          google.colab.kernel.accessAllowed ? 'block' : 'none';\n",
              "\n",
              "        async function convertToInteractive(key) {\n",
              "          const element = document.querySelector('#df-382fab12-b3c0-4e51-a42b-d3004c4b9b89');\n",
              "          const dataTable =\n",
              "            await google.colab.kernel.invokeFunction('convertToInteractive',\n",
              "                                                     [key], {});\n",
              "          if (!dataTable) return;\n",
              "\n",
              "          const docLinkHtml = 'Like what you see? Visit the ' +\n",
              "            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n",
              "            + ' to learn more about interactive tables.';\n",
              "          element.innerHTML = '';\n",
              "          dataTable['output_type'] = 'display_data';\n",
              "          await google.colab.output.renderOutput(dataTable, element);\n",
              "          const docLink = document.createElement('div');\n",
              "          docLink.innerHTML = docLinkHtml;\n",
              "          element.appendChild(docLink);\n",
              "        }\n",
              "      </script>\n",
              "    </div>\n",
              "  </div>\n",
              "  "
            ]
          },
          "metadata": {}
        }
      ]
    },
    {
      "cell_type": "markdown",
      "source": [
        "Question 4: Using the above dataframe, count how many observations there are for each heart rhythm."
      ],
      "metadata": {
        "id": "FYlHJtpBU88j"
      }
    },
    {
      "cell_type": "code",
      "source": [
        "# aggregate here\n",
        "df = run_query(f'''\n",
        "SELECT ce.subject_id, ce.stay_id, ce.charttime, di.label, ce.value, b.heart_rhythm_count\n",
        ", FIRST_VALUE(ce.value) OVER (PARTITION BY ce.stay_id ORDER BY ce.charttime) AS first_heart_rhythm\n",
        "FROM `physionet-data.mimic_icu.chartevents` ce\n",
        "INNER JOIN `physionet-data.mimic_icu.d_items` di\n",
        "    ON ce.itemid = di.itemid\n",
        "INNER JOIN (SELECT value, count(value) as heart_rhythm_count\n",
        "              FROM `physionet-data.mimic_icu.chartevents`\n",
        "              WHERE subject_id IN ({id_str})\n",
        "              GROUP BY value) b ON ce.value = b.value\n",
        "WHERE ce.subject_id IN ({id_str}) AND ce.itemid = 220048\n",
        "''')\n",
        "df.sort_values('subject_id', inplace=True)\n",
        "display(df)"
      ],
      "metadata": {
        "id": "E2wal4ZrV8je",
        "colab": {
          "base_uri": "https://localhost:8080/",
          "height": 424
        },
        "outputId": "7f51732a-8af7-4214-945c-1df76b5af51b"
      },
      "execution_count": null,
      "outputs": [
        {
          "output_type": "display_data",
          "data": {
            "text/plain": [
              "      subject_id   stay_id           charttime         label  \\\n",
              "1021    10000032  39553978 2180-07-23 21:00:00  Heart Rhythm   \n",
              "1020    10000032  39553978 2180-07-23 20:00:00  Heart Rhythm   \n",
              "1019    10000032  39553978 2180-07-23 19:00:00  Heart Rhythm   \n",
              "1018    10000032  39553978 2180-07-23 18:00:00  Heart Rhythm   \n",
              "1017    10000032  39553978 2180-07-23 17:00:00  Heart Rhythm   \n",
              "...          ...       ...                 ...           ...   \n",
              "790     10005866  34170353 2149-10-03 13:00:00  Heart Rhythm   \n",
              "791     10005866  34170353 2149-10-03 14:00:00  Heart Rhythm   \n",
              "792     10005866  34170353 2149-10-03 14:04:00  Heart Rhythm   \n",
              "780     10005866  34170353 2149-10-03 03:00:00  Heart Rhythm   \n",
              "797     10005866  34170353 2149-10-03 19:00:00  Heart Rhythm   \n",
              "\n",
              "                         value  heart_rhythm_count first_heart_rhythm  \n",
              "1021         SR (Sinus Rhythm)                 330  SR (Sinus Rhythm)  \n",
              "1020   ST (Sinus Tachycardia)                   27  SR (Sinus Rhythm)  \n",
              "1019         SR (Sinus Rhythm)                 330  SR (Sinus Rhythm)  \n",
              "1018   ST (Sinus Tachycardia)                   27  SR (Sinus Rhythm)  \n",
              "1017         SR (Sinus Rhythm)                 330  SR (Sinus Rhythm)  \n",
              "...                        ...                 ...                ...  \n",
              "790   AF (Atrial Fibrillation)                 898  SR (Sinus Rhythm)  \n",
              "791   AF (Atrial Fibrillation)                 898  SR (Sinus Rhythm)  \n",
              "792          SR (Sinus Rhythm)                 330  SR (Sinus Rhythm)  \n",
              "780    ST (Sinus Tachycardia)                   27  SR (Sinus Rhythm)  \n",
              "797          SR (Sinus Rhythm)                 330  SR (Sinus Rhythm)  \n",
              "\n",
              "[1309 rows x 7 columns]"
            ],
            "text/html": [
              "\n",
              "  <div id=\"df-f16c2467-9a22-40b3-8b5b-2c3ff6f5fbd8\">\n",
              "    <div class=\"colab-df-container\">\n",
              "      <div>\n",
              "<style scoped>\n",
              "    .dataframe tbody tr th:only-of-type {\n",
              "        vertical-align: middle;\n",
              "    }\n",
              "\n",
              "    .dataframe tbody tr th {\n",
              "        vertical-align: top;\n",
              "    }\n",
              "\n",
              "    .dataframe thead th {\n",
              "        text-align: right;\n",
              "    }\n",
              "</style>\n",
              "<table border=\"1\" class=\"dataframe\">\n",
              "  <thead>\n",
              "    <tr style=\"text-align: right;\">\n",
              "      <th></th>\n",
              "      <th>subject_id</th>\n",
              "      <th>stay_id</th>\n",
              "      <th>charttime</th>\n",
              "      <th>label</th>\n",
              "      <th>value</th>\n",
              "      <th>heart_rhythm_count</th>\n",
              "      <th>first_heart_rhythm</th>\n",
              "    </tr>\n",
              "  </thead>\n",
              "  <tbody>\n",
              "    <tr>\n",
              "      <th>1021</th>\n",
              "      <td>10000032</td>\n",
              "      <td>39553978</td>\n",
              "      <td>2180-07-23 21:00:00</td>\n",
              "      <td>Heart Rhythm</td>\n",
              "      <td>SR (Sinus Rhythm)</td>\n",
              "      <td>330</td>\n",
              "      <td>SR (Sinus Rhythm)</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>1020</th>\n",
              "      <td>10000032</td>\n",
              "      <td>39553978</td>\n",
              "      <td>2180-07-23 20:00:00</td>\n",
              "      <td>Heart Rhythm</td>\n",
              "      <td>ST (Sinus Tachycardia)</td>\n",
              "      <td>27</td>\n",
              "      <td>SR (Sinus Rhythm)</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>1019</th>\n",
              "      <td>10000032</td>\n",
              "      <td>39553978</td>\n",
              "      <td>2180-07-23 19:00:00</td>\n",
              "      <td>Heart Rhythm</td>\n",
              "      <td>SR (Sinus Rhythm)</td>\n",
              "      <td>330</td>\n",
              "      <td>SR (Sinus Rhythm)</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>1018</th>\n",
              "      <td>10000032</td>\n",
              "      <td>39553978</td>\n",
              "      <td>2180-07-23 18:00:00</td>\n",
              "      <td>Heart Rhythm</td>\n",
              "      <td>ST (Sinus Tachycardia)</td>\n",
              "      <td>27</td>\n",
              "      <td>SR (Sinus Rhythm)</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>1017</th>\n",
              "      <td>10000032</td>\n",
              "      <td>39553978</td>\n",
              "      <td>2180-07-23 17:00:00</td>\n",
              "      <td>Heart Rhythm</td>\n",
              "      <td>SR (Sinus Rhythm)</td>\n",
              "      <td>330</td>\n",
              "      <td>SR (Sinus Rhythm)</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>...</th>\n",
              "      <td>...</td>\n",
              "      <td>...</td>\n",
              "      <td>...</td>\n",
              "      <td>...</td>\n",
              "      <td>...</td>\n",
              "      <td>...</td>\n",
              "      <td>...</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>790</th>\n",
              "      <td>10005866</td>\n",
              "      <td>34170353</td>\n",
              "      <td>2149-10-03 13:00:00</td>\n",
              "      <td>Heart Rhythm</td>\n",
              "      <td>AF (Atrial Fibrillation)</td>\n",
              "      <td>898</td>\n",
              "      <td>SR (Sinus Rhythm)</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>791</th>\n",
              "      <td>10005866</td>\n",
              "      <td>34170353</td>\n",
              "      <td>2149-10-03 14:00:00</td>\n",
              "      <td>Heart Rhythm</td>\n",
              "      <td>AF (Atrial Fibrillation)</td>\n",
              "      <td>898</td>\n",
              "      <td>SR (Sinus Rhythm)</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>792</th>\n",
              "      <td>10005866</td>\n",
              "      <td>34170353</td>\n",
              "      <td>2149-10-03 14:04:00</td>\n",
              "      <td>Heart Rhythm</td>\n",
              "      <td>SR (Sinus Rhythm)</td>\n",
              "      <td>330</td>\n",
              "      <td>SR (Sinus Rhythm)</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>780</th>\n",
              "      <td>10005866</td>\n",
              "      <td>34170353</td>\n",
              "      <td>2149-10-03 03:00:00</td>\n",
              "      <td>Heart Rhythm</td>\n",
              "      <td>ST (Sinus Tachycardia)</td>\n",
              "      <td>27</td>\n",
              "      <td>SR (Sinus Rhythm)</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>797</th>\n",
              "      <td>10005866</td>\n",
              "      <td>34170353</td>\n",
              "      <td>2149-10-03 19:00:00</td>\n",
              "      <td>Heart Rhythm</td>\n",
              "      <td>SR (Sinus Rhythm)</td>\n",
              "      <td>330</td>\n",
              "      <td>SR (Sinus Rhythm)</td>\n",
              "    </tr>\n",
              "  </tbody>\n",
              "</table>\n",
              "<p>1309 rows Ã— 7 columns</p>\n",
              "</div>\n",
              "      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-f16c2467-9a22-40b3-8b5b-2c3ff6f5fbd8')\"\n",
              "              title=\"Convert this dataframe to an interactive table.\"\n",
              "              style=\"display:none;\">\n",
              "        \n",
              "  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n",
              "       width=\"24px\">\n",
              "    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n",
              "    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n",
              "  </svg>\n",
              "      </button>\n",
              "      \n",
              "  <style>\n",
              "    .colab-df-container {\n",
              "      display:flex;\n",
              "      flex-wrap:wrap;\n",
              "      gap: 12px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert {\n",
              "      background-color: #E8F0FE;\n",
              "      border: none;\n",
              "      border-radius: 50%;\n",
              "      cursor: pointer;\n",
              "      display: none;\n",
              "      fill: #1967D2;\n",
              "      height: 32px;\n",
              "      padding: 0 0 0 0;\n",
              "      width: 32px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert:hover {\n",
              "      background-color: #E2EBFA;\n",
              "      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n",
              "      fill: #174EA6;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert {\n",
              "      background-color: #3B4455;\n",
              "      fill: #D2E3FC;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert:hover {\n",
              "      background-color: #434B5C;\n",
              "      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n",
              "      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n",
              "      fill: #FFFFFF;\n",
              "    }\n",
              "  </style>\n",
              "\n",
              "      <script>\n",
              "        const buttonEl =\n",
              "          document.querySelector('#df-f16c2467-9a22-40b3-8b5b-2c3ff6f5fbd8 button.colab-df-convert');\n",
              "        buttonEl.style.display =\n",
              "          google.colab.kernel.accessAllowed ? 'block' : 'none';\n",
              "\n",
              "        async function convertToInteractive(key) {\n",
              "          const element = document.querySelector('#df-f16c2467-9a22-40b3-8b5b-2c3ff6f5fbd8');\n",
              "          const dataTable =\n",
              "            await google.colab.kernel.invokeFunction('convertToInteractive',\n",
              "                                                     [key], {});\n",
              "          if (!dataTable) return;\n",
              "\n",
              "          const docLinkHtml = 'Like what you see? Visit the ' +\n",
              "            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n",
              "            + ' to learn more about interactive tables.';\n",
              "          element.innerHTML = '';\n",
              "          dataTable['output_type'] = 'display_data';\n",
              "          await google.colab.output.renderOutput(dataTable, element);\n",
              "          const docLink = document.createElement('div');\n",
              "          docLink.innerHTML = docLinkHtml;\n",
              "          element.appendChild(docLink);\n",
              "        }\n",
              "      </script>\n",
              "    </div>\n",
              "  </div>\n",
              "  "
            ]
          },
          "metadata": {}
        }
      ]
    },
    {
      "cell_type": "markdown",
      "source": [
        "Question 5: Identify from the above heart rhythms the ones which correspond to atrial fibrillation."
      ],
      "metadata": {
        "id": "oGYKoJulWktV"
      }
    },
    {
      "cell_type": "markdown",
      "source": [
        "Let's see the different values for the Heart Rhythm"
      ],
      "metadata": {
        "id": "WY74ncxo5nA_"
      }
    },
    {
      "cell_type": "code",
      "source": [
        "df = run_query(f'''\n",
        "WITH ab AS \n",
        "(\n",
        "  SELECT ce.subject_id, ce.stay_id, ce.charttime, di.label, ce.value, b.heart_rhythm_count\n",
        ", FIRST_VALUE(ce.value) OVER (PARTITION BY ce.stay_id ORDER BY ce.charttime) AS first_heart_rate\n",
        "FROM `physionet-data.mimic_icu.chartevents` ce\n",
        "INNER JOIN `physionet-data.mimic_icu.d_items` di\n",
        "    ON ce.itemid = di.itemid\n",
        "INNER JOIN (SELECT value, count(value) as heart_rhythm_count\n",
        "              FROM `physionet-data.mimic_icu.chartevents`\n",
        "              WHERE subject_id IN ({id_str})\n",
        "              GROUP BY value) b ON ce.value = b.value\n",
        "WHERE ce.subject_id IN ({id_str}) AND ce.itemid = 220048\n",
        "ORDER BY b.heart_rhythm_count\n",
        ")\n",
        "SELECT DISTINCT value, heart_rhythm_count\n",
        "FROM ab\n",
        "ORDER BY heart_rhythm_count\n",
        "''')\n",
        "display(df)"
      ],
      "metadata": {
        "id": "ndcBmMizs-UJ",
        "colab": {
          "base_uri": "https://localhost:8080/",
          "height": 332
        },
        "outputId": "10bb4511-b23a-4663-d19d-33ba4f2e9d3d"
      },
      "execution_count": null,
      "outputs": [
        {
          "output_type": "display_data",
          "data": {
            "text/plain": [
              "                                 value  heart_rhythm_count\n",
              "0  PAT (Paroxysmal Atrial Tachycardia)                   2\n",
              "1             A Flut (Atrial Flutter)                    2\n",
              "2     LBBB (Left Bundle Branch Block)                    4\n",
              "3                SA (Sinus Arrhythmia)                   4\n",
              "4               SB (Sinus Bradycardia)                  14\n",
              "5              ST (Sinus Tachycardia)                   27\n",
              "6                              V Paced                  28\n",
              "7                    SR (Sinus Rhythm)                 330\n",
              "8             AF (Atrial Fibrillation)                 898"
            ],
            "text/html": [
              "\n",
              "  <div id=\"df-3c7dccd4-7bdd-4981-86e2-b116be3f1dbc\">\n",
              "    <div class=\"colab-df-container\">\n",
              "      <div>\n",
              "<style scoped>\n",
              "    .dataframe tbody tr th:only-of-type {\n",
              "        vertical-align: middle;\n",
              "    }\n",
              "\n",
              "    .dataframe tbody tr th {\n",
              "        vertical-align: top;\n",
              "    }\n",
              "\n",
              "    .dataframe thead th {\n",
              "        text-align: right;\n",
              "    }\n",
              "</style>\n",
              "<table border=\"1\" class=\"dataframe\">\n",
              "  <thead>\n",
              "    <tr style=\"text-align: right;\">\n",
              "      <th></th>\n",
              "      <th>value</th>\n",
              "      <th>heart_rhythm_count</th>\n",
              "    </tr>\n",
              "  </thead>\n",
              "  <tbody>\n",
              "    <tr>\n",
              "      <th>0</th>\n",
              "      <td>PAT (Paroxysmal Atrial Tachycardia)</td>\n",
              "      <td>2</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>1</th>\n",
              "      <td>A Flut (Atrial Flutter)</td>\n",
              "      <td>2</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>2</th>\n",
              "      <td>LBBB (Left Bundle Branch Block)</td>\n",
              "      <td>4</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>3</th>\n",
              "      <td>SA (Sinus Arrhythmia)</td>\n",
              "      <td>4</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>4</th>\n",
              "      <td>SB (Sinus Bradycardia)</td>\n",
              "      <td>14</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>5</th>\n",
              "      <td>ST (Sinus Tachycardia)</td>\n",
              "      <td>27</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>6</th>\n",
              "      <td>V Paced</td>\n",
              "      <td>28</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>7</th>\n",
              "      <td>SR (Sinus Rhythm)</td>\n",
              "      <td>330</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>8</th>\n",
              "      <td>AF (Atrial Fibrillation)</td>\n",
              "      <td>898</td>\n",
              "    </tr>\n",
              "  </tbody>\n",
              "</table>\n",
              "</div>\n",
              "      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-3c7dccd4-7bdd-4981-86e2-b116be3f1dbc')\"\n",
              "              title=\"Convert this dataframe to an interactive table.\"\n",
              "              style=\"display:none;\">\n",
              "        \n",
              "  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n",
              "       width=\"24px\">\n",
              "    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n",
              "    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n",
              "  </svg>\n",
              "      </button>\n",
              "      \n",
              "  <style>\n",
              "    .colab-df-container {\n",
              "      display:flex;\n",
              "      flex-wrap:wrap;\n",
              "      gap: 12px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert {\n",
              "      background-color: #E8F0FE;\n",
              "      border: none;\n",
              "      border-radius: 50%;\n",
              "      cursor: pointer;\n",
              "      display: none;\n",
              "      fill: #1967D2;\n",
              "      height: 32px;\n",
              "      padding: 0 0 0 0;\n",
              "      width: 32px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert:hover {\n",
              "      background-color: #E2EBFA;\n",
              "      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n",
              "      fill: #174EA6;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert {\n",
              "      background-color: #3B4455;\n",
              "      fill: #D2E3FC;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert:hover {\n",
              "      background-color: #434B5C;\n",
              "      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n",
              "      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n",
              "      fill: #FFFFFF;\n",
              "    }\n",
              "  </style>\n",
              "\n",
              "      <script>\n",
              "        const buttonEl =\n",
              "          document.querySelector('#df-3c7dccd4-7bdd-4981-86e2-b116be3f1dbc button.colab-df-convert');\n",
              "        buttonEl.style.display =\n",
              "          google.colab.kernel.accessAllowed ? 'block' : 'none';\n",
              "\n",
              "        async function convertToInteractive(key) {\n",
              "          const element = document.querySelector('#df-3c7dccd4-7bdd-4981-86e2-b116be3f1dbc');\n",
              "          const dataTable =\n",
              "            await google.colab.kernel.invokeFunction('convertToInteractive',\n",
              "                                                     [key], {});\n",
              "          if (!dataTable) return;\n",
              "\n",
              "          const docLinkHtml = 'Like what you see? Visit the ' +\n",
              "            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n",
              "            + ' to learn more about interactive tables.';\n",
              "          element.innerHTML = '';\n",
              "          dataTable['output_type'] = 'display_data';\n",
              "          await google.colab.output.renderOutput(dataTable, element);\n",
              "          const docLink = document.createElement('div');\n",
              "          docLink.innerHTML = docLinkHtml;\n",
              "          element.appendChild(docLink);\n",
              "        }\n",
              "      </script>\n",
              "    </div>\n",
              "  </div>\n",
              "  "
            ]
          },
          "metadata": {}
        }
      ]
    },
    {
      "cell_type": "markdown",
      "source": [
        "Atrial Fibralation is encoded as \"AF (Atrial Fibrilation)\". Let's extract these entries\n",
        "\n"
      ],
      "metadata": {
        "id": "1XVElzUV5w51"
      }
    },
    {
      "cell_type": "code",
      "source": [
        "# aggregate here\n",
        "df = run_query(f'''\n",
        "SELECT ce.subject_id, ce.stay_id, ce.charttime, di.label, ce.value, b.heart_rhythm_count\n",
        ", FIRST_VALUE(ce.value) OVER (PARTITION BY ce.stay_id ORDER BY ce.charttime) AS first_heart_rhythm\n",
        "FROM `physionet-data.mimic_icu.chartevents` ce\n",
        "INNER JOIN `physionet-data.mimic_icu.d_items` di\n",
        "    ON ce.itemid = di.itemid\n",
        "INNER JOIN (SELECT value, count(value) as heart_rhythm_count\n",
        "              FROM `physionet-data.mimic_icu.chartevents`\n",
        "              WHERE subject_id IN ({id_str})\n",
        "              GROUP BY value) b ON ce.value = b.value\n",
        "WHERE ce.subject_id IN ({id_str}) AND ce.itemid = 220048 AND ce.value = \"AF (Atrial Fibrillation)\"\n",
        "''')\n",
        "df.sort_values('subject_id', inplace=True)\n",
        "display(df)"
      ],
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/",
          "height": 424
        },
        "id": "ysaNT50L5-ze",
        "outputId": "9e37d80a-2441-4b5e-c38f-1ae71abac6cb"
      },
      "execution_count": null,
      "outputs": [
        {
          "output_type": "display_data",
          "data": {
            "text/plain": [
              "     subject_id   stay_id           charttime         label  \\\n",
              "95     10002443  35044219 2183-10-18 22:00:00  Heart Rhythm   \n",
              "94     10002443  35044219 2183-10-18 21:00:00  Heart Rhythm   \n",
              "93     10002443  35044219 2183-10-18 20:00:00  Heart Rhythm   \n",
              "0      10002495  36753294 2141-05-23 20:00:00  Heart Rhythm   \n",
              "68     10002495  36753294 2141-05-26 20:00:00  Heart Rhythm   \n",
              "..          ...       ...                 ...           ...   \n",
              "368    10003400  32128372 2137-03-05 05:00:00  Heart Rhythm   \n",
              "358    10003400  32128372 2137-03-04 19:00:00  Heart Rhythm   \n",
              "897    10003400  38383343 2137-09-02 16:00:00  Heart Rhythm   \n",
              "97     10005866  34170353 2149-10-03 14:00:00  Heart Rhythm   \n",
              "96     10005866  34170353 2149-10-03 13:00:00  Heart Rhythm   \n",
              "\n",
              "                        value  heart_rhythm_count        first_heart_rhythm  \n",
              "95   AF (Atrial Fibrillation)                 898  AF (Atrial Fibrillation)  \n",
              "94   AF (Atrial Fibrillation)                 898  AF (Atrial Fibrillation)  \n",
              "93   AF (Atrial Fibrillation)                 898  AF (Atrial Fibrillation)  \n",
              "0    AF (Atrial Fibrillation)                 898  AF (Atrial Fibrillation)  \n",
              "68   AF (Atrial Fibrillation)                 898  AF (Atrial Fibrillation)  \n",
              "..                        ...                 ...                       ...  \n",
              "368  AF (Atrial Fibrillation)                 898  AF (Atrial Fibrillation)  \n",
              "358  AF (Atrial Fibrillation)                 898  AF (Atrial Fibrillation)  \n",
              "897  AF (Atrial Fibrillation)                 898  AF (Atrial Fibrillation)  \n",
              "97   AF (Atrial Fibrillation)                 898  AF (Atrial Fibrillation)  \n",
              "96   AF (Atrial Fibrillation)                 898  AF (Atrial Fibrillation)  \n",
              "\n",
              "[898 rows x 7 columns]"
            ],
            "text/html": [
              "\n",
              "  <div id=\"df-b8748890-4123-43d6-b770-cee513badb14\">\n",
              "    <div class=\"colab-df-container\">\n",
              "      <div>\n",
              "<style scoped>\n",
              "    .dataframe tbody tr th:only-of-type {\n",
              "        vertical-align: middle;\n",
              "    }\n",
              "\n",
              "    .dataframe tbody tr th {\n",
              "        vertical-align: top;\n",
              "    }\n",
              "\n",
              "    .dataframe thead th {\n",
              "        text-align: right;\n",
              "    }\n",
              "</style>\n",
              "<table border=\"1\" class=\"dataframe\">\n",
              "  <thead>\n",
              "    <tr style=\"text-align: right;\">\n",
              "      <th></th>\n",
              "      <th>subject_id</th>\n",
              "      <th>stay_id</th>\n",
              "      <th>charttime</th>\n",
              "      <th>label</th>\n",
              "      <th>value</th>\n",
              "      <th>heart_rhythm_count</th>\n",
              "      <th>first_heart_rhythm</th>\n",
              "    </tr>\n",
              "  </thead>\n",
              "  <tbody>\n",
              "    <tr>\n",
              "      <th>95</th>\n",
              "      <td>10002443</td>\n",
              "      <td>35044219</td>\n",
              "      <td>2183-10-18 22:00:00</td>\n",
              "      <td>Heart Rhythm</td>\n",
              "      <td>AF (Atrial Fibrillation)</td>\n",
              "      <td>898</td>\n",
              "      <td>AF (Atrial Fibrillation)</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>94</th>\n",
              "      <td>10002443</td>\n",
              "      <td>35044219</td>\n",
              "      <td>2183-10-18 21:00:00</td>\n",
              "      <td>Heart Rhythm</td>\n",
              "      <td>AF (Atrial Fibrillation)</td>\n",
              "      <td>898</td>\n",
              "      <td>AF (Atrial Fibrillation)</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>93</th>\n",
              "      <td>10002443</td>\n",
              "      <td>35044219</td>\n",
              "      <td>2183-10-18 20:00:00</td>\n",
              "      <td>Heart Rhythm</td>\n",
              "      <td>AF (Atrial Fibrillation)</td>\n",
              "      <td>898</td>\n",
              "      <td>AF (Atrial Fibrillation)</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>0</th>\n",
              "      <td>10002495</td>\n",
              "      <td>36753294</td>\n",
              "      <td>2141-05-23 20:00:00</td>\n",
              "      <td>Heart Rhythm</td>\n",
              "      <td>AF (Atrial Fibrillation)</td>\n",
              "      <td>898</td>\n",
              "      <td>AF (Atrial Fibrillation)</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>68</th>\n",
              "      <td>10002495</td>\n",
              "      <td>36753294</td>\n",
              "      <td>2141-05-26 20:00:00</td>\n",
              "      <td>Heart Rhythm</td>\n",
              "      <td>AF (Atrial Fibrillation)</td>\n",
              "      <td>898</td>\n",
              "      <td>AF (Atrial Fibrillation)</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>...</th>\n",
              "      <td>...</td>\n",
              "      <td>...</td>\n",
              "      <td>...</td>\n",
              "      <td>...</td>\n",
              "      <td>...</td>\n",
              "      <td>...</td>\n",
              "      <td>...</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>368</th>\n",
              "      <td>10003400</td>\n",
              "      <td>32128372</td>\n",
              "      <td>2137-03-05 05:00:00</td>\n",
              "      <td>Heart Rhythm</td>\n",
              "      <td>AF (Atrial Fibrillation)</td>\n",
              "      <td>898</td>\n",
              "      <td>AF (Atrial Fibrillation)</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>358</th>\n",
              "      <td>10003400</td>\n",
              "      <td>32128372</td>\n",
              "      <td>2137-03-04 19:00:00</td>\n",
              "      <td>Heart Rhythm</td>\n",
              "      <td>AF (Atrial Fibrillation)</td>\n",
              "      <td>898</td>\n",
              "      <td>AF (Atrial Fibrillation)</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>897</th>\n",
              "      <td>10003400</td>\n",
              "      <td>38383343</td>\n",
              "      <td>2137-09-02 16:00:00</td>\n",
              "      <td>Heart Rhythm</td>\n",
              "      <td>AF (Atrial Fibrillation)</td>\n",
              "      <td>898</td>\n",
              "      <td>AF (Atrial Fibrillation)</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>97</th>\n",
              "      <td>10005866</td>\n",
              "      <td>34170353</td>\n",
              "      <td>2149-10-03 14:00:00</td>\n",
              "      <td>Heart Rhythm</td>\n",
              "      <td>AF (Atrial Fibrillation)</td>\n",
              "      <td>898</td>\n",
              "      <td>AF (Atrial Fibrillation)</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>96</th>\n",
              "      <td>10005866</td>\n",
              "      <td>34170353</td>\n",
              "      <td>2149-10-03 13:00:00</td>\n",
              "      <td>Heart Rhythm</td>\n",
              "      <td>AF (Atrial Fibrillation)</td>\n",
              "      <td>898</td>\n",
              "      <td>AF (Atrial Fibrillation)</td>\n",
              "    </tr>\n",
              "  </tbody>\n",
              "</table>\n",
              "<p>898 rows Ã— 7 columns</p>\n",
              "</div>\n",
              "      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-b8748890-4123-43d6-b770-cee513badb14')\"\n",
              "              title=\"Convert this dataframe to an interactive table.\"\n",
              "              style=\"display:none;\">\n",
              "        \n",
              "  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n",
              "       width=\"24px\">\n",
              "    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n",
              "    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n",
              "  </svg>\n",
              "      </button>\n",
              "      \n",
              "  <style>\n",
              "    .colab-df-container {\n",
              "      display:flex;\n",
              "      flex-wrap:wrap;\n",
              "      gap: 12px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert {\n",
              "      background-color: #E8F0FE;\n",
              "      border: none;\n",
              "      border-radius: 50%;\n",
              "      cursor: pointer;\n",
              "      display: none;\n",
              "      fill: #1967D2;\n",
              "      height: 32px;\n",
              "      padding: 0 0 0 0;\n",
              "      width: 32px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert:hover {\n",
              "      background-color: #E2EBFA;\n",
              "      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n",
              "      fill: #174EA6;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert {\n",
              "      background-color: #3B4455;\n",
              "      fill: #D2E3FC;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert:hover {\n",
              "      background-color: #434B5C;\n",
              "      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n",
              "      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n",
              "      fill: #FFFFFF;\n",
              "    }\n",
              "  </style>\n",
              "\n",
              "      <script>\n",
              "        const buttonEl =\n",
              "          document.querySelector('#df-b8748890-4123-43d6-b770-cee513badb14 button.colab-df-convert');\n",
              "        buttonEl.style.display =\n",
              "          google.colab.kernel.accessAllowed ? 'block' : 'none';\n",
              "\n",
              "        async function convertToInteractive(key) {\n",
              "          const element = document.querySelector('#df-b8748890-4123-43d6-b770-cee513badb14');\n",
              "          const dataTable =\n",
              "            await google.colab.kernel.invokeFunction('convertToInteractive',\n",
              "                                                     [key], {});\n",
              "          if (!dataTable) return;\n",
              "\n",
              "          const docLinkHtml = 'Like what you see? Visit the ' +\n",
              "            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n",
              "            + ' to learn more about interactive tables.';\n",
              "          element.innerHTML = '';\n",
              "          dataTable['output_type'] = 'display_data';\n",
              "          await google.colab.output.renderOutput(dataTable, element);\n",
              "          const docLink = document.createElement('div');\n",
              "          docLink.innerHTML = docLinkHtml;\n",
              "          element.appendChild(docLink);\n",
              "        }\n",
              "      </script>\n",
              "    </div>\n",
              "  </div>\n",
              "  "
            ]
          },
          "metadata": {}
        }
      ]
    },
    {
      "cell_type": "markdown",
      "source": [
        "Question 6: Copy the cohort extraction query from above. Using in-line views as necessary, add the following exclusions:\n",
        "\n",
        "* Exclude patients whose first heart rate is above 110.\n",
        "* Exclude patients whose first heart rhythm is atrial fibrillation."
      ],
      "metadata": {
        "id": "eazoRfw2Umu-"
      }
    },
    {
      "cell_type": "code",
      "source": [
        "df = run_query(f'''\n",
        "WITH rates AS\n",
        "(\n",
        "  SELECT DISTINCT a.stay_id, a.first_heart_rate\n",
        "  , CASE WHEN a.first_heart_rate > 110 THEN 1 ELSE 0 END AS exclude_first_heart_rate\n",
        "  FROM\n",
        "  (SELECT ce.subject_id, ce.stay_id, ce.charttime, ce.valuenum\n",
        "  , FIRST_VALUE(ce.valuenum) OVER (PARTITION BY ce.stay_id ORDER BY ce.charttime) AS first_heart_rate\n",
        "  FROM `physionet-data.mimic_icu.chartevents` ce\n",
        "  WHERE ce.subject_id IN ({id_str}) AND ce.itemid = 220045) a\n",
        ")\n",
        "SELECT rh.stay_id, rt.first_heart_rate, rt.exclude_first_heart_rate, rh.first_heart_rhythm, rh.exclude_first_heart_rhythm\n",
        "FROM  (SELECT DISTINCT b.stay_id, b.first_heart_rhythm\n",
        "      , CASE WHEN b.first_heart_rhythm = \"AF (Atrial Fibrillation)\" THEN 1 ELSE 0 END AS exclude_first_heart_rhythm\n",
        "      FROM\n",
        "      (SELECT ce.subject_id, ce.stay_id, ce.charttime, ce.value\n",
        "      , FIRST_VALUE(ce.value) OVER (PARTITION BY ce.stay_id ORDER BY ce.charttime) AS first_heart_rhythm\n",
        "      FROM `physionet-data.mimic_icu.chartevents` ce\n",
        "      INNER JOIN `physionet-data.mimic_icu.d_items` di\n",
        "            ON ce.itemid = di.itemid\n",
        "      WHERE ce.subject_id IN ({id_str}) AND ce.itemid = 220048) b) rh\n",
        "INNER JOIN rates rt\n",
        "    ON rt.stay_id = rh.stay_id\n",
        "''')\n",
        "display(df)\n",
        "\n"
      ],
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/",
          "height": 332
        },
        "id": "C6Zk4s30SkrA",
        "outputId": "3e256956-6885-4772-b11b-39285eb25398"
      },
      "execution_count": null,
      "outputs": [
        {
          "output_type": "display_data",
          "data": {
            "text/plain": [
              "    stay_id  first_heart_rate  exclude_first_heart_rate  \\\n",
              "0  38383343             104.0                         0   \n",
              "1  36753294             114.0                         1   \n",
              "2  34577403              97.0                         0   \n",
              "3  35044219             106.0                         0   \n",
              "4  32128372             113.0                         1   \n",
              "5  37510196              38.0                         0   \n",
              "6  34170353              95.0                         0   \n",
              "7  39638202              88.0                         0   \n",
              "8  39553978              91.0                         0   \n",
              "\n",
              "         first_heart_rhythm  exclude_first_heart_rhythm  \n",
              "0  AF (Atrial Fibrillation)                           1  \n",
              "1   ST (Sinus Tachycardia)                            0  \n",
              "2  AF (Atrial Fibrillation)                           1  \n",
              "3         SR (Sinus Rhythm)                           0  \n",
              "4  AF (Atrial Fibrillation)                           1  \n",
              "5    SB (Sinus Bradycardia)                           0  \n",
              "6         SR (Sinus Rhythm)                           0  \n",
              "7         SR (Sinus Rhythm)                           0  \n",
              "8         SR (Sinus Rhythm)                           0  "
            ],
            "text/html": [
              "\n",
              "  <div id=\"df-c0a0d44b-a992-4887-952f-e44853b78009\">\n",
              "    <div class=\"colab-df-container\">\n",
              "      <div>\n",
              "<style scoped>\n",
              "    .dataframe tbody tr th:only-of-type {\n",
              "        vertical-align: middle;\n",
              "    }\n",
              "\n",
              "    .dataframe tbody tr th {\n",
              "        vertical-align: top;\n",
              "    }\n",
              "\n",
              "    .dataframe thead th {\n",
              "        text-align: right;\n",
              "    }\n",
              "</style>\n",
              "<table border=\"1\" class=\"dataframe\">\n",
              "  <thead>\n",
              "    <tr style=\"text-align: right;\">\n",
              "      <th></th>\n",
              "      <th>stay_id</th>\n",
              "      <th>first_heart_rate</th>\n",
              "      <th>exclude_first_heart_rate</th>\n",
              "      <th>first_heart_rhythm</th>\n",
              "      <th>exclude_first_heart_rhythm</th>\n",
              "    </tr>\n",
              "  </thead>\n",
              "  <tbody>\n",
              "    <tr>\n",
              "      <th>0</th>\n",
              "      <td>38383343</td>\n",
              "      <td>104.0</td>\n",
              "      <td>0</td>\n",
              "      <td>AF (Atrial Fibrillation)</td>\n",
              "      <td>1</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>1</th>\n",
              "      <td>36753294</td>\n",
              "      <td>114.0</td>\n",
              "      <td>1</td>\n",
              "      <td>ST (Sinus Tachycardia)</td>\n",
              "      <td>0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>2</th>\n",
              "      <td>34577403</td>\n",
              "      <td>97.0</td>\n",
              "      <td>0</td>\n",
              "      <td>AF (Atrial Fibrillation)</td>\n",
              "      <td>1</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>3</th>\n",
              "      <td>35044219</td>\n",
              "      <td>106.0</td>\n",
              "      <td>0</td>\n",
              "      <td>SR (Sinus Rhythm)</td>\n",
              "      <td>0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>4</th>\n",
              "      <td>32128372</td>\n",
              "      <td>113.0</td>\n",
              "      <td>1</td>\n",
              "      <td>AF (Atrial Fibrillation)</td>\n",
              "      <td>1</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>5</th>\n",
              "      <td>37510196</td>\n",
              "      <td>38.0</td>\n",
              "      <td>0</td>\n",
              "      <td>SB (Sinus Bradycardia)</td>\n",
              "      <td>0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>6</th>\n",
              "      <td>34170353</td>\n",
              "      <td>95.0</td>\n",
              "      <td>0</td>\n",
              "      <td>SR (Sinus Rhythm)</td>\n",
              "      <td>0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>7</th>\n",
              "      <td>39638202</td>\n",
              "      <td>88.0</td>\n",
              "      <td>0</td>\n",
              "      <td>SR (Sinus Rhythm)</td>\n",
              "      <td>0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>8</th>\n",
              "      <td>39553978</td>\n",
              "      <td>91.0</td>\n",
              "      <td>0</td>\n",
              "      <td>SR (Sinus Rhythm)</td>\n",
              "      <td>0</td>\n",
              "    </tr>\n",
              "  </tbody>\n",
              "</table>\n",
              "</div>\n",
              "      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-c0a0d44b-a992-4887-952f-e44853b78009')\"\n",
              "              title=\"Convert this dataframe to an interactive table.\"\n",
              "              style=\"display:none;\">\n",
              "        \n",
              "  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n",
              "       width=\"24px\">\n",
              "    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n",
              "    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n",
              "  </svg>\n",
              "      </button>\n",
              "      \n",
              "  <style>\n",
              "    .colab-df-container {\n",
              "      display:flex;\n",
              "      flex-wrap:wrap;\n",
              "      gap: 12px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert {\n",
              "      background-color: #E8F0FE;\n",
              "      border: none;\n",
              "      border-radius: 50%;\n",
              "      cursor: pointer;\n",
              "      display: none;\n",
              "      fill: #1967D2;\n",
              "      height: 32px;\n",
              "      padding: 0 0 0 0;\n",
              "      width: 32px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert:hover {\n",
              "      background-color: #E2EBFA;\n",
              "      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n",
              "      fill: #174EA6;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert {\n",
              "      background-color: #3B4455;\n",
              "      fill: #D2E3FC;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert:hover {\n",
              "      background-color: #434B5C;\n",
              "      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n",
              "      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n",
              "      fill: #FFFFFF;\n",
              "    }\n",
              "  </style>\n",
              "\n",
              "      <script>\n",
              "        const buttonEl =\n",
              "          document.querySelector('#df-c0a0d44b-a992-4887-952f-e44853b78009 button.colab-df-convert');\n",
              "        buttonEl.style.display =\n",
              "          google.colab.kernel.accessAllowed ? 'block' : 'none';\n",
              "\n",
              "        async function convertToInteractive(key) {\n",
              "          const element = document.querySelector('#df-c0a0d44b-a992-4887-952f-e44853b78009');\n",
              "          const dataTable =\n",
              "            await google.colab.kernel.invokeFunction('convertToInteractive',\n",
              "                                                     [key], {});\n",
              "          if (!dataTable) return;\n",
              "\n",
              "          const docLinkHtml = 'Like what you see? Visit the ' +\n",
              "            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n",
              "            + ' to learn more about interactive tables.';\n",
              "          element.innerHTML = '';\n",
              "          dataTable['output_type'] = 'display_data';\n",
              "          await google.colab.output.renderOutput(dataTable, element);\n",
              "          const docLink = document.createElement('div');\n",
              "          docLink.innerHTML = docLinkHtml;\n",
              "          element.appendChild(docLink);\n",
              "        }\n",
              "      </script>\n",
              "    </div>\n",
              "  </div>\n",
              "  "
            ]
          },
          "metadata": {}
        }
      ]
    },
    {
      "cell_type": "code",
      "source": [
        "df = run_query(f'''\n",
        "WITH heart AS\n",
        "(\n",
        "  WITH rates AS\n",
        "  (\n",
        "    SELECT DISTINCT a.stay_id, a.first_heart_rate\n",
        "    , CASE WHEN a.first_heart_rate > 110 THEN 1 ELSE 0 END AS exclude_first_heart_rate\n",
        "    FROM\n",
        "    (SELECT ce.subject_id, ce.stay_id, ce.charttime, ce.valuenum\n",
        "    , FIRST_VALUE(ce.valuenum) OVER (PARTITION BY ce.stay_id ORDER BY ce.charttime) AS first_heart_rate\n",
        "    FROM `physionet-data.mimic_icu.chartevents` ce\n",
        "    WHERE ce.subject_id IN ({id_str}) AND ce.itemid = 220045) a\n",
        "  )\n",
        "  SELECT rh.stay_id, rt.first_heart_rate, rt.exclude_first_heart_rate, rh.first_heart_rhythm, rh.exclude_first_heart_rhythm\n",
        "  FROM  (SELECT DISTINCT b.stay_id, b.first_heart_rhythm\n",
        "        , CASE WHEN b.first_heart_rhythm = \"AF (Atrial Fibrillation)\" THEN 1 ELSE 0 END AS exclude_first_heart_rhythm\n",
        "        FROM\n",
        "        (SELECT ce.subject_id, ce.stay_id, ce.charttime, ce.value\n",
        "        , FIRST_VALUE(ce.value) OVER (PARTITION BY ce.stay_id ORDER BY ce.charttime) AS first_heart_rhythm\n",
        "        FROM `physionet-data.mimic_icu.chartevents` ce\n",
        "        INNER JOIN `physionet-data.mimic_icu.d_items` di\n",
        "              ON ce.itemid = di.itemid\n",
        "        WHERE ce.subject_id IN ({id_str}) AND ce.itemid = 220048) b) rh\n",
        "  INNER JOIN rates rt\n",
        "      ON rt.stay_id = rh.stay_id\n",
        ")\n",
        "\n",
        "SELECT ie.subject_id, ie.hadm_id, ie.stay_id\n",
        ", CASE WHEN age.anchor_age >= 16 THEN 0 ELSE 1 END AS exclude_non_adult\n",
        ", CASE WHEN ie.LOS > 4/24 THEN 0 ELSE 1 END AS exclude_short_stays\n",
        ", CASE WHEN ROW_NUMBER() OVER (PARTITION BY ie.subject_id ORDER BY ie.intime) = 1 THEN 0 ELSE 1 END AS exclude_readmission\n",
        ", CASE WHEN cd.admission_location = \"TRANSFER FROM HOSPITAL\" THEN 1 ELSE 0 END as exclude_other_hospitals\n",
        ", ht.exclude_first_heart_rate\n",
        ", ht.exclude_first_heart_rhythm\n",
        "FROM `physionet-data.mimic_icu.icustays` ie\n",
        "INNER JOIN `physionet-data.mimic_derived.age` age\n",
        "    ON ie.hadm_id = age.hadm_id\n",
        "LEFT JOIN `physionet-data.mimic_core.admissions`  cd\n",
        "    ON ie.hadm_id = cd.hadm_id\n",
        "LEFT JOIN heart ht\n",
        "    ON ht.stay_id = ie.stay_id\n",
        "WHERE ie.subject_id IN ({id_str})\n",
        "''')\n",
        "# note \"inplace\" -> this argument tells the dataframe to be modified in-place\n",
        "# i.e., we don't need to do df = df.sort_values(), we can just call the function as-is\n",
        "# be careful with inplace! if you do:\n",
        "#   df = df.sort_values(inplace=True), it will set `df` to None\n",
        "# ... because you're using it wrong (either re-assign the variable, or use the inplace arg, but not both!)\n",
        "df.sort_values('subject_id', inplace=True)\n",
        "display(df)"
      ],
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/",
          "height": 332
        },
        "id": "qvZrGkbhQ2sM",
        "outputId": "ff86c5ad-ba87-409d-a038-c38a1c346019"
      },
      "execution_count": null,
      "outputs": [
        {
          "output_type": "display_data",
          "data": {
            "text/plain": [
              "   subject_id   hadm_id   stay_id  exclude_non_adult  exclude_short_stays  \\\n",
              "6    10000032  29079034  39553978                  0                    0   \n",
              "7    10001884  26184834  37510196                  0                    0   \n",
              "0    10002223  22494570  39638202                  0                    0   \n",
              "4    10002443  21329021  35044219                  0                    0   \n",
              "8    10002495  24982426  36753294                  0                    0   \n",
              "1    10003400  20214994  32128372                  0                    0   \n",
              "2    10003400  23559586  34577403                  0                    0   \n",
              "3    10003400  23559586  38383343                  0                    0   \n",
              "5    10005866  20364112  34170353                  0                    0   \n",
              "\n",
              "   exclude_readmission  exclude_other_hospitals  exclude_first_heart_rate  \\\n",
              "6                    0                        0                         0   \n",
              "7                    0                        0                         0   \n",
              "0                    0                        0                         0   \n",
              "4                    0                        1                         0   \n",
              "8                    0                        1                         1   \n",
              "1                    0                        0                         1   \n",
              "2                    1                        1                         0   \n",
              "3                    1                        1                         0   \n",
              "5                    0                        0                         0   \n",
              "\n",
              "   exclude_first_heart_rhythm  \n",
              "6                           0  \n",
              "7                           0  \n",
              "0                           0  \n",
              "4                           0  \n",
              "8                           0  \n",
              "1                           1  \n",
              "2                           1  \n",
              "3                           1  \n",
              "5                           0  "
            ],
            "text/html": [
              "\n",
              "  <div id=\"df-a9ce58eb-da78-4663-a880-8db44c5106f9\">\n",
              "    <div class=\"colab-df-container\">\n",
              "      <div>\n",
              "<style scoped>\n",
              "    .dataframe tbody tr th:only-of-type {\n",
              "        vertical-align: middle;\n",
              "    }\n",
              "\n",
              "    .dataframe tbody tr th {\n",
              "        vertical-align: top;\n",
              "    }\n",
              "\n",
              "    .dataframe thead th {\n",
              "        text-align: right;\n",
              "    }\n",
              "</style>\n",
              "<table border=\"1\" class=\"dataframe\">\n",
              "  <thead>\n",
              "    <tr style=\"text-align: right;\">\n",
              "      <th></th>\n",
              "      <th>subject_id</th>\n",
              "      <th>hadm_id</th>\n",
              "      <th>stay_id</th>\n",
              "      <th>exclude_non_adult</th>\n",
              "      <th>exclude_short_stays</th>\n",
              "      <th>exclude_readmission</th>\n",
              "      <th>exclude_other_hospitals</th>\n",
              "      <th>exclude_first_heart_rate</th>\n",
              "      <th>exclude_first_heart_rhythm</th>\n",
              "    </tr>\n",
              "  </thead>\n",
              "  <tbody>\n",
              "    <tr>\n",
              "      <th>6</th>\n",
              "      <td>10000032</td>\n",
              "      <td>29079034</td>\n",
              "      <td>39553978</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>7</th>\n",
              "      <td>10001884</td>\n",
              "      <td>26184834</td>\n",
              "      <td>37510196</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>0</th>\n",
              "      <td>10002223</td>\n",
              "      <td>22494570</td>\n",
              "      <td>39638202</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>4</th>\n",
              "      <td>10002443</td>\n",
              "      <td>21329021</td>\n",
              "      <td>35044219</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>1</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>8</th>\n",
              "      <td>10002495</td>\n",
              "      <td>24982426</td>\n",
              "      <td>36753294</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>1</td>\n",
              "      <td>1</td>\n",
              "      <td>0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>1</th>\n",
              "      <td>10003400</td>\n",
              "      <td>20214994</td>\n",
              "      <td>32128372</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>1</td>\n",
              "      <td>1</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>2</th>\n",
              "      <td>10003400</td>\n",
              "      <td>23559586</td>\n",
              "      <td>34577403</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>1</td>\n",
              "      <td>1</td>\n",
              "      <td>0</td>\n",
              "      <td>1</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>3</th>\n",
              "      <td>10003400</td>\n",
              "      <td>23559586</td>\n",
              "      <td>38383343</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>1</td>\n",
              "      <td>1</td>\n",
              "      <td>0</td>\n",
              "      <td>1</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>5</th>\n",
              "      <td>10005866</td>\n",
              "      <td>20364112</td>\n",
              "      <td>34170353</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "    </tr>\n",
              "  </tbody>\n",
              "</table>\n",
              "</div>\n",
              "      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-a9ce58eb-da78-4663-a880-8db44c5106f9')\"\n",
              "              title=\"Convert this dataframe to an interactive table.\"\n",
              "              style=\"display:none;\">\n",
              "        \n",
              "  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n",
              "       width=\"24px\">\n",
              "    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n",
              "    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n",
              "  </svg>\n",
              "      </button>\n",
              "      \n",
              "  <style>\n",
              "    .colab-df-container {\n",
              "      display:flex;\n",
              "      flex-wrap:wrap;\n",
              "      gap: 12px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert {\n",
              "      background-color: #E8F0FE;\n",
              "      border: none;\n",
              "      border-radius: 50%;\n",
              "      cursor: pointer;\n",
              "      display: none;\n",
              "      fill: #1967D2;\n",
              "      height: 32px;\n",
              "      padding: 0 0 0 0;\n",
              "      width: 32px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert:hover {\n",
              "      background-color: #E2EBFA;\n",
              "      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n",
              "      fill: #174EA6;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert {\n",
              "      background-color: #3B4455;\n",
              "      fill: #D2E3FC;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert:hover {\n",
              "      background-color: #434B5C;\n",
              "      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n",
              "      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n",
              "      fill: #FFFFFF;\n",
              "    }\n",
              "  </style>\n",
              "\n",
              "      <script>\n",
              "        const buttonEl =\n",
              "          document.querySelector('#df-a9ce58eb-da78-4663-a880-8db44c5106f9 button.colab-df-convert');\n",
              "        buttonEl.style.display =\n",
              "          google.colab.kernel.accessAllowed ? 'block' : 'none';\n",
              "\n",
              "        async function convertToInteractive(key) {\n",
              "          const element = document.querySelector('#df-a9ce58eb-da78-4663-a880-8db44c5106f9');\n",
              "          const dataTable =\n",
              "            await google.colab.kernel.invokeFunction('convertToInteractive',\n",
              "                                                     [key], {});\n",
              "          if (!dataTable) return;\n",
              "\n",
              "          const docLinkHtml = 'Like what you see? Visit the ' +\n",
              "            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n",
              "            + ' to learn more about interactive tables.';\n",
              "          element.innerHTML = '';\n",
              "          dataTable['output_type'] = 'display_data';\n",
              "          await google.colab.output.renderOutput(dataTable, element);\n",
              "          const docLink = document.createElement('div');\n",
              "          docLink.innerHTML = docLinkHtml;\n",
              "          element.appendChild(docLink);\n",
              "        }\n",
              "      </script>\n",
              "    </div>\n",
              "  </div>\n",
              "  "
            ]
          },
          "metadata": {}
        }
      ]
    },
    {
      "cell_type": "markdown",
      "source": [
        "Question 7: Continuing with the above query, filter out patients with chronic atrial fibrillation. Hint: chronic atrial fibrillation is billable by the hospital. You should only need one data table and one dimension table (`d_` table) for this exclusion."
      ],
      "metadata": {
        "id": "I7VswJaYBXHk"
      }
    },
    {
      "cell_type": "code",
      "source": [
        "df = run_query(f'''\n",
        "SELECT DISTINCT icd_code, long_title\n",
        "FROM `physionet-data.mimic_hosp.d_icd_diagnoses`\n",
        "WHERE long_title LIKE \"%atrial%\"\n",
        "''')\n",
        "display(df)"
      ],
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/",
          "height": 520
        },
        "id": "VDQPX36vdLlP",
        "outputId": "f1bef408-e457-4868-fa55-0f1b92624b08"
      },
      "execution_count": null,
      "outputs": [
        {
          "output_type": "display_data",
          "data": {
            "text/plain": [
              "   icd_code                                         long_title\n",
              "0     42781                        Sinoatrial node dysfunction\n",
              "1      7455          Ostium secundum type atrial septal defect\n",
              "2      I480                     Paroxysmal atrial fibrillation\n",
              "3      I481                     Persistent atrial fibrillation\n",
              "4     I4811        Longstanding persistent atrial fibrillation\n",
              "5     I4819               Other persistent atrial fibrillation\n",
              "6      I482                        Chronic atrial fibrillation\n",
              "7     I4820           Chronic atrial fibrillation, unspecified\n",
              "8     I4821                      Permanent atrial fibrillation\n",
              "9      I483                             Typical atrial flutter\n",
              "10     I484                            Atypical atrial flutter\n",
              "11     I489  Unspecified atrial fibrillation and atrial flu...\n",
              "12    I4891                    Unspecified atrial fibrillation\n",
              "13    I4892                         Unspecified atrial flutter\n",
              "14     Q206                     Isomerism of atrial appendages"
            ],
            "text/html": [
              "\n",
              "  <div id=\"df-0a3bd11d-5650-40b6-a2a0-1eee248586fa\">\n",
              "    <div class=\"colab-df-container\">\n",
              "      <div>\n",
              "<style scoped>\n",
              "    .dataframe tbody tr th:only-of-type {\n",
              "        vertical-align: middle;\n",
              "    }\n",
              "\n",
              "    .dataframe tbody tr th {\n",
              "        vertical-align: top;\n",
              "    }\n",
              "\n",
              "    .dataframe thead th {\n",
              "        text-align: right;\n",
              "    }\n",
              "</style>\n",
              "<table border=\"1\" class=\"dataframe\">\n",
              "  <thead>\n",
              "    <tr style=\"text-align: right;\">\n",
              "      <th></th>\n",
              "      <th>icd_code</th>\n",
              "      <th>long_title</th>\n",
              "    </tr>\n",
              "  </thead>\n",
              "  <tbody>\n",
              "    <tr>\n",
              "      <th>0</th>\n",
              "      <td>42781</td>\n",
              "      <td>Sinoatrial node dysfunction</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>1</th>\n",
              "      <td>7455</td>\n",
              "      <td>Ostium secundum type atrial septal defect</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>2</th>\n",
              "      <td>I480</td>\n",
              "      <td>Paroxysmal atrial fibrillation</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>3</th>\n",
              "      <td>I481</td>\n",
              "      <td>Persistent atrial fibrillation</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>4</th>\n",
              "      <td>I4811</td>\n",
              "      <td>Longstanding persistent atrial fibrillation</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>5</th>\n",
              "      <td>I4819</td>\n",
              "      <td>Other persistent atrial fibrillation</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>6</th>\n",
              "      <td>I482</td>\n",
              "      <td>Chronic atrial fibrillation</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>7</th>\n",
              "      <td>I4820</td>\n",
              "      <td>Chronic atrial fibrillation, unspecified</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>8</th>\n",
              "      <td>I4821</td>\n",
              "      <td>Permanent atrial fibrillation</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>9</th>\n",
              "      <td>I483</td>\n",
              "      <td>Typical atrial flutter</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>10</th>\n",
              "      <td>I484</td>\n",
              "      <td>Atypical atrial flutter</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>11</th>\n",
              "      <td>I489</td>\n",
              "      <td>Unspecified atrial fibrillation and atrial flu...</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>12</th>\n",
              "      <td>I4891</td>\n",
              "      <td>Unspecified atrial fibrillation</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>13</th>\n",
              "      <td>I4892</td>\n",
              "      <td>Unspecified atrial flutter</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>14</th>\n",
              "      <td>Q206</td>\n",
              "      <td>Isomerism of atrial appendages</td>\n",
              "    </tr>\n",
              "  </tbody>\n",
              "</table>\n",
              "</div>\n",
              "      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-0a3bd11d-5650-40b6-a2a0-1eee248586fa')\"\n",
              "              title=\"Convert this dataframe to an interactive table.\"\n",
              "              style=\"display:none;\">\n",
              "        \n",
              "  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n",
              "       width=\"24px\">\n",
              "    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n",
              "    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n",
              "  </svg>\n",
              "      </button>\n",
              "      \n",
              "  <style>\n",
              "    .colab-df-container {\n",
              "      display:flex;\n",
              "      flex-wrap:wrap;\n",
              "      gap: 12px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert {\n",
              "      background-color: #E8F0FE;\n",
              "      border: none;\n",
              "      border-radius: 50%;\n",
              "      cursor: pointer;\n",
              "      display: none;\n",
              "      fill: #1967D2;\n",
              "      height: 32px;\n",
              "      padding: 0 0 0 0;\n",
              "      width: 32px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert:hover {\n",
              "      background-color: #E2EBFA;\n",
              "      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n",
              "      fill: #174EA6;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert {\n",
              "      background-color: #3B4455;\n",
              "      fill: #D2E3FC;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert:hover {\n",
              "      background-color: #434B5C;\n",
              "      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n",
              "      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n",
              "      fill: #FFFFFF;\n",
              "    }\n",
              "  </style>\n",
              "\n",
              "      <script>\n",
              "        const buttonEl =\n",
              "          document.querySelector('#df-0a3bd11d-5650-40b6-a2a0-1eee248586fa button.colab-df-convert');\n",
              "        buttonEl.style.display =\n",
              "          google.colab.kernel.accessAllowed ? 'block' : 'none';\n",
              "\n",
              "        async function convertToInteractive(key) {\n",
              "          const element = document.querySelector('#df-0a3bd11d-5650-40b6-a2a0-1eee248586fa');\n",
              "          const dataTable =\n",
              "            await google.colab.kernel.invokeFunction('convertToInteractive',\n",
              "                                                     [key], {});\n",
              "          if (!dataTable) return;\n",
              "\n",
              "          const docLinkHtml = 'Like what you see? Visit the ' +\n",
              "            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n",
              "            + ' to learn more about interactive tables.';\n",
              "          element.innerHTML = '';\n",
              "          dataTable['output_type'] = 'display_data';\n",
              "          await google.colab.output.renderOutput(dataTable, element);\n",
              "          const docLink = document.createElement('div');\n",
              "          docLink.innerHTML = docLinkHtml;\n",
              "          element.appendChild(docLink);\n",
              "        }\n",
              "      </script>\n",
              "    </div>\n",
              "  </div>\n",
              "  "
            ]
          },
          "metadata": {}
        }
      ]
    },
    {
      "cell_type": "markdown",
      "source": [
        "Chronic atrial fibrillation has icd_code I482 and I4820"
      ],
      "metadata": {
        "id": "aalD9K2VeG-w"
      }
    },
    {
      "cell_type": "code",
      "source": [
        "df = run_query(f'''\n",
        "SELECT dg.subject_id, \n",
        "MAX(CASE WHEN icd_code IN (\"I482\", \"I4820\") THEN 1 ELSE 0 END) AS exclude_chronic\n",
        "FROM `physionet-data.mimic_hosp.diagnoses_icd` dg\n",
        "WHERE dg.subject_id IN ({id_str}) \n",
        "GROUP BY subject_id\n",
        "''')\n",
        "display(df)"
      ],
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/",
          "height": 269
        },
        "id": "HIjX2NLieFCN",
        "outputId": "4333f295-5253-4c92-fab2-cc2a1c56330e"
      },
      "execution_count": null,
      "outputs": [
        {
          "output_type": "display_data",
          "data": {
            "text/plain": [
              "   subject_id  exclude_chronic\n",
              "0    10003400                1\n",
              "1    10002495                0\n",
              "2    10001884                0\n",
              "3    10005866                0\n",
              "4    10002223                0\n",
              "5    10000032                0\n",
              "6    10002443                0"
            ],
            "text/html": [
              "\n",
              "  <div id=\"df-b6dcc486-4d7d-404f-9dac-434a9a64f54a\">\n",
              "    <div class=\"colab-df-container\">\n",
              "      <div>\n",
              "<style scoped>\n",
              "    .dataframe tbody tr th:only-of-type {\n",
              "        vertical-align: middle;\n",
              "    }\n",
              "\n",
              "    .dataframe tbody tr th {\n",
              "        vertical-align: top;\n",
              "    }\n",
              "\n",
              "    .dataframe thead th {\n",
              "        text-align: right;\n",
              "    }\n",
              "</style>\n",
              "<table border=\"1\" class=\"dataframe\">\n",
              "  <thead>\n",
              "    <tr style=\"text-align: right;\">\n",
              "      <th></th>\n",
              "      <th>subject_id</th>\n",
              "      <th>exclude_chronic</th>\n",
              "    </tr>\n",
              "  </thead>\n",
              "  <tbody>\n",
              "    <tr>\n",
              "      <th>0</th>\n",
              "      <td>10003400</td>\n",
              "      <td>1</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>1</th>\n",
              "      <td>10002495</td>\n",
              "      <td>0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>2</th>\n",
              "      <td>10001884</td>\n",
              "      <td>0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>3</th>\n",
              "      <td>10005866</td>\n",
              "      <td>0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>4</th>\n",
              "      <td>10002223</td>\n",
              "      <td>0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>5</th>\n",
              "      <td>10000032</td>\n",
              "      <td>0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>6</th>\n",
              "      <td>10002443</td>\n",
              "      <td>0</td>\n",
              "    </tr>\n",
              "  </tbody>\n",
              "</table>\n",
              "</div>\n",
              "      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-b6dcc486-4d7d-404f-9dac-434a9a64f54a')\"\n",
              "              title=\"Convert this dataframe to an interactive table.\"\n",
              "              style=\"display:none;\">\n",
              "        \n",
              "  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n",
              "       width=\"24px\">\n",
              "    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n",
              "    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n",
              "  </svg>\n",
              "      </button>\n",
              "      \n",
              "  <style>\n",
              "    .colab-df-container {\n",
              "      display:flex;\n",
              "      flex-wrap:wrap;\n",
              "      gap: 12px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert {\n",
              "      background-color: #E8F0FE;\n",
              "      border: none;\n",
              "      border-radius: 50%;\n",
              "      cursor: pointer;\n",
              "      display: none;\n",
              "      fill: #1967D2;\n",
              "      height: 32px;\n",
              "      padding: 0 0 0 0;\n",
              "      width: 32px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert:hover {\n",
              "      background-color: #E2EBFA;\n",
              "      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n",
              "      fill: #174EA6;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert {\n",
              "      background-color: #3B4455;\n",
              "      fill: #D2E3FC;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert:hover {\n",
              "      background-color: #434B5C;\n",
              "      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n",
              "      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n",
              "      fill: #FFFFFF;\n",
              "    }\n",
              "  </style>\n",
              "\n",
              "      <script>\n",
              "        const buttonEl =\n",
              "          document.querySelector('#df-b6dcc486-4d7d-404f-9dac-434a9a64f54a button.colab-df-convert');\n",
              "        buttonEl.style.display =\n",
              "          google.colab.kernel.accessAllowed ? 'block' : 'none';\n",
              "\n",
              "        async function convertToInteractive(key) {\n",
              "          const element = document.querySelector('#df-b6dcc486-4d7d-404f-9dac-434a9a64f54a');\n",
              "          const dataTable =\n",
              "            await google.colab.kernel.invokeFunction('convertToInteractive',\n",
              "                                                     [key], {});\n",
              "          if (!dataTable) return;\n",
              "\n",
              "          const docLinkHtml = 'Like what you see? Visit the ' +\n",
              "            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n",
              "            + ' to learn more about interactive tables.';\n",
              "          element.innerHTML = '';\n",
              "          dataTable['output_type'] = 'display_data';\n",
              "          await google.colab.output.renderOutput(dataTable, element);\n",
              "          const docLink = document.createElement('div');\n",
              "          docLink.innerHTML = docLinkHtml;\n",
              "          element.appendChild(docLink);\n",
              "        }\n",
              "      </script>\n",
              "    </div>\n",
              "  </div>\n",
              "  "
            ]
          },
          "metadata": {}
        }
      ]
    },
    {
      "cell_type": "code",
      "source": [
        "df = run_query(f'''\n",
        "WITH heart AS\n",
        "(\n",
        "  WITH rates AS\n",
        "  (\n",
        "    SELECT DISTINCT a.stay_id, a.first_heart_rate\n",
        "    , CASE WHEN a.first_heart_rate > 110 THEN 1 ELSE 0 END AS exclude_first_heart_rate\n",
        "    FROM\n",
        "    (SELECT ce.subject_id, ce.stay_id, ce.charttime, ce.valuenum\n",
        "    , FIRST_VALUE(ce.valuenum) OVER (PARTITION BY ce.stay_id ORDER BY ce.charttime) AS first_heart_rate\n",
        "    FROM `physionet-data.mimic_icu.chartevents` ce\n",
        "    WHERE ce.subject_id IN ({id_str}) AND ce.itemid = 220045) a\n",
        "  )\n",
        "  SELECT rh.stay_id, rt.first_heart_rate, rt.exclude_first_heart_rate, rh.first_heart_rhythm, rh.exclude_first_heart_rhythm\n",
        "  FROM  (SELECT DISTINCT b.stay_id, b.first_heart_rhythm\n",
        "        , CASE WHEN b.first_heart_rhythm = \"AF (Atrial Fibrillation)\" THEN 1 ELSE 0 END AS exclude_first_heart_rhythm\n",
        "        FROM\n",
        "        (SELECT ce.subject_id, ce.stay_id, ce.charttime, ce.value\n",
        "        , FIRST_VALUE(ce.value) OVER (PARTITION BY ce.stay_id ORDER BY ce.charttime) AS first_heart_rhythm\n",
        "        FROM `physionet-data.mimic_icu.chartevents` ce\n",
        "        INNER JOIN `physionet-data.mimic_icu.d_items` di\n",
        "              ON ce.itemid = di.itemid\n",
        "        WHERE ce.subject_id IN ({id_str}) AND ce.itemid = 220048) b) rh\n",
        "  INNER JOIN rates rt\n",
        "      ON rt.stay_id = rh.stay_id\n",
        ")\n",
        "\n",
        "SELECT ie.subject_id, ie.hadm_id, ie.stay_id\n",
        ", CASE WHEN age.anchor_age >= 16 THEN 0 ELSE 1 END AS exclude_non_adult\n",
        ", CASE WHEN ie.LOS > 4/24 THEN 0 ELSE 1 END AS exclude_short_stays\n",
        ", CASE WHEN ROW_NUMBER() OVER (PARTITION BY ie.subject_id ORDER BY ie.intime) = 1 THEN 0 ELSE 1 END AS exclude_readmission\n",
        ", CASE WHEN cd.admission_location = \"TRANSFER FROM HOSPITAL\" THEN 1 ELSE 0 END as exclude_other_hospitals\n",
        ", ht.exclude_first_heart_rate\n",
        ", ht.exclude_first_heart_rhythm\n",
        ", ch.exclude_chronic\n",
        "FROM `physionet-data.mimic_icu.icustays` ie\n",
        "INNER JOIN `physionet-data.mimic_derived.age` age\n",
        "    ON ie.hadm_id = age.hadm_id\n",
        "LEFT JOIN `physionet-data.mimic_core.admissions`  cd\n",
        "    ON ie.hadm_id = cd.hadm_id\n",
        "LEFT JOIN heart ht\n",
        "    ON ht.stay_id = ie.stay_id\n",
        "LEFT JOIN (SELECT dg.subject_id, \n",
        "          MAX(CASE WHEN icd_code IN (\"I482\", \"I4820\") THEN 1 ELSE 0 END) AS exclude_chronic\n",
        "          FROM `physionet-data.mimic_hosp.diagnoses_icd` dg\n",
        "          WHERE dg.subject_id IN ({id_str}) \n",
        "          GROUP BY subject_id) ch\n",
        "    ON ie.subject_id = ch.subject_id\n",
        "WHERE ie.subject_id IN ({id_str})\n",
        "''')\n",
        "# note \"inplace\" -> this argument tells the dataframe to be modified in-place\n",
        "# i.e., we don't need to do df = df.sort_values(), we can just call the function as-is\n",
        "# be careful with inplace! if you do:\n",
        "#   df = df.sort_values(inplace=True), it will set `df` to None\n",
        "# ... because you're using it wrong (either re-assign the variable, or use the inplace arg, but not both!)\n",
        "df.sort_values('subject_id', inplace=True)\n",
        "display(df)"
      ],
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/",
          "height": 396
        },
        "id": "8Qcvc_11gKM8",
        "outputId": "24827f26-5d68-4830-9ead-01645a1da503"
      },
      "execution_count": null,
      "outputs": [
        {
          "output_type": "display_data",
          "data": {
            "text/plain": [
              "   subject_id   hadm_id   stay_id  exclude_non_adult  exclude_short_stays  \\\n",
              "1    10000032  29079034  39553978                  0                    0   \n",
              "4    10001884  26184834  37510196                  0                    0   \n",
              "3    10002223  22494570  39638202                  0                    0   \n",
              "2    10002443  21329021  35044219                  0                    0   \n",
              "0    10002495  24982426  36753294                  0                    0   \n",
              "6    10003400  20214994  32128372                  0                    0   \n",
              "7    10003400  23559586  34577403                  0                    0   \n",
              "8    10003400  23559586  38383343                  0                    0   \n",
              "5    10005866  20364112  34170353                  0                    0   \n",
              "\n",
              "   exclude_readmission  exclude_other_hospitals  exclude_first_heart_rate  \\\n",
              "1                    0                        0                         0   \n",
              "4                    0                        0                         0   \n",
              "3                    0                        0                         0   \n",
              "2                    0                        1                         0   \n",
              "0                    0                        1                         1   \n",
              "6                    0                        0                         1   \n",
              "7                    1                        1                         0   \n",
              "8                    1                        1                         0   \n",
              "5                    0                        0                         0   \n",
              "\n",
              "   exclude_first_heart_rhythm  exclude_chronic  \n",
              "1                           0                0  \n",
              "4                           0                0  \n",
              "3                           0                0  \n",
              "2                           0                0  \n",
              "0                           0                0  \n",
              "6                           1                1  \n",
              "7                           1                1  \n",
              "8                           1                1  \n",
              "5                           0                0  "
            ],
            "text/html": [
              "\n",
              "  <div id=\"df-c22f8103-5468-401c-92ed-dcf531929f57\">\n",
              "    <div class=\"colab-df-container\">\n",
              "      <div>\n",
              "<style scoped>\n",
              "    .dataframe tbody tr th:only-of-type {\n",
              "        vertical-align: middle;\n",
              "    }\n",
              "\n",
              "    .dataframe tbody tr th {\n",
              "        vertical-align: top;\n",
              "    }\n",
              "\n",
              "    .dataframe thead th {\n",
              "        text-align: right;\n",
              "    }\n",
              "</style>\n",
              "<table border=\"1\" class=\"dataframe\">\n",
              "  <thead>\n",
              "    <tr style=\"text-align: right;\">\n",
              "      <th></th>\n",
              "      <th>subject_id</th>\n",
              "      <th>hadm_id</th>\n",
              "      <th>stay_id</th>\n",
              "      <th>exclude_non_adult</th>\n",
              "      <th>exclude_short_stays</th>\n",
              "      <th>exclude_readmission</th>\n",
              "      <th>exclude_other_hospitals</th>\n",
              "      <th>exclude_first_heart_rate</th>\n",
              "      <th>exclude_first_heart_rhythm</th>\n",
              "      <th>exclude_chronic</th>\n",
              "    </tr>\n",
              "  </thead>\n",
              "  <tbody>\n",
              "    <tr>\n",
              "      <th>1</th>\n",
              "      <td>10000032</td>\n",
              "      <td>29079034</td>\n",
              "      <td>39553978</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>4</th>\n",
              "      <td>10001884</td>\n",
              "      <td>26184834</td>\n",
              "      <td>37510196</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>3</th>\n",
              "      <td>10002223</td>\n",
              "      <td>22494570</td>\n",
              "      <td>39638202</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>2</th>\n",
              "      <td>10002443</td>\n",
              "      <td>21329021</td>\n",
              "      <td>35044219</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>1</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>0</th>\n",
              "      <td>10002495</td>\n",
              "      <td>24982426</td>\n",
              "      <td>36753294</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>1</td>\n",
              "      <td>1</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>6</th>\n",
              "      <td>10003400</td>\n",
              "      <td>20214994</td>\n",
              "      <td>32128372</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>1</td>\n",
              "      <td>1</td>\n",
              "      <td>1</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>7</th>\n",
              "      <td>10003400</td>\n",
              "      <td>23559586</td>\n",
              "      <td>34577403</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>1</td>\n",
              "      <td>1</td>\n",
              "      <td>0</td>\n",
              "      <td>1</td>\n",
              "      <td>1</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>8</th>\n",
              "      <td>10003400</td>\n",
              "      <td>23559586</td>\n",
              "      <td>38383343</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>1</td>\n",
              "      <td>1</td>\n",
              "      <td>0</td>\n",
              "      <td>1</td>\n",
              "      <td>1</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>5</th>\n",
              "      <td>10005866</td>\n",
              "      <td>20364112</td>\n",
              "      <td>34170353</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "    </tr>\n",
              "  </tbody>\n",
              "</table>\n",
              "</div>\n",
              "      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-c22f8103-5468-401c-92ed-dcf531929f57')\"\n",
              "              title=\"Convert this dataframe to an interactive table.\"\n",
              "              style=\"display:none;\">\n",
              "        \n",
              "  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n",
              "       width=\"24px\">\n",
              "    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n",
              "    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n",
              "  </svg>\n",
              "      </button>\n",
              "      \n",
              "  <style>\n",
              "    .colab-df-container {\n",
              "      display:flex;\n",
              "      flex-wrap:wrap;\n",
              "      gap: 12px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert {\n",
              "      background-color: #E8F0FE;\n",
              "      border: none;\n",
              "      border-radius: 50%;\n",
              "      cursor: pointer;\n",
              "      display: none;\n",
              "      fill: #1967D2;\n",
              "      height: 32px;\n",
              "      padding: 0 0 0 0;\n",
              "      width: 32px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert:hover {\n",
              "      background-color: #E2EBFA;\n",
              "      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n",
              "      fill: #174EA6;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert {\n",
              "      background-color: #3B4455;\n",
              "      fill: #D2E3FC;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert:hover {\n",
              "      background-color: #434B5C;\n",
              "      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n",
              "      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n",
              "      fill: #FFFFFF;\n",
              "    }\n",
              "  </style>\n",
              "\n",
              "      <script>\n",
              "        const buttonEl =\n",
              "          document.querySelector('#df-c22f8103-5468-401c-92ed-dcf531929f57 button.colab-df-convert');\n",
              "        buttonEl.style.display =\n",
              "          google.colab.kernel.accessAllowed ? 'block' : 'none';\n",
              "\n",
              "        async function convertToInteractive(key) {\n",
              "          const element = document.querySelector('#df-c22f8103-5468-401c-92ed-dcf531929f57');\n",
              "          const dataTable =\n",
              "            await google.colab.kernel.invokeFunction('convertToInteractive',\n",
              "                                                     [key], {});\n",
              "          if (!dataTable) return;\n",
              "\n",
              "          const docLinkHtml = 'Like what you see? Visit the ' +\n",
              "            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n",
              "            + ' to learn more about interactive tables.';\n",
              "          element.innerHTML = '';\n",
              "          dataTable['output_type'] = 'display_data';\n",
              "          await google.colab.output.renderOutput(dataTable, element);\n",
              "          const docLink = document.createElement('div');\n",
              "          docLink.innerHTML = docLinkHtml;\n",
              "          element.appendChild(docLink);\n",
              "        }\n",
              "      </script>\n",
              "    </div>\n",
              "  </div>\n",
              "  "
            ]
          },
          "metadata": {}
        }
      ]
    },
    {
      "cell_type": "markdown",
      "source": [
        "Question 8: In the above query, did you use all possible concepts related to atrial fibrillation in the `d_` table? Why or why not?\n",
        "\n",
        "No, because not all of them were chronic, there was persistent, paroxymal and permanent, for example"
      ],
      "metadata": {
        "id": "Qdk60uiCBqF8"
      }
    },
    {
      "cell_type": "markdown",
      "source": [
        "### Multiple sources of information\n",
        "\n",
        "Question 9: Write two queries extracting the partial pressure of oxygen in the arterial blood (commonly written as PaO2 or PO2 in ART specimens).\n",
        "\n",
        "- The first query should use *labevents*\n",
        "- The second query should use *chartevents*\n",
        "- Both queries should use the given `subject_id` list in the queries below."
      ],
      "metadata": {
        "id": "7WgzqmJgbqCz"
      }
    },
    {
      "cell_type": "code",
      "source": [
        "# first query\n",
        "df = run_query(f'''\n",
        "SELECT label, itemid\n",
        "FROM `physionet-data.mimic_hosp.d_labitems` \n",
        "WHERE label LIKE (\"%xygen%\")\n",
        "''')\n",
        "display(df)"
      ],
      "metadata": {
        "id": "iYv2Dr7cdCL_",
        "colab": {
          "base_uri": "https://localhost:8080/",
          "height": 112
        },
        "outputId": "cef5d2dd-876b-4c21-ac09-0346573e0337"
      },
      "execution_count": null,
      "outputs": [
        {
          "output_type": "display_data",
          "data": {
            "text/plain": [
              "               label  itemid\n",
              "0             Oxygen   50816\n",
              "1  Oxygen Saturation   50817"
            ],
            "text/html": [
              "\n",
              "  <div id=\"df-15d41c42-e111-4471-bd90-fc491698cc58\">\n",
              "    <div class=\"colab-df-container\">\n",
              "      <div>\n",
              "<style scoped>\n",
              "    .dataframe tbody tr th:only-of-type {\n",
              "        vertical-align: middle;\n",
              "    }\n",
              "\n",
              "    .dataframe tbody tr th {\n",
              "        vertical-align: top;\n",
              "    }\n",
              "\n",
              "    .dataframe thead th {\n",
              "        text-align: right;\n",
              "    }\n",
              "</style>\n",
              "<table border=\"1\" class=\"dataframe\">\n",
              "  <thead>\n",
              "    <tr style=\"text-align: right;\">\n",
              "      <th></th>\n",
              "      <th>label</th>\n",
              "      <th>itemid</th>\n",
              "    </tr>\n",
              "  </thead>\n",
              "  <tbody>\n",
              "    <tr>\n",
              "      <th>0</th>\n",
              "      <td>Oxygen</td>\n",
              "      <td>50816</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>1</th>\n",
              "      <td>Oxygen Saturation</td>\n",
              "      <td>50817</td>\n",
              "    </tr>\n",
              "  </tbody>\n",
              "</table>\n",
              "</div>\n",
              "      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-15d41c42-e111-4471-bd90-fc491698cc58')\"\n",
              "              title=\"Convert this dataframe to an interactive table.\"\n",
              "              style=\"display:none;\">\n",
              "        \n",
              "  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n",
              "       width=\"24px\">\n",
              "    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n",
              "    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n",
              "  </svg>\n",
              "      </button>\n",
              "      \n",
              "  <style>\n",
              "    .colab-df-container {\n",
              "      display:flex;\n",
              "      flex-wrap:wrap;\n",
              "      gap: 12px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert {\n",
              "      background-color: #E8F0FE;\n",
              "      border: none;\n",
              "      border-radius: 50%;\n",
              "      cursor: pointer;\n",
              "      display: none;\n",
              "      fill: #1967D2;\n",
              "      height: 32px;\n",
              "      padding: 0 0 0 0;\n",
              "      width: 32px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert:hover {\n",
              "      background-color: #E2EBFA;\n",
              "      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n",
              "      fill: #174EA6;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert {\n",
              "      background-color: #3B4455;\n",
              "      fill: #D2E3FC;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert:hover {\n",
              "      background-color: #434B5C;\n",
              "      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n",
              "      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n",
              "      fill: #FFFFFF;\n",
              "    }\n",
              "  </style>\n",
              "\n",
              "      <script>\n",
              "        const buttonEl =\n",
              "          document.querySelector('#df-15d41c42-e111-4471-bd90-fc491698cc58 button.colab-df-convert');\n",
              "        buttonEl.style.display =\n",
              "          google.colab.kernel.accessAllowed ? 'block' : 'none';\n",
              "\n",
              "        async function convertToInteractive(key) {\n",
              "          const element = document.querySelector('#df-15d41c42-e111-4471-bd90-fc491698cc58');\n",
              "          const dataTable =\n",
              "            await google.colab.kernel.invokeFunction('convertToInteractive',\n",
              "                                                     [key], {});\n",
              "          if (!dataTable) return;\n",
              "\n",
              "          const docLinkHtml = 'Like what you see? Visit the ' +\n",
              "            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n",
              "            + ' to learn more about interactive tables.';\n",
              "          element.innerHTML = '';\n",
              "          dataTable['output_type'] = 'display_data';\n",
              "          await google.colab.output.renderOutput(dataTable, element);\n",
              "          const docLink = document.createElement('div');\n",
              "          docLink.innerHTML = docLinkHtml;\n",
              "          element.appendChild(docLink);\n",
              "        }\n",
              "      </script>\n",
              "    </div>\n",
              "  </div>\n",
              "  "
            ]
          },
          "metadata": {}
        }
      ]
    },
    {
      "cell_type": "code",
      "source": [
        "df = run_query(f'''\n",
        "SELECT lb.subject_id, lb.hadm_id, lb.charttime, lb.itemid, lb.valuenum\n",
        "FROM `physionet-data.mimic_hosp.labevents` lb\n",
        "WHERE lb.subject_id IN ({id_str}) AND itemid = 50817\n",
        "''')\n",
        "df.sort_values('subject_id', inplace=True)\n",
        "display(df)"
      ],
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/",
          "height": 614
        },
        "id": "5aCWRyking6Q",
        "outputId": "ca24891a-97c1-4f22-8fbb-a4c7f483d525"
      },
      "execution_count": null,
      "outputs": [
        {
          "output_type": "display_data",
          "data": {
            "text/plain": [
              "    subject_id     hadm_id           charttime  itemid  valuenum\n",
              "0     10001884         NaN 2130-10-19 13:58:00   50817      35.0\n",
              "15    10001884  26184834.0 2131-01-13 02:28:00   50817      92.0\n",
              "2     10001884  26184834.0 2131-01-11 06:37:00   50817      81.0\n",
              "3     10001884         NaN 2130-12-06 17:54:00   50817      85.0\n",
              "4     10001884  26184834.0 2131-01-12 21:04:00   50817      90.0\n",
              "7     10001884  26184834.0 2131-01-11 11:33:00   50817      72.0\n",
              "5     10002443  21329021.0 2183-10-18 02:35:00   50817      90.0\n",
              "13    10002495  24982426.0 2141-05-24 00:40:00   50817      72.0\n",
              "9     10002495  24982426.0 2141-05-24 10:10:00   50817      63.0\n",
              "8     10002495  24982426.0 2141-05-24 21:47:00   50817      66.0\n",
              "6     10002495  24982426.0 2141-05-24 06:43:00   50817      67.0\n",
              "17    10002495  24982426.0 2141-05-24 15:07:00   50817      68.0\n",
              "10    10003400  20214994.0 2137-02-26 03:26:00   50817      91.0\n",
              "11    10003400  20214994.0 2137-02-26 02:50:00   50817      68.0\n",
              "12    10003400  20214994.0 2137-02-25 23:51:00   50817      97.0\n",
              "14    10003400  20214994.0 2137-02-26 04:40:00   50817      64.0\n",
              "1     10003400  23559586.0 2137-08-18 05:05:00   50817      55.0\n",
              "16    10003400  23559586.0 2137-08-21 12:24:00   50817      74.0"
            ],
            "text/html": [
              "\n",
              "  <div id=\"df-781200d3-bf66-4ae3-a237-ebe21b7c634a\">\n",
              "    <div class=\"colab-df-container\">\n",
              "      <div>\n",
              "<style scoped>\n",
              "    .dataframe tbody tr th:only-of-type {\n",
              "        vertical-align: middle;\n",
              "    }\n",
              "\n",
              "    .dataframe tbody tr th {\n",
              "        vertical-align: top;\n",
              "    }\n",
              "\n",
              "    .dataframe thead th {\n",
              "        text-align: right;\n",
              "    }\n",
              "</style>\n",
              "<table border=\"1\" class=\"dataframe\">\n",
              "  <thead>\n",
              "    <tr style=\"text-align: right;\">\n",
              "      <th></th>\n",
              "      <th>subject_id</th>\n",
              "      <th>hadm_id</th>\n",
              "      <th>charttime</th>\n",
              "      <th>itemid</th>\n",
              "      <th>valuenum</th>\n",
              "    </tr>\n",
              "  </thead>\n",
              "  <tbody>\n",
              "    <tr>\n",
              "      <th>0</th>\n",
              "      <td>10001884</td>\n",
              "      <td>NaN</td>\n",
              "      <td>2130-10-19 13:58:00</td>\n",
              "      <td>50817</td>\n",
              "      <td>35.0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>15</th>\n",
              "      <td>10001884</td>\n",
              "      <td>26184834.0</td>\n",
              "      <td>2131-01-13 02:28:00</td>\n",
              "      <td>50817</td>\n",
              "      <td>92.0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>2</th>\n",
              "      <td>10001884</td>\n",
              "      <td>26184834.0</td>\n",
              "      <td>2131-01-11 06:37:00</td>\n",
              "      <td>50817</td>\n",
              "      <td>81.0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>3</th>\n",
              "      <td>10001884</td>\n",
              "      <td>NaN</td>\n",
              "      <td>2130-12-06 17:54:00</td>\n",
              "      <td>50817</td>\n",
              "      <td>85.0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>4</th>\n",
              "      <td>10001884</td>\n",
              "      <td>26184834.0</td>\n",
              "      <td>2131-01-12 21:04:00</td>\n",
              "      <td>50817</td>\n",
              "      <td>90.0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>7</th>\n",
              "      <td>10001884</td>\n",
              "      <td>26184834.0</td>\n",
              "      <td>2131-01-11 11:33:00</td>\n",
              "      <td>50817</td>\n",
              "      <td>72.0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>5</th>\n",
              "      <td>10002443</td>\n",
              "      <td>21329021.0</td>\n",
              "      <td>2183-10-18 02:35:00</td>\n",
              "      <td>50817</td>\n",
              "      <td>90.0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>13</th>\n",
              "      <td>10002495</td>\n",
              "      <td>24982426.0</td>\n",
              "      <td>2141-05-24 00:40:00</td>\n",
              "      <td>50817</td>\n",
              "      <td>72.0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>9</th>\n",
              "      <td>10002495</td>\n",
              "      <td>24982426.0</td>\n",
              "      <td>2141-05-24 10:10:00</td>\n",
              "      <td>50817</td>\n",
              "      <td>63.0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>8</th>\n",
              "      <td>10002495</td>\n",
              "      <td>24982426.0</td>\n",
              "      <td>2141-05-24 21:47:00</td>\n",
              "      <td>50817</td>\n",
              "      <td>66.0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>6</th>\n",
              "      <td>10002495</td>\n",
              "      <td>24982426.0</td>\n",
              "      <td>2141-05-24 06:43:00</td>\n",
              "      <td>50817</td>\n",
              "      <td>67.0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>17</th>\n",
              "      <td>10002495</td>\n",
              "      <td>24982426.0</td>\n",
              "      <td>2141-05-24 15:07:00</td>\n",
              "      <td>50817</td>\n",
              "      <td>68.0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>10</th>\n",
              "      <td>10003400</td>\n",
              "      <td>20214994.0</td>\n",
              "      <td>2137-02-26 03:26:00</td>\n",
              "      <td>50817</td>\n",
              "      <td>91.0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>11</th>\n",
              "      <td>10003400</td>\n",
              "      <td>20214994.0</td>\n",
              "      <td>2137-02-26 02:50:00</td>\n",
              "      <td>50817</td>\n",
              "      <td>68.0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>12</th>\n",
              "      <td>10003400</td>\n",
              "      <td>20214994.0</td>\n",
              "      <td>2137-02-25 23:51:00</td>\n",
              "      <td>50817</td>\n",
              "      <td>97.0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>14</th>\n",
              "      <td>10003400</td>\n",
              "      <td>20214994.0</td>\n",
              "      <td>2137-02-26 04:40:00</td>\n",
              "      <td>50817</td>\n",
              "      <td>64.0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>1</th>\n",
              "      <td>10003400</td>\n",
              "      <td>23559586.0</td>\n",
              "      <td>2137-08-18 05:05:00</td>\n",
              "      <td>50817</td>\n",
              "      <td>55.0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>16</th>\n",
              "      <td>10003400</td>\n",
              "      <td>23559586.0</td>\n",
              "      <td>2137-08-21 12:24:00</td>\n",
              "      <td>50817</td>\n",
              "      <td>74.0</td>\n",
              "    </tr>\n",
              "  </tbody>\n",
              "</table>\n",
              "</div>\n",
              "      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-781200d3-bf66-4ae3-a237-ebe21b7c634a')\"\n",
              "              title=\"Convert this dataframe to an interactive table.\"\n",
              "              style=\"display:none;\">\n",
              "        \n",
              "  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n",
              "       width=\"24px\">\n",
              "    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n",
              "    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n",
              "  </svg>\n",
              "      </button>\n",
              "      \n",
              "  <style>\n",
              "    .colab-df-container {\n",
              "      display:flex;\n",
              "      flex-wrap:wrap;\n",
              "      gap: 12px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert {\n",
              "      background-color: #E8F0FE;\n",
              "      border: none;\n",
              "      border-radius: 50%;\n",
              "      cursor: pointer;\n",
              "      display: none;\n",
              "      fill: #1967D2;\n",
              "      height: 32px;\n",
              "      padding: 0 0 0 0;\n",
              "      width: 32px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert:hover {\n",
              "      background-color: #E2EBFA;\n",
              "      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n",
              "      fill: #174EA6;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert {\n",
              "      background-color: #3B4455;\n",
              "      fill: #D2E3FC;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert:hover {\n",
              "      background-color: #434B5C;\n",
              "      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n",
              "      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n",
              "      fill: #FFFFFF;\n",
              "    }\n",
              "  </style>\n",
              "\n",
              "      <script>\n",
              "        const buttonEl =\n",
              "          document.querySelector('#df-781200d3-bf66-4ae3-a237-ebe21b7c634a button.colab-df-convert');\n",
              "        buttonEl.style.display =\n",
              "          google.colab.kernel.accessAllowed ? 'block' : 'none';\n",
              "\n",
              "        async function convertToInteractive(key) {\n",
              "          const element = document.querySelector('#df-781200d3-bf66-4ae3-a237-ebe21b7c634a');\n",
              "          const dataTable =\n",
              "            await google.colab.kernel.invokeFunction('convertToInteractive',\n",
              "                                                     [key], {});\n",
              "          if (!dataTable) return;\n",
              "\n",
              "          const docLinkHtml = 'Like what you see? Visit the ' +\n",
              "            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n",
              "            + ' to learn more about interactive tables.';\n",
              "          element.innerHTML = '';\n",
              "          dataTable['output_type'] = 'display_data';\n",
              "          await google.colab.output.renderOutput(dataTable, element);\n",
              "          const docLink = document.createElement('div');\n",
              "          docLink.innerHTML = docLinkHtml;\n",
              "          element.appendChild(docLink);\n",
              "        }\n",
              "      </script>\n",
              "    </div>\n",
              "  </div>\n",
              "  "
            ]
          },
          "metadata": {}
        }
      ]
    },
    {
      "cell_type": "code",
      "source": [
        "# second query\n",
        "df = run_query(f'''\n",
        "SELECT label, itemid\n",
        "FROM `physionet-data.mimic_icu.d_items` \n",
        "WHERE label LIKE (\"%xygen%\")\n",
        "''')\n",
        "display(df)"
      ],
      "metadata": {
        "id": "YnBE7LX9dFQs",
        "colab": {
          "base_uri": "https://localhost:8080/",
          "height": 363
        },
        "outputId": "ab65ae36-0b28-4053-aa5d-3631d9f1e986"
      },
      "execution_count": null,
      "outputs": [
        {
          "output_type": "display_data",
          "data": {
            "text/plain": [
              "                          label  itemid\n",
              "0         Oxygenator Sweep Rate  228192\n",
              "1               Oxygenator/ECMO  228193\n",
              "2     Oxygenator visible (ECMO)  229274\n",
              "3       Oxygenator visible (CH)  229875\n",
              "4   Preoxygenation (Intubation)  229786\n",
              "5  Pre-Oxygentated (Intubation)  225302\n",
              "6      Brain Tissue Oxygenation  229235\n",
              "7           OxygenApacheIIScore  226767\n",
              "8         PAR-Oxygen saturation  228232\n",
              "9          OxygenScore_ApacheIV  227035"
            ],
            "text/html": [
              "\n",
              "  <div id=\"df-5e065c2b-53b3-4378-9622-4f2b305a9dbb\">\n",
              "    <div class=\"colab-df-container\">\n",
              "      <div>\n",
              "<style scoped>\n",
              "    .dataframe tbody tr th:only-of-type {\n",
              "        vertical-align: middle;\n",
              "    }\n",
              "\n",
              "    .dataframe tbody tr th {\n",
              "        vertical-align: top;\n",
              "    }\n",
              "\n",
              "    .dataframe thead th {\n",
              "        text-align: right;\n",
              "    }\n",
              "</style>\n",
              "<table border=\"1\" class=\"dataframe\">\n",
              "  <thead>\n",
              "    <tr style=\"text-align: right;\">\n",
              "      <th></th>\n",
              "      <th>label</th>\n",
              "      <th>itemid</th>\n",
              "    </tr>\n",
              "  </thead>\n",
              "  <tbody>\n",
              "    <tr>\n",
              "      <th>0</th>\n",
              "      <td>Oxygenator Sweep Rate</td>\n",
              "      <td>228192</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>1</th>\n",
              "      <td>Oxygenator/ECMO</td>\n",
              "      <td>228193</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>2</th>\n",
              "      <td>Oxygenator visible (ECMO)</td>\n",
              "      <td>229274</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>3</th>\n",
              "      <td>Oxygenator visible (CH)</td>\n",
              "      <td>229875</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>4</th>\n",
              "      <td>Preoxygenation (Intubation)</td>\n",
              "      <td>229786</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>5</th>\n",
              "      <td>Pre-Oxygentated (Intubation)</td>\n",
              "      <td>225302</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>6</th>\n",
              "      <td>Brain Tissue Oxygenation</td>\n",
              "      <td>229235</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>7</th>\n",
              "      <td>OxygenApacheIIScore</td>\n",
              "      <td>226767</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>8</th>\n",
              "      <td>PAR-Oxygen saturation</td>\n",
              "      <td>228232</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>9</th>\n",
              "      <td>OxygenScore_ApacheIV</td>\n",
              "      <td>227035</td>\n",
              "    </tr>\n",
              "  </tbody>\n",
              "</table>\n",
              "</div>\n",
              "      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-5e065c2b-53b3-4378-9622-4f2b305a9dbb')\"\n",
              "              title=\"Convert this dataframe to an interactive table.\"\n",
              "              style=\"display:none;\">\n",
              "        \n",
              "  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n",
              "       width=\"24px\">\n",
              "    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n",
              "    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n",
              "  </svg>\n",
              "      </button>\n",
              "      \n",
              "  <style>\n",
              "    .colab-df-container {\n",
              "      display:flex;\n",
              "      flex-wrap:wrap;\n",
              "      gap: 12px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert {\n",
              "      background-color: #E8F0FE;\n",
              "      border: none;\n",
              "      border-radius: 50%;\n",
              "      cursor: pointer;\n",
              "      display: none;\n",
              "      fill: #1967D2;\n",
              "      height: 32px;\n",
              "      padding: 0 0 0 0;\n",
              "      width: 32px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert:hover {\n",
              "      background-color: #E2EBFA;\n",
              "      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n",
              "      fill: #174EA6;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert {\n",
              "      background-color: #3B4455;\n",
              "      fill: #D2E3FC;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert:hover {\n",
              "      background-color: #434B5C;\n",
              "      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n",
              "      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n",
              "      fill: #FFFFFF;\n",
              "    }\n",
              "  </style>\n",
              "\n",
              "      <script>\n",
              "        const buttonEl =\n",
              "          document.querySelector('#df-5e065c2b-53b3-4378-9622-4f2b305a9dbb button.colab-df-convert');\n",
              "        buttonEl.style.display =\n",
              "          google.colab.kernel.accessAllowed ? 'block' : 'none';\n",
              "\n",
              "        async function convertToInteractive(key) {\n",
              "          const element = document.querySelector('#df-5e065c2b-53b3-4378-9622-4f2b305a9dbb');\n",
              "          const dataTable =\n",
              "            await google.colab.kernel.invokeFunction('convertToInteractive',\n",
              "                                                     [key], {});\n",
              "          if (!dataTable) return;\n",
              "\n",
              "          const docLinkHtml = 'Like what you see? Visit the ' +\n",
              "            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n",
              "            + ' to learn more about interactive tables.';\n",
              "          element.innerHTML = '';\n",
              "          dataTable['output_type'] = 'display_data';\n",
              "          await google.colab.output.renderOutput(dataTable, element);\n",
              "          const docLink = document.createElement('div');\n",
              "          docLink.innerHTML = docLinkHtml;\n",
              "          element.appendChild(docLink);\n",
              "        }\n",
              "      </script>\n",
              "    </div>\n",
              "  </div>\n",
              "  "
            ]
          },
          "metadata": {}
        }
      ]
    },
    {
      "cell_type": "code",
      "source": [
        "df = run_query(f'''\n",
        "SELECT ce.subject_id, ce.hadm_id, ce.charttime, ce.itemid, ce.valuenum\n",
        "FROM `physionet-data.mimic_icu.chartevents` ce\n",
        "WHERE ce.subject_id IN ({id_str}) AND ce.itemid = 228232\n",
        "''')\n",
        "df.sort_values('subject_id', inplace=True)\n",
        "display(df)"
      ],
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/",
          "height": 426
        },
        "id": "Pc5ots6Zobna",
        "outputId": "82b3927f-df44-4da1-a785-afdbda123b94"
      },
      "execution_count": null,
      "outputs": [
        {
          "output_type": "display_data",
          "data": {
            "text/plain": [
              "    subject_id   hadm_id           charttime  itemid  valuenum\n",
              "0     10003400  20214994 2137-03-07 19:00:00  228232       1.0\n",
              "1     10003400  20214994 2137-03-07 17:15:00  228232       1.0\n",
              "2     10003400  20214994 2137-03-07 16:30:00  228232       1.0\n",
              "3     10003400  20214994 2137-02-25 23:30:00  228232       1.0\n",
              "4     10003400  20214994 2137-03-07 20:00:00  228232       1.0\n",
              "6     10003400  20214994 2137-03-07 17:00:00  228232       1.0\n",
              "7     10003400  20214994 2137-03-07 17:30:00  228232       1.0\n",
              "8     10003400  20214994 2137-03-07 16:45:00  228232       1.0\n",
              "9     10003400  20214994 2137-03-07 17:55:00  228232       1.0\n",
              "10    10003400  20214994 2137-03-07 18:06:00  228232       1.0\n",
              "11    10003400  20214994 2137-03-07 17:56:00  228232       1.0\n",
              "5     10005866  20364112 2149-10-03 18:51:00  228232       1.0"
            ],
            "text/html": [
              "\n",
              "  <div id=\"df-a9366274-73a5-4583-8ba8-ccc547bb6e52\">\n",
              "    <div class=\"colab-df-container\">\n",
              "      <div>\n",
              "<style scoped>\n",
              "    .dataframe tbody tr th:only-of-type {\n",
              "        vertical-align: middle;\n",
              "    }\n",
              "\n",
              "    .dataframe tbody tr th {\n",
              "        vertical-align: top;\n",
              "    }\n",
              "\n",
              "    .dataframe thead th {\n",
              "        text-align: right;\n",
              "    }\n",
              "</style>\n",
              "<table border=\"1\" class=\"dataframe\">\n",
              "  <thead>\n",
              "    <tr style=\"text-align: right;\">\n",
              "      <th></th>\n",
              "      <th>subject_id</th>\n",
              "      <th>hadm_id</th>\n",
              "      <th>charttime</th>\n",
              "      <th>itemid</th>\n",
              "      <th>valuenum</th>\n",
              "    </tr>\n",
              "  </thead>\n",
              "  <tbody>\n",
              "    <tr>\n",
              "      <th>0</th>\n",
              "      <td>10003400</td>\n",
              "      <td>20214994</td>\n",
              "      <td>2137-03-07 19:00:00</td>\n",
              "      <td>228232</td>\n",
              "      <td>1.0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>1</th>\n",
              "      <td>10003400</td>\n",
              "      <td>20214994</td>\n",
              "      <td>2137-03-07 17:15:00</td>\n",
              "      <td>228232</td>\n",
              "      <td>1.0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>2</th>\n",
              "      <td>10003400</td>\n",
              "      <td>20214994</td>\n",
              "      <td>2137-03-07 16:30:00</td>\n",
              "      <td>228232</td>\n",
              "      <td>1.0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>3</th>\n",
              "      <td>10003400</td>\n",
              "      <td>20214994</td>\n",
              "      <td>2137-02-25 23:30:00</td>\n",
              "      <td>228232</td>\n",
              "      <td>1.0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>4</th>\n",
              "      <td>10003400</td>\n",
              "      <td>20214994</td>\n",
              "      <td>2137-03-07 20:00:00</td>\n",
              "      <td>228232</td>\n",
              "      <td>1.0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>6</th>\n",
              "      <td>10003400</td>\n",
              "      <td>20214994</td>\n",
              "      <td>2137-03-07 17:00:00</td>\n",
              "      <td>228232</td>\n",
              "      <td>1.0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>7</th>\n",
              "      <td>10003400</td>\n",
              "      <td>20214994</td>\n",
              "      <td>2137-03-07 17:30:00</td>\n",
              "      <td>228232</td>\n",
              "      <td>1.0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>8</th>\n",
              "      <td>10003400</td>\n",
              "      <td>20214994</td>\n",
              "      <td>2137-03-07 16:45:00</td>\n",
              "      <td>228232</td>\n",
              "      <td>1.0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>9</th>\n",
              "      <td>10003400</td>\n",
              "      <td>20214994</td>\n",
              "      <td>2137-03-07 17:55:00</td>\n",
              "      <td>228232</td>\n",
              "      <td>1.0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>10</th>\n",
              "      <td>10003400</td>\n",
              "      <td>20214994</td>\n",
              "      <td>2137-03-07 18:06:00</td>\n",
              "      <td>228232</td>\n",
              "      <td>1.0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>11</th>\n",
              "      <td>10003400</td>\n",
              "      <td>20214994</td>\n",
              "      <td>2137-03-07 17:56:00</td>\n",
              "      <td>228232</td>\n",
              "      <td>1.0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>5</th>\n",
              "      <td>10005866</td>\n",
              "      <td>20364112</td>\n",
              "      <td>2149-10-03 18:51:00</td>\n",
              "      <td>228232</td>\n",
              "      <td>1.0</td>\n",
              "    </tr>\n",
              "  </tbody>\n",
              "</table>\n",
              "</div>\n",
              "      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-a9366274-73a5-4583-8ba8-ccc547bb6e52')\"\n",
              "              title=\"Convert this dataframe to an interactive table.\"\n",
              "              style=\"display:none;\">\n",
              "        \n",
              "  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n",
              "       width=\"24px\">\n",
              "    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n",
              "    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n",
              "  </svg>\n",
              "      </button>\n",
              "      \n",
              "  <style>\n",
              "    .colab-df-container {\n",
              "      display:flex;\n",
              "      flex-wrap:wrap;\n",
              "      gap: 12px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert {\n",
              "      background-color: #E8F0FE;\n",
              "      border: none;\n",
              "      border-radius: 50%;\n",
              "      cursor: pointer;\n",
              "      display: none;\n",
              "      fill: #1967D2;\n",
              "      height: 32px;\n",
              "      padding: 0 0 0 0;\n",
              "      width: 32px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert:hover {\n",
              "      background-color: #E2EBFA;\n",
              "      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n",
              "      fill: #174EA6;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert {\n",
              "      background-color: #3B4455;\n",
              "      fill: #D2E3FC;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert:hover {\n",
              "      background-color: #434B5C;\n",
              "      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n",
              "      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n",
              "      fill: #FFFFFF;\n",
              "    }\n",
              "  </style>\n",
              "\n",
              "      <script>\n",
              "        const buttonEl =\n",
              "          document.querySelector('#df-a9366274-73a5-4583-8ba8-ccc547bb6e52 button.colab-df-convert');\n",
              "        buttonEl.style.display =\n",
              "          google.colab.kernel.accessAllowed ? 'block' : 'none';\n",
              "\n",
              "        async function convertToInteractive(key) {\n",
              "          const element = document.querySelector('#df-a9366274-73a5-4583-8ba8-ccc547bb6e52');\n",
              "          const dataTable =\n",
              "            await google.colab.kernel.invokeFunction('convertToInteractive',\n",
              "                                                     [key], {});\n",
              "          if (!dataTable) return;\n",
              "\n",
              "          const docLinkHtml = 'Like what you see? Visit the ' +\n",
              "            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n",
              "            + ' to learn more about interactive tables.';\n",
              "          element.innerHTML = '';\n",
              "          dataTable['output_type'] = 'display_data';\n",
              "          await google.colab.output.renderOutput(dataTable, element);\n",
              "          const docLink = document.createElement('div');\n",
              "          docLink.innerHTML = docLinkHtml;\n",
              "          element.appendChild(docLink);\n",
              "        }\n",
              "      </script>\n",
              "    </div>\n",
              "  </div>\n",
              "  "
            ]
          },
          "metadata": {}
        }
      ]
    },
    {
      "cell_type": "markdown",
      "source": [
        "Question 10: Describe the differences between the above queries."
      ],
      "metadata": {
        "id": "n_1knQL2QgQJ"
      }
    },
    {
      "cell_type": "markdown",
      "source": [
        "Answer: Although in both cases I'm taking Oxygen Saturation I'm not sure if it's the correct itemid in each case given that there are huge differences in both the number of records and the scale of the numeric value of the measure"
      ],
      "metadata": {
        "id": "eKW4sJG1X5ah"
      }
    },
    {
      "cell_type": "markdown",
      "source": [
        "Question 11: Which do you think is the \"correct\" source of information? Justify your response."
      ],
      "metadata": {
        "id": "NhhIfFk_X58T"
      }
    },
    {
      "cell_type": "markdown",
      "source": [
        "Answer: looks like the correct in this case is the labevents since chartevents only shows a constant value of 1."
      ],
      "metadata": {
        "id": "2RbYIl8UX6Ed"
      }
    },
    {
      "cell_type": "markdown",
      "source": [
        "## Lab value\n",
        "\n",
        "Question 12: Copy the latest cohort query from Question 7 above. Exclude the patient if the highest troponin value measured between 72 hours before ICU admission and 4 hours after ICU admission is greater than 0.01."
      ],
      "metadata": {
        "id": "kioCt2tUICZ9"
      }
    },
    {
      "cell_type": "code",
      "source": [
        "df = run_query(f'''\n",
        "SELECT label, itemid\n",
        "FROM `physionet-data.mimic_icu.d_items` \n",
        "WHERE label LIKE (\"%roponin%\")\n",
        "''')\n",
        "display(df)"
      ],
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/",
          "height": 175
        },
        "id": "2MLrsQAqxigv",
        "outputId": "e27f9f43-2a60-40e1-8afb-49a93debdffc"
      },
      "execution_count": null,
      "outputs": [
        {
          "output_type": "display_data",
          "data": {
            "text/plain": [
              "                label  itemid\n",
              "0          Amiodarone  221347\n",
              "1  Amiodarone 600/500  228339\n",
              "2  Amiodarone 450/250  229654\n",
              "3  Amiodarone 150/100  230034"
            ],
            "text/html": [
              "\n",
              "  <div id=\"df-f7341013-3feb-4d61-b00e-98b3bcbe6d38\">\n",
              "    <div class=\"colab-df-container\">\n",
              "      <div>\n",
              "<style scoped>\n",
              "    .dataframe tbody tr th:only-of-type {\n",
              "        vertical-align: middle;\n",
              "    }\n",
              "\n",
              "    .dataframe tbody tr th {\n",
              "        vertical-align: top;\n",
              "    }\n",
              "\n",
              "    .dataframe thead th {\n",
              "        text-align: right;\n",
              "    }\n",
              "</style>\n",
              "<table border=\"1\" class=\"dataframe\">\n",
              "  <thead>\n",
              "    <tr style=\"text-align: right;\">\n",
              "      <th></th>\n",
              "      <th>label</th>\n",
              "      <th>itemid</th>\n",
              "    </tr>\n",
              "  </thead>\n",
              "  <tbody>\n",
              "    <tr>\n",
              "      <th>0</th>\n",
              "      <td>Amiodarone</td>\n",
              "      <td>221347</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>1</th>\n",
              "      <td>Amiodarone 600/500</td>\n",
              "      <td>228339</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>2</th>\n",
              "      <td>Amiodarone 450/250</td>\n",
              "      <td>229654</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>3</th>\n",
              "      <td>Amiodarone 150/100</td>\n",
              "      <td>230034</td>\n",
              "    </tr>\n",
              "  </tbody>\n",
              "</table>\n",
              "</div>\n",
              "      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-f7341013-3feb-4d61-b00e-98b3bcbe6d38')\"\n",
              "              title=\"Convert this dataframe to an interactive table.\"\n",
              "              style=\"display:none;\">\n",
              "        \n",
              "  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n",
              "       width=\"24px\">\n",
              "    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n",
              "    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n",
              "  </svg>\n",
              "      </button>\n",
              "      \n",
              "  <style>\n",
              "    .colab-df-container {\n",
              "      display:flex;\n",
              "      flex-wrap:wrap;\n",
              "      gap: 12px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert {\n",
              "      background-color: #E8F0FE;\n",
              "      border: none;\n",
              "      border-radius: 50%;\n",
              "      cursor: pointer;\n",
              "      display: none;\n",
              "      fill: #1967D2;\n",
              "      height: 32px;\n",
              "      padding: 0 0 0 0;\n",
              "      width: 32px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert:hover {\n",
              "      background-color: #E2EBFA;\n",
              "      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n",
              "      fill: #174EA6;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert {\n",
              "      background-color: #3B4455;\n",
              "      fill: #D2E3FC;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert:hover {\n",
              "      background-color: #434B5C;\n",
              "      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n",
              "      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n",
              "      fill: #FFFFFF;\n",
              "    }\n",
              "  </style>\n",
              "\n",
              "      <script>\n",
              "        const buttonEl =\n",
              "          document.querySelector('#df-f7341013-3feb-4d61-b00e-98b3bcbe6d38 button.colab-df-convert');\n",
              "        buttonEl.style.display =\n",
              "          google.colab.kernel.accessAllowed ? 'block' : 'none';\n",
              "\n",
              "        async function convertToInteractive(key) {\n",
              "          const element = document.querySelector('#df-f7341013-3feb-4d61-b00e-98b3bcbe6d38');\n",
              "          const dataTable =\n",
              "            await google.colab.kernel.invokeFunction('convertToInteractive',\n",
              "                                                     [key], {});\n",
              "          if (!dataTable) return;\n",
              "\n",
              "          const docLinkHtml = 'Like what you see? Visit the ' +\n",
              "            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n",
              "            + ' to learn more about interactive tables.';\n",
              "          element.innerHTML = '';\n",
              "          dataTable['output_type'] = 'display_data';\n",
              "          await google.colab.output.renderOutput(dataTable, element);\n",
              "          const docLink = document.createElement('div');\n",
              "          docLink.innerHTML = docLinkHtml;\n",
              "          element.appendChild(docLink);\n",
              "        }\n",
              "      </script>\n",
              "    </div>\n",
              "  </div>\n",
              "  "
            ]
          },
          "metadata": {}
        }
      ]
    },
    {
      "cell_type": "code",
      "source": [
        "# answer\n",
        "df = run_query(f'''\n",
        "SELECT ce.subject_id, ce.hadm_id, ce.stay_id, ce.charttime, ce.itemid, ce.valuenum, ic.intime\n",
        ", CASE WHEN ce.charttime > date_add(ic.intime, INTERVAL -72 HOUR) AND ce.charttime < date_add(ic.intime, INTERVAL 4 HOUR)\n",
        "  AND ce.valuenum > .01 THEN 1 ELSE 0 END as vjeniv\n",
        "FROM `physionet-data.mimic_icu.chartevents` ce\n",
        "INNER JOIN `physionet-data.mimic_icu.icustays` ic\n",
        "    ON ce.stay_id = ic.stay_id\n",
        "WHERE ce.subject_id IN ({id_str}) AND ce.itemid = 227429\n",
        "''')\n",
        "df.sort_values('subject_id', inplace=True)\n",
        "display(df)"
      ],
      "metadata": {
        "id": "U45P18P9Krgl",
        "colab": {
          "base_uri": "https://localhost:8080/",
          "height": 363
        },
        "outputId": "007850d4-060c-47a3-aa69-b0ae5f4cf0dc"
      },
      "execution_count": null,
      "outputs": [
        {
          "output_type": "display_data",
          "data": {
            "text/plain": [
              "   subject_id   hadm_id   stay_id           charttime  itemid  valuenum  \\\n",
              "6    10001884  26184834  37510196 2131-01-11 06:31:00  227429      0.08   \n",
              "0    10002495  24982426  36753294 2141-05-23 10:52:00  227429      3.11   \n",
              "2    10002495  24982426  36753294 2141-05-22 21:23:00  227429      0.69   \n",
              "4    10002495  24982426  36753294 2141-05-23 01:49:00  227429      0.84   \n",
              "5    10002495  24982426  36753294 2141-05-24 06:20:00  227429      6.74   \n",
              "8    10002495  24982426  36753294 2141-05-23 05:48:00  227429      1.75   \n",
              "9    10002495  24982426  36753294 2141-05-23 16:57:00  227429      3.75   \n",
              "3    10003400  20214994  32128372 2137-02-26 03:14:00  227429      0.01   \n",
              "7    10003400  20214994  32128372 2137-02-25 21:27:00  227429      0.01   \n",
              "1    10005866  20364112  34170353 2149-10-03 11:20:00  227429      0.01   \n",
              "\n",
              "               intime  vjeniv  \n",
              "6 2131-01-11 04:20:05       1  \n",
              "0 2141-05-22 20:18:01       0  \n",
              "2 2141-05-22 20:18:01       1  \n",
              "4 2141-05-22 20:18:01       0  \n",
              "5 2141-05-22 20:18:01       0  \n",
              "8 2141-05-22 20:18:01       0  \n",
              "9 2141-05-22 20:18:01       0  \n",
              "3 2137-02-25 23:37:19       0  \n",
              "7 2137-02-25 23:37:19       0  \n",
              "1 2149-10-02 12:48:08       0  "
            ],
            "text/html": [
              "\n",
              "  <div id=\"df-b7b4ba33-789e-4091-b567-f334c4650ae0\">\n",
              "    <div class=\"colab-df-container\">\n",
              "      <div>\n",
              "<style scoped>\n",
              "    .dataframe tbody tr th:only-of-type {\n",
              "        vertical-align: middle;\n",
              "    }\n",
              "\n",
              "    .dataframe tbody tr th {\n",
              "        vertical-align: top;\n",
              "    }\n",
              "\n",
              "    .dataframe thead th {\n",
              "        text-align: right;\n",
              "    }\n",
              "</style>\n",
              "<table border=\"1\" class=\"dataframe\">\n",
              "  <thead>\n",
              "    <tr style=\"text-align: right;\">\n",
              "      <th></th>\n",
              "      <th>subject_id</th>\n",
              "      <th>hadm_id</th>\n",
              "      <th>stay_id</th>\n",
              "      <th>charttime</th>\n",
              "      <th>itemid</th>\n",
              "      <th>valuenum</th>\n",
              "      <th>intime</th>\n",
              "      <th>vjeniv</th>\n",
              "    </tr>\n",
              "  </thead>\n",
              "  <tbody>\n",
              "    <tr>\n",
              "      <th>6</th>\n",
              "      <td>10001884</td>\n",
              "      <td>26184834</td>\n",
              "      <td>37510196</td>\n",
              "      <td>2131-01-11 06:31:00</td>\n",
              "      <td>227429</td>\n",
              "      <td>0.08</td>\n",
              "      <td>2131-01-11 04:20:05</td>\n",
              "      <td>1</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>0</th>\n",
              "      <td>10002495</td>\n",
              "      <td>24982426</td>\n",
              "      <td>36753294</td>\n",
              "      <td>2141-05-23 10:52:00</td>\n",
              "      <td>227429</td>\n",
              "      <td>3.11</td>\n",
              "      <td>2141-05-22 20:18:01</td>\n",
              "      <td>0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>2</th>\n",
              "      <td>10002495</td>\n",
              "      <td>24982426</td>\n",
              "      <td>36753294</td>\n",
              "      <td>2141-05-22 21:23:00</td>\n",
              "      <td>227429</td>\n",
              "      <td>0.69</td>\n",
              "      <td>2141-05-22 20:18:01</td>\n",
              "      <td>1</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>4</th>\n",
              "      <td>10002495</td>\n",
              "      <td>24982426</td>\n",
              "      <td>36753294</td>\n",
              "      <td>2141-05-23 01:49:00</td>\n",
              "      <td>227429</td>\n",
              "      <td>0.84</td>\n",
              "      <td>2141-05-22 20:18:01</td>\n",
              "      <td>0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>5</th>\n",
              "      <td>10002495</td>\n",
              "      <td>24982426</td>\n",
              "      <td>36753294</td>\n",
              "      <td>2141-05-24 06:20:00</td>\n",
              "      <td>227429</td>\n",
              "      <td>6.74</td>\n",
              "      <td>2141-05-22 20:18:01</td>\n",
              "      <td>0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>8</th>\n",
              "      <td>10002495</td>\n",
              "      <td>24982426</td>\n",
              "      <td>36753294</td>\n",
              "      <td>2141-05-23 05:48:00</td>\n",
              "      <td>227429</td>\n",
              "      <td>1.75</td>\n",
              "      <td>2141-05-22 20:18:01</td>\n",
              "      <td>0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>9</th>\n",
              "      <td>10002495</td>\n",
              "      <td>24982426</td>\n",
              "      <td>36753294</td>\n",
              "      <td>2141-05-23 16:57:00</td>\n",
              "      <td>227429</td>\n",
              "      <td>3.75</td>\n",
              "      <td>2141-05-22 20:18:01</td>\n",
              "      <td>0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>3</th>\n",
              "      <td>10003400</td>\n",
              "      <td>20214994</td>\n",
              "      <td>32128372</td>\n",
              "      <td>2137-02-26 03:14:00</td>\n",
              "      <td>227429</td>\n",
              "      <td>0.01</td>\n",
              "      <td>2137-02-25 23:37:19</td>\n",
              "      <td>0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>7</th>\n",
              "      <td>10003400</td>\n",
              "      <td>20214994</td>\n",
              "      <td>32128372</td>\n",
              "      <td>2137-02-25 21:27:00</td>\n",
              "      <td>227429</td>\n",
              "      <td>0.01</td>\n",
              "      <td>2137-02-25 23:37:19</td>\n",
              "      <td>0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>1</th>\n",
              "      <td>10005866</td>\n",
              "      <td>20364112</td>\n",
              "      <td>34170353</td>\n",
              "      <td>2149-10-03 11:20:00</td>\n",
              "      <td>227429</td>\n",
              "      <td>0.01</td>\n",
              "      <td>2149-10-02 12:48:08</td>\n",
              "      <td>0</td>\n",
              "    </tr>\n",
              "  </tbody>\n",
              "</table>\n",
              "</div>\n",
              "      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-b7b4ba33-789e-4091-b567-f334c4650ae0')\"\n",
              "              title=\"Convert this dataframe to an interactive table.\"\n",
              "              style=\"display:none;\">\n",
              "        \n",
              "  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n",
              "       width=\"24px\">\n",
              "    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n",
              "    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n",
              "  </svg>\n",
              "      </button>\n",
              "      \n",
              "  <style>\n",
              "    .colab-df-container {\n",
              "      display:flex;\n",
              "      flex-wrap:wrap;\n",
              "      gap: 12px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert {\n",
              "      background-color: #E8F0FE;\n",
              "      border: none;\n",
              "      border-radius: 50%;\n",
              "      cursor: pointer;\n",
              "      display: none;\n",
              "      fill: #1967D2;\n",
              "      height: 32px;\n",
              "      padding: 0 0 0 0;\n",
              "      width: 32px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert:hover {\n",
              "      background-color: #E2EBFA;\n",
              "      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n",
              "      fill: #174EA6;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert {\n",
              "      background-color: #3B4455;\n",
              "      fill: #D2E3FC;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert:hover {\n",
              "      background-color: #434B5C;\n",
              "      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n",
              "      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n",
              "      fill: #FFFFFF;\n",
              "    }\n",
              "  </style>\n",
              "\n",
              "      <script>\n",
              "        const buttonEl =\n",
              "          document.querySelector('#df-b7b4ba33-789e-4091-b567-f334c4650ae0 button.colab-df-convert');\n",
              "        buttonEl.style.display =\n",
              "          google.colab.kernel.accessAllowed ? 'block' : 'none';\n",
              "\n",
              "        async function convertToInteractive(key) {\n",
              "          const element = document.querySelector('#df-b7b4ba33-789e-4091-b567-f334c4650ae0');\n",
              "          const dataTable =\n",
              "            await google.colab.kernel.invokeFunction('convertToInteractive',\n",
              "                                                     [key], {});\n",
              "          if (!dataTable) return;\n",
              "\n",
              "          const docLinkHtml = 'Like what you see? Visit the ' +\n",
              "            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n",
              "            + ' to learn more about interactive tables.';\n",
              "          element.innerHTML = '';\n",
              "          dataTable['output_type'] = 'display_data';\n",
              "          await google.colab.output.renderOutput(dataTable, element);\n",
              "          const docLink = document.createElement('div');\n",
              "          docLink.innerHTML = docLinkHtml;\n",
              "          element.appendChild(docLink);\n",
              "        }\n",
              "      </script>\n",
              "    </div>\n",
              "  </div>\n",
              "  "
            ]
          },
          "metadata": {}
        }
      ]
    },
    {
      "cell_type": "code",
      "source": [
        "# answer\n",
        "df = run_query(f'''\n",
        "SELECT ce.stay_id\n",
        ", MAX(CASE WHEN ce.charttime > date_add(ic.intime, INTERVAL -72 HOUR) AND ce.charttime < date_add(ic.intime, INTERVAL 4 HOUR)\n",
        "  AND ce.valuenum > .01 THEN 1 ELSE 0 END) as exclude_troponin\n",
        "FROM `physionet-data.mimic_icu.chartevents` ce\n",
        "INNER JOIN `physionet-data.mimic_icu.icustays` ic\n",
        "    ON ce.stay_id = ic.stay_id\n",
        "WHERE ce.subject_id IN ({id_str}) AND ce.itemid = 227429\n",
        "GROUP BY ce.stay_id\n",
        "''')\n",
        "display(df)"
      ],
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/",
          "height": 175
        },
        "id": "qbuGO8VV17S-",
        "outputId": "4368d01e-6d10-4b39-976e-417aca233260"
      },
      "execution_count": null,
      "outputs": [
        {
          "output_type": "display_data",
          "data": {
            "text/plain": [
              "    stay_id  exclude_troponin\n",
              "0  34170353                 0\n",
              "1  36753294                 1\n",
              "2  32128372                 0\n",
              "3  37510196                 1"
            ],
            "text/html": [
              "\n",
              "  <div id=\"df-9398f057-74f8-47a7-8f26-fbe9d00e7d6a\">\n",
              "    <div class=\"colab-df-container\">\n",
              "      <div>\n",
              "<style scoped>\n",
              "    .dataframe tbody tr th:only-of-type {\n",
              "        vertical-align: middle;\n",
              "    }\n",
              "\n",
              "    .dataframe tbody tr th {\n",
              "        vertical-align: top;\n",
              "    }\n",
              "\n",
              "    .dataframe thead th {\n",
              "        text-align: right;\n",
              "    }\n",
              "</style>\n",
              "<table border=\"1\" class=\"dataframe\">\n",
              "  <thead>\n",
              "    <tr style=\"text-align: right;\">\n",
              "      <th></th>\n",
              "      <th>stay_id</th>\n",
              "      <th>exclude_troponin</th>\n",
              "    </tr>\n",
              "  </thead>\n",
              "  <tbody>\n",
              "    <tr>\n",
              "      <th>0</th>\n",
              "      <td>34170353</td>\n",
              "      <td>0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>1</th>\n",
              "      <td>36753294</td>\n",
              "      <td>1</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>2</th>\n",
              "      <td>32128372</td>\n",
              "      <td>0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>3</th>\n",
              "      <td>37510196</td>\n",
              "      <td>1</td>\n",
              "    </tr>\n",
              "  </tbody>\n",
              "</table>\n",
              "</div>\n",
              "      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-9398f057-74f8-47a7-8f26-fbe9d00e7d6a')\"\n",
              "              title=\"Convert this dataframe to an interactive table.\"\n",
              "              style=\"display:none;\">\n",
              "        \n",
              "  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n",
              "       width=\"24px\">\n",
              "    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n",
              "    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n",
              "  </svg>\n",
              "      </button>\n",
              "      \n",
              "  <style>\n",
              "    .colab-df-container {\n",
              "      display:flex;\n",
              "      flex-wrap:wrap;\n",
              "      gap: 12px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert {\n",
              "      background-color: #E8F0FE;\n",
              "      border: none;\n",
              "      border-radius: 50%;\n",
              "      cursor: pointer;\n",
              "      display: none;\n",
              "      fill: #1967D2;\n",
              "      height: 32px;\n",
              "      padding: 0 0 0 0;\n",
              "      width: 32px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert:hover {\n",
              "      background-color: #E2EBFA;\n",
              "      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n",
              "      fill: #174EA6;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert {\n",
              "      background-color: #3B4455;\n",
              "      fill: #D2E3FC;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert:hover {\n",
              "      background-color: #434B5C;\n",
              "      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n",
              "      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n",
              "      fill: #FFFFFF;\n",
              "    }\n",
              "  </style>\n",
              "\n",
              "      <script>\n",
              "        const buttonEl =\n",
              "          document.querySelector('#df-9398f057-74f8-47a7-8f26-fbe9d00e7d6a button.colab-df-convert');\n",
              "        buttonEl.style.display =\n",
              "          google.colab.kernel.accessAllowed ? 'block' : 'none';\n",
              "\n",
              "        async function convertToInteractive(key) {\n",
              "          const element = document.querySelector('#df-9398f057-74f8-47a7-8f26-fbe9d00e7d6a');\n",
              "          const dataTable =\n",
              "            await google.colab.kernel.invokeFunction('convertToInteractive',\n",
              "                                                     [key], {});\n",
              "          if (!dataTable) return;\n",
              "\n",
              "          const docLinkHtml = 'Like what you see? Visit the ' +\n",
              "            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n",
              "            + ' to learn more about interactive tables.';\n",
              "          element.innerHTML = '';\n",
              "          dataTable['output_type'] = 'display_data';\n",
              "          await google.colab.output.renderOutput(dataTable, element);\n",
              "          const docLink = document.createElement('div');\n",
              "          docLink.innerHTML = docLinkHtml;\n",
              "          element.appendChild(docLink);\n",
              "        }\n",
              "      </script>\n",
              "    </div>\n",
              "  </div>\n",
              "  "
            ]
          },
          "metadata": {}
        }
      ]
    },
    {
      "cell_type": "code",
      "source": [
        "df = run_query(f'''\n",
        "WITH heart AS\n",
        "(\n",
        "  WITH rates AS\n",
        "  (\n",
        "    SELECT DISTINCT a.stay_id, a.first_heart_rate\n",
        "    , CASE WHEN a.first_heart_rate > 110 THEN 1 ELSE 0 END AS exclude_first_heart_rate\n",
        "    FROM\n",
        "    (SELECT ce.subject_id, ce.stay_id, ce.charttime, ce.valuenum\n",
        "    , FIRST_VALUE(ce.valuenum) OVER (PARTITION BY ce.stay_id ORDER BY ce.charttime) AS first_heart_rate\n",
        "    FROM `physionet-data.mimic_icu.chartevents` ce\n",
        "    WHERE ce.subject_id IN ({id_str}) AND ce.itemid = 220045) a\n",
        "  )\n",
        "  SELECT rh.stay_id, rt.first_heart_rate, rt.exclude_first_heart_rate, rh.first_heart_rhythm, rh.exclude_first_heart_rhythm\n",
        "  FROM  (SELECT DISTINCT b.stay_id, b.first_heart_rhythm\n",
        "        , CASE WHEN b.first_heart_rhythm = \"AF (Atrial Fibrillation)\" THEN 1 ELSE 0 END AS exclude_first_heart_rhythm\n",
        "        FROM\n",
        "        (SELECT ce.subject_id, ce.stay_id, ce.charttime, ce.value\n",
        "        , FIRST_VALUE(ce.value) OVER (PARTITION BY ce.stay_id ORDER BY ce.charttime) AS first_heart_rhythm\n",
        "        FROM `physionet-data.mimic_icu.chartevents` ce\n",
        "        INNER JOIN `physionet-data.mimic_icu.d_items` di\n",
        "              ON ce.itemid = di.itemid\n",
        "        WHERE ce.subject_id IN ({id_str}) AND ce.itemid = 220048) b) rh\n",
        "  INNER JOIN rates rt\n",
        "      ON rt.stay_id = rh.stay_id\n",
        ")\n",
        "\n",
        "SELECT ie.subject_id, ie.hadm_id, ie.stay_id\n",
        ", CASE WHEN age.anchor_age >= 16 THEN 0 ELSE 1 END AS exclude_non_adult\n",
        ", CASE WHEN ie.LOS > 4/24 THEN 0 ELSE 1 END AS exclude_short_stays\n",
        ", CASE WHEN ROW_NUMBER() OVER (PARTITION BY ie.subject_id ORDER BY ie.intime) = 1 THEN 0 ELSE 1 END AS exclude_readmission\n",
        ", CASE WHEN cd.admission_location = \"TRANSFER FROM HOSPITAL\" THEN 1 ELSE 0 END as exclude_other_hospitals\n",
        ", ht.exclude_first_heart_rate\n",
        ", ht.exclude_first_heart_rhythm\n",
        ", ch.exclude_chronic\n",
        ", Ifnull(tp.exclude_troponin, 0) as exclude_troponin\n",
        "FROM `physionet-data.mimic_icu.icustays` ie\n",
        "INNER JOIN `physionet-data.mimic_derived.age` age\n",
        "    ON ie.hadm_id = age.hadm_id\n",
        "LEFT JOIN `physionet-data.mimic_core.admissions`  cd\n",
        "    ON ie.hadm_id = cd.hadm_id\n",
        "LEFT JOIN heart ht\n",
        "    ON ht.stay_id = ie.stay_id\n",
        "LEFT JOIN (SELECT dg.subject_id, \n",
        "          MAX(CASE WHEN icd_code IN (\"I482\", \"I4820\") THEN 1 ELSE 0 END) AS exclude_chronic\n",
        "          FROM `physionet-data.mimic_hosp.diagnoses_icd` dg\n",
        "          WHERE dg.subject_id IN ({id_str}) \n",
        "          GROUP BY subject_id) ch\n",
        "    ON ie.subject_id = ch.subject_id\n",
        "LEFT JOIN (SELECT ce.stay_id\n",
        "          , MAX(CASE WHEN ce.charttime > date_add(ic.intime, INTERVAL -72 HOUR) AND ce.charttime < date_add(ic.intime, INTERVAL 4 HOUR)\n",
        "            AND ce.valuenum > .01 THEN 1 ELSE 0 END) as exclude_troponin\n",
        "          FROM `physionet-data.mimic_icu.chartevents` ce\n",
        "          INNER JOIN `physionet-data.mimic_icu.icustays` ic\n",
        "              ON ce.stay_id = ic.stay_id\n",
        "          WHERE ce.subject_id IN ({id_str}) AND ce.itemid = 227429\n",
        "          GROUP BY ce.stay_id) tp\n",
        "    ON ie.stay_id = tp.stay_id\n",
        "WHERE ie.subject_id IN ({id_str})\n",
        "''')\n",
        "# note \"inplace\" -> this argument tells the dataframe to be modified in-place\n",
        "# i.e., we don't need to do df = df.sort_values(), we can just call the function as-is\n",
        "# be careful with inplace! if you do:\n",
        "#   df = df.sort_values(inplace=True), it will set `df` to None\n",
        "# ... because you're using it wrong (either re-assign the variable, or use the inplace arg, but not both!)\n",
        "df.sort_values('subject_id', inplace=True)\n",
        "display(df)"
      ],
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/",
          "height": 396
        },
        "id": "tvOmhwyH3GuD",
        "outputId": "4ba2b472-558b-4d26-bf13-0e10ae0cf6d6"
      },
      "execution_count": null,
      "outputs": [
        {
          "output_type": "display_data",
          "data": {
            "text/plain": [
              "   subject_id   hadm_id   stay_id  exclude_non_adult  exclude_short_stays  \\\n",
              "7    10000032  29079034  39553978                  0                    0   \n",
              "5    10001884  26184834  37510196                  0                    0   \n",
              "6    10002223  22494570  39638202                  0                    0   \n",
              "4    10002443  21329021  35044219                  0                    0   \n",
              "8    10002495  24982426  36753294                  0                    0   \n",
              "0    10003400  20214994  32128372                  0                    0   \n",
              "1    10003400  23559586  34577403                  0                    0   \n",
              "2    10003400  23559586  38383343                  0                    0   \n",
              "3    10005866  20364112  34170353                  0                    0   \n",
              "\n",
              "   exclude_readmission  exclude_other_hospitals  exclude_first_heart_rate  \\\n",
              "7                    0                        0                         0   \n",
              "5                    0                        0                         0   \n",
              "6                    0                        0                         0   \n",
              "4                    0                        1                         0   \n",
              "8                    0                        1                         1   \n",
              "0                    0                        0                         1   \n",
              "1                    1                        1                         0   \n",
              "2                    1                        1                         0   \n",
              "3                    0                        0                         0   \n",
              "\n",
              "   exclude_first_heart_rhythm  exclude_chronic  exclude_troponin  \n",
              "7                           0                0                 0  \n",
              "5                           0                0                 1  \n",
              "6                           0                0                 0  \n",
              "4                           0                0                 0  \n",
              "8                           0                0                 1  \n",
              "0                           1                1                 0  \n",
              "1                           1                1                 0  \n",
              "2                           1                1                 0  \n",
              "3                           0                0                 0  "
            ],
            "text/html": [
              "\n",
              "  <div id=\"df-dc7af01c-8747-4bc5-8920-b91ffab530fb\">\n",
              "    <div class=\"colab-df-container\">\n",
              "      <div>\n",
              "<style scoped>\n",
              "    .dataframe tbody tr th:only-of-type {\n",
              "        vertical-align: middle;\n",
              "    }\n",
              "\n",
              "    .dataframe tbody tr th {\n",
              "        vertical-align: top;\n",
              "    }\n",
              "\n",
              "    .dataframe thead th {\n",
              "        text-align: right;\n",
              "    }\n",
              "</style>\n",
              "<table border=\"1\" class=\"dataframe\">\n",
              "  <thead>\n",
              "    <tr style=\"text-align: right;\">\n",
              "      <th></th>\n",
              "      <th>subject_id</th>\n",
              "      <th>hadm_id</th>\n",
              "      <th>stay_id</th>\n",
              "      <th>exclude_non_adult</th>\n",
              "      <th>exclude_short_stays</th>\n",
              "      <th>exclude_readmission</th>\n",
              "      <th>exclude_other_hospitals</th>\n",
              "      <th>exclude_first_heart_rate</th>\n",
              "      <th>exclude_first_heart_rhythm</th>\n",
              "      <th>exclude_chronic</th>\n",
              "      <th>exclude_troponin</th>\n",
              "    </tr>\n",
              "  </thead>\n",
              "  <tbody>\n",
              "    <tr>\n",
              "      <th>7</th>\n",
              "      <td>10000032</td>\n",
              "      <td>29079034</td>\n",
              "      <td>39553978</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>5</th>\n",
              "      <td>10001884</td>\n",
              "      <td>26184834</td>\n",
              "      <td>37510196</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>1</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>6</th>\n",
              "      <td>10002223</td>\n",
              "      <td>22494570</td>\n",
              "      <td>39638202</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>4</th>\n",
              "      <td>10002443</td>\n",
              "      <td>21329021</td>\n",
              "      <td>35044219</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>1</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>8</th>\n",
              "      <td>10002495</td>\n",
              "      <td>24982426</td>\n",
              "      <td>36753294</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>1</td>\n",
              "      <td>1</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>1</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>0</th>\n",
              "      <td>10003400</td>\n",
              "      <td>20214994</td>\n",
              "      <td>32128372</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>1</td>\n",
              "      <td>1</td>\n",
              "      <td>1</td>\n",
              "      <td>0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>1</th>\n",
              "      <td>10003400</td>\n",
              "      <td>23559586</td>\n",
              "      <td>34577403</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>1</td>\n",
              "      <td>1</td>\n",
              "      <td>0</td>\n",
              "      <td>1</td>\n",
              "      <td>1</td>\n",
              "      <td>0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>2</th>\n",
              "      <td>10003400</td>\n",
              "      <td>23559586</td>\n",
              "      <td>38383343</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>1</td>\n",
              "      <td>1</td>\n",
              "      <td>0</td>\n",
              "      <td>1</td>\n",
              "      <td>1</td>\n",
              "      <td>0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>3</th>\n",
              "      <td>10005866</td>\n",
              "      <td>20364112</td>\n",
              "      <td>34170353</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "    </tr>\n",
              "  </tbody>\n",
              "</table>\n",
              "</div>\n",
              "      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-dc7af01c-8747-4bc5-8920-b91ffab530fb')\"\n",
              "              title=\"Convert this dataframe to an interactive table.\"\n",
              "              style=\"display:none;\">\n",
              "        \n",
              "  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n",
              "       width=\"24px\">\n",
              "    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n",
              "    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n",
              "  </svg>\n",
              "      </button>\n",
              "      \n",
              "  <style>\n",
              "    .colab-df-container {\n",
              "      display:flex;\n",
              "      flex-wrap:wrap;\n",
              "      gap: 12px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert {\n",
              "      background-color: #E8F0FE;\n",
              "      border: none;\n",
              "      border-radius: 50%;\n",
              "      cursor: pointer;\n",
              "      display: none;\n",
              "      fill: #1967D2;\n",
              "      height: 32px;\n",
              "      padding: 0 0 0 0;\n",
              "      width: 32px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert:hover {\n",
              "      background-color: #E2EBFA;\n",
              "      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n",
              "      fill: #174EA6;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert {\n",
              "      background-color: #3B4455;\n",
              "      fill: #D2E3FC;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert:hover {\n",
              "      background-color: #434B5C;\n",
              "      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n",
              "      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n",
              "      fill: #FFFFFF;\n",
              "    }\n",
              "  </style>\n",
              "\n",
              "      <script>\n",
              "        const buttonEl =\n",
              "          document.querySelector('#df-dc7af01c-8747-4bc5-8920-b91ffab530fb button.colab-df-convert');\n",
              "        buttonEl.style.display =\n",
              "          google.colab.kernel.accessAllowed ? 'block' : 'none';\n",
              "\n",
              "        async function convertToInteractive(key) {\n",
              "          const element = document.querySelector('#df-dc7af01c-8747-4bc5-8920-b91ffab530fb');\n",
              "          const dataTable =\n",
              "            await google.colab.kernel.invokeFunction('convertToInteractive',\n",
              "                                                     [key], {});\n",
              "          if (!dataTable) return;\n",
              "\n",
              "          const docLinkHtml = 'Like what you see? Visit the ' +\n",
              "            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n",
              "            + ' to learn more about interactive tables.';\n",
              "          element.innerHTML = '';\n",
              "          dataTable['output_type'] = 'display_data';\n",
              "          await google.colab.output.renderOutput(dataTable, element);\n",
              "          const docLink = document.createElement('div');\n",
              "          docLink.innerHTML = docLinkHtml;\n",
              "          element.appendChild(docLink);\n",
              "        }\n",
              "      </script>\n",
              "    </div>\n",
              "  </div>\n",
              "  "
            ]
          },
          "metadata": {}
        }
      ]
    },
    {
      "cell_type": "markdown",
      "source": [
        "### Medications\n",
        "\n",
        "Question 13: Write a query to extract the `starttime`, `endtime`, and `rate` for the following medication from *inputevents*:\n",
        "\n",
        "* amiodarone\n",
        "* diltiazem\n",
        "* metoprolol\n",
        "\n",
        "The result should have the following columns: `stay_id`, `drug`, `starttime`, `endtime`, `rate`. Only extract data for our given `subject_id` above."
      ],
      "metadata": {
        "id": "PDZqxaYCX3o5"
      }
    },
    {
      "cell_type": "code",
      "source": [
        "df = run_query(f'''\n",
        "SELECT DISTINCT label\n",
        "FROM `physionet-data.mimic_icu.d_items` \n",
        "WHERE label LIKE \"%Amiodarone%\"\n",
        "''')\n",
        "display(df)"
      ],
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/",
          "height": 175
        },
        "id": "i5wBzFoN_OnZ",
        "outputId": "bb7c842a-99de-4523-b801-ea02f5c48e06"
      },
      "execution_count": null,
      "outputs": [
        {
          "output_type": "display_data",
          "data": {
            "text/plain": [
              "                label\n",
              "0          Amiodarone\n",
              "1  Amiodarone 600/500\n",
              "2  Amiodarone 450/250\n",
              "3  Amiodarone 150/100"
            ],
            "text/html": [
              "\n",
              "  <div id=\"df-303602e8-69af-4738-9c6f-b2c4611b1361\">\n",
              "    <div class=\"colab-df-container\">\n",
              "      <div>\n",
              "<style scoped>\n",
              "    .dataframe tbody tr th:only-of-type {\n",
              "        vertical-align: middle;\n",
              "    }\n",
              "\n",
              "    .dataframe tbody tr th {\n",
              "        vertical-align: top;\n",
              "    }\n",
              "\n",
              "    .dataframe thead th {\n",
              "        text-align: right;\n",
              "    }\n",
              "</style>\n",
              "<table border=\"1\" class=\"dataframe\">\n",
              "  <thead>\n",
              "    <tr style=\"text-align: right;\">\n",
              "      <th></th>\n",
              "      <th>label</th>\n",
              "    </tr>\n",
              "  </thead>\n",
              "  <tbody>\n",
              "    <tr>\n",
              "      <th>0</th>\n",
              "      <td>Amiodarone</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>1</th>\n",
              "      <td>Amiodarone 600/500</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>2</th>\n",
              "      <td>Amiodarone 450/250</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>3</th>\n",
              "      <td>Amiodarone 150/100</td>\n",
              "    </tr>\n",
              "  </tbody>\n",
              "</table>\n",
              "</div>\n",
              "      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-303602e8-69af-4738-9c6f-b2c4611b1361')\"\n",
              "              title=\"Convert this dataframe to an interactive table.\"\n",
              "              style=\"display:none;\">\n",
              "        \n",
              "  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n",
              "       width=\"24px\">\n",
              "    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n",
              "    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n",
              "  </svg>\n",
              "      </button>\n",
              "      \n",
              "  <style>\n",
              "    .colab-df-container {\n",
              "      display:flex;\n",
              "      flex-wrap:wrap;\n",
              "      gap: 12px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert {\n",
              "      background-color: #E8F0FE;\n",
              "      border: none;\n",
              "      border-radius: 50%;\n",
              "      cursor: pointer;\n",
              "      display: none;\n",
              "      fill: #1967D2;\n",
              "      height: 32px;\n",
              "      padding: 0 0 0 0;\n",
              "      width: 32px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert:hover {\n",
              "      background-color: #E2EBFA;\n",
              "      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n",
              "      fill: #174EA6;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert {\n",
              "      background-color: #3B4455;\n",
              "      fill: #D2E3FC;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert:hover {\n",
              "      background-color: #434B5C;\n",
              "      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n",
              "      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n",
              "      fill: #FFFFFF;\n",
              "    }\n",
              "  </style>\n",
              "\n",
              "      <script>\n",
              "        const buttonEl =\n",
              "          document.querySelector('#df-303602e8-69af-4738-9c6f-b2c4611b1361 button.colab-df-convert');\n",
              "        buttonEl.style.display =\n",
              "          google.colab.kernel.accessAllowed ? 'block' : 'none';\n",
              "\n",
              "        async function convertToInteractive(key) {\n",
              "          const element = document.querySelector('#df-303602e8-69af-4738-9c6f-b2c4611b1361');\n",
              "          const dataTable =\n",
              "            await google.colab.kernel.invokeFunction('convertToInteractive',\n",
              "                                                     [key], {});\n",
              "          if (!dataTable) return;\n",
              "\n",
              "          const docLinkHtml = 'Like what you see? Visit the ' +\n",
              "            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n",
              "            + ' to learn more about interactive tables.';\n",
              "          element.innerHTML = '';\n",
              "          dataTable['output_type'] = 'display_data';\n",
              "          await google.colab.output.renderOutput(dataTable, element);\n",
              "          const docLink = document.createElement('div');\n",
              "          docLink.innerHTML = docLinkHtml;\n",
              "          element.appendChild(docLink);\n",
              "        }\n",
              "      </script>\n",
              "    </div>\n",
              "  </div>\n",
              "  "
            ]
          },
          "metadata": {}
        }
      ]
    },
    {
      "cell_type": "code",
      "source": [
        "df_inp = run_query(f'''\n",
        "SELECT ie.subject_id, ie.stay_id, di.label, ie.starttime, ie.endtime, ie.rate\n",
        "FROM `physionet-data.mimic_icu.inputevents` ie \n",
        "LEFT JOIN `physionet-data.mimic_icu.d_items` di\n",
        "    ON ie.itemid = di.itemid\n",
        "WHERE label IN (\"Amiodarone 600/500\", \"Amiodarone 450/250\", \"Amiodarone 150/100\", \n",
        "                \"Amiodarone\", \"Diltiazem\", \"Metoprolol\") AND ie.subject_id IN ({id_str})\n",
        "''')\n",
        "df_inp = df_inp.sort_values(['subject_id', 'starttime'])\n",
        "display(df_inp)"
      ],
      "metadata": {
        "id": "9s4-5V5JX3OO",
        "colab": {
          "base_uri": "https://localhost:8080/",
          "height": 1000
        },
        "outputId": "ab003fdc-5283-4883-d8ce-ec1b761158a1"
      },
      "execution_count": null,
      "outputs": [
        {
          "output_type": "display_data",
          "data": {
            "text/plain": [
              "    subject_id   stay_id               label           starttime  \\\n",
              "7     10002443  35044219          Metoprolol 2183-10-18 21:10:00   \n",
              "27    10002495  36753294          Metoprolol 2141-05-23 19:08:00   \n",
              "4     10003400  32128372  Amiodarone 600/500 2137-02-27 16:32:00   \n",
              "6     10003400  32128372          Amiodarone 2137-02-27 16:32:00   \n",
              "12    10003400  32128372  Amiodarone 600/500 2137-02-27 22:28:00   \n",
              "35    10003400  32128372  Amiodarone 600/500 2137-02-28 06:32:00   \n",
              "33    10003400  32128372           Diltiazem 2137-02-28 11:23:00   \n",
              "40    10003400  32128372           Diltiazem 2137-02-28 11:51:00   \n",
              "3     10003400  32128372           Diltiazem 2137-02-28 12:58:00   \n",
              "24    10003400  32128372           Diltiazem 2137-02-28 15:34:00   \n",
              "11    10003400  32128372           Diltiazem 2137-02-28 17:18:00   \n",
              "10    10003400  32128372           Diltiazem 2137-02-28 18:37:00   \n",
              "41    10003400  32128372           Diltiazem 2137-02-28 23:07:00   \n",
              "0     10003400  32128372           Diltiazem 2137-03-01 04:34:00   \n",
              "2     10003400  32128372           Diltiazem 2137-03-01 09:12:00   \n",
              "15    10003400  32128372  Amiodarone 600/500 2137-03-01 14:16:00   \n",
              "23    10003400  32128372           Diltiazem 2137-03-01 17:27:00   \n",
              "29    10003400  32128372          Metoprolol 2137-03-01 21:55:00   \n",
              "1     10003400  32128372           Diltiazem 2137-03-02 01:38:00   \n",
              "30    10003400  32128372          Metoprolol 2137-03-02 07:40:00   \n",
              "38    10003400  32128372           Diltiazem 2137-03-02 09:52:00   \n",
              "14    10003400  32128372  Amiodarone 600/500 2137-03-02 10:09:00   \n",
              "16    10003400  32128372           Diltiazem 2137-03-02 17:55:00   \n",
              "5     10003400  32128372           Diltiazem 2137-03-02 18:07:00   \n",
              "32    10003400  32128372           Diltiazem 2137-03-03 06:38:00   \n",
              "34    10003400  32128372           Diltiazem 2137-03-03 12:09:00   \n",
              "22    10003400  32128372           Diltiazem 2137-03-04 01:29:00   \n",
              "9     10003400  38383343          Metoprolol 2137-08-26 12:00:00   \n",
              "36    10003400  38383343          Metoprolol 2137-08-26 14:16:00   \n",
              "20    10003400  38383343          Metoprolol 2137-08-26 16:18:00   \n",
              "8     10003400  38383343          Metoprolol 2137-08-26 16:48:00   \n",
              "26    10003400  38383343          Metoprolol 2137-08-26 19:07:00   \n",
              "28    10003400  38383343          Metoprolol 2137-08-27 00:00:00   \n",
              "31    10003400  38383343          Metoprolol 2137-08-27 06:08:00   \n",
              "21    10003400  38383343          Metoprolol 2137-08-27 12:30:00   \n",
              "17    10003400  38383343          Amiodarone 2137-08-28 21:11:00   \n",
              "37    10003400  38383343          Metoprolol 2137-08-29 00:30:00   \n",
              "18    10005866  34170353          Metoprolol 2149-10-03 11:30:00   \n",
              "19    10005866  34170353          Metoprolol 2149-10-03 13:05:00   \n",
              "25    10005866  34170353  Amiodarone 600/500 2149-10-03 14:42:00   \n",
              "13    10005866  34170353  Amiodarone 600/500 2149-10-03 20:52:00   \n",
              "39    10005866  34170353  Amiodarone 600/500 2149-10-04 04:29:00   \n",
              "\n",
              "               endtime       rate  \n",
              "7  2183-10-18 21:11:00        NaN  \n",
              "27 2141-05-23 19:09:00        NaN  \n",
              "4  2137-02-27 22:28:00   1.000000  \n",
              "6  2137-02-27 16:33:00        NaN  \n",
              "12 2137-02-28 06:32:00   0.504132  \n",
              "35 2137-02-28 16:13:00   0.500000  \n",
              "33 2137-02-28 11:51:00   5.000000  \n",
              "40 2137-02-28 12:58:00   9.999999  \n",
              "3  2137-02-28 15:34:00  15.000000  \n",
              "24 2137-02-28 17:18:00   9.999999  \n",
              "11 2137-02-28 18:37:00   5.000000  \n",
              "10 2137-02-28 23:07:00  10.796223  \n",
              "41 2137-03-01 04:34:00  10.017182  \n",
              "0  2137-03-01 09:12:00  15.044460  \n",
              "2  2137-03-01 17:27:00  15.042425  \n",
              "15 2137-03-02 10:09:00   0.502934  \n",
              "23 2137-03-02 01:38:00  15.042770  \n",
              "29 2137-03-01 21:56:00        NaN  \n",
              "1  2137-03-02 09:52:00  15.182186  \n",
              "30 2137-03-02 07:41:00        NaN  \n",
              "38 2137-03-02 17:55:00  15.182186  \n",
              "14 2137-03-02 18:21:00   0.500000  \n",
              "16 2137-03-02 18:07:00  13.914999  \n",
              "5  2137-03-03 06:38:00   9.986683  \n",
              "32 2137-03-03 12:09:00   9.823768  \n",
              "34 2137-03-04 01:29:00   5.310450  \n",
              "22 2137-03-04 07:21:00   4.914810  \n",
              "9  2137-08-26 12:01:00        NaN  \n",
              "36 2137-08-26 14:17:00        NaN  \n",
              "20 2137-08-26 16:19:00        NaN  \n",
              "8  2137-08-26 16:49:00        NaN  \n",
              "26 2137-08-26 19:08:00        NaN  \n",
              "28 2137-08-27 00:01:00        NaN  \n",
              "31 2137-08-27 06:09:00        NaN  \n",
              "21 2137-08-27 12:31:00        NaN  \n",
              "17 2137-08-28 21:12:00        NaN  \n",
              "37 2137-08-29 00:31:00        NaN  \n",
              "18 2149-10-03 11:31:00        NaN  \n",
              "19 2149-10-03 13:06:00        NaN  \n",
              "25 2149-10-03 20:52:00   1.000000  \n",
              "13 2149-10-04 04:29:00   0.503282  \n",
              "39 2149-10-04 08:02:00   0.500000  "
            ],
            "text/html": [
              "\n",
              "  <div id=\"df-855defd4-6e96-44f8-8359-17c7c98ee7b2\">\n",
              "    <div class=\"colab-df-container\">\n",
              "      <div>\n",
              "<style scoped>\n",
              "    .dataframe tbody tr th:only-of-type {\n",
              "        vertical-align: middle;\n",
              "    }\n",
              "\n",
              "    .dataframe tbody tr th {\n",
              "        vertical-align: top;\n",
              "    }\n",
              "\n",
              "    .dataframe thead th {\n",
              "        text-align: right;\n",
              "    }\n",
              "</style>\n",
              "<table border=\"1\" class=\"dataframe\">\n",
              "  <thead>\n",
              "    <tr style=\"text-align: right;\">\n",
              "      <th></th>\n",
              "      <th>subject_id</th>\n",
              "      <th>stay_id</th>\n",
              "      <th>label</th>\n",
              "      <th>starttime</th>\n",
              "      <th>endtime</th>\n",
              "      <th>rate</th>\n",
              "    </tr>\n",
              "  </thead>\n",
              "  <tbody>\n",
              "    <tr>\n",
              "      <th>7</th>\n",
              "      <td>10002443</td>\n",
              "      <td>35044219</td>\n",
              "      <td>Metoprolol</td>\n",
              "      <td>2183-10-18 21:10:00</td>\n",
              "      <td>2183-10-18 21:11:00</td>\n",
              "      <td>NaN</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>27</th>\n",
              "      <td>10002495</td>\n",
              "      <td>36753294</td>\n",
              "      <td>Metoprolol</td>\n",
              "      <td>2141-05-23 19:08:00</td>\n",
              "      <td>2141-05-23 19:09:00</td>\n",
              "      <td>NaN</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>4</th>\n",
              "      <td>10003400</td>\n",
              "      <td>32128372</td>\n",
              "      <td>Amiodarone 600/500</td>\n",
              "      <td>2137-02-27 16:32:00</td>\n",
              "      <td>2137-02-27 22:28:00</td>\n",
              "      <td>1.000000</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>6</th>\n",
              "      <td>10003400</td>\n",
              "      <td>32128372</td>\n",
              "      <td>Amiodarone</td>\n",
              "      <td>2137-02-27 16:32:00</td>\n",
              "      <td>2137-02-27 16:33:00</td>\n",
              "      <td>NaN</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>12</th>\n",
              "      <td>10003400</td>\n",
              "      <td>32128372</td>\n",
              "      <td>Amiodarone 600/500</td>\n",
              "      <td>2137-02-27 22:28:00</td>\n",
              "      <td>2137-02-28 06:32:00</td>\n",
              "      <td>0.504132</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>35</th>\n",
              "      <td>10003400</td>\n",
              "      <td>32128372</td>\n",
              "      <td>Amiodarone 600/500</td>\n",
              "      <td>2137-02-28 06:32:00</td>\n",
              "      <td>2137-02-28 16:13:00</td>\n",
              "      <td>0.500000</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>33</th>\n",
              "      <td>10003400</td>\n",
              "      <td>32128372</td>\n",
              "      <td>Diltiazem</td>\n",
              "      <td>2137-02-28 11:23:00</td>\n",
              "      <td>2137-02-28 11:51:00</td>\n",
              "      <td>5.000000</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>40</th>\n",
              "      <td>10003400</td>\n",
              "      <td>32128372</td>\n",
              "      <td>Diltiazem</td>\n",
              "      <td>2137-02-28 11:51:00</td>\n",
              "      <td>2137-02-28 12:58:00</td>\n",
              "      <td>9.999999</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>3</th>\n",
              "      <td>10003400</td>\n",
              "      <td>32128372</td>\n",
              "      <td>Diltiazem</td>\n",
              "      <td>2137-02-28 12:58:00</td>\n",
              "      <td>2137-02-28 15:34:00</td>\n",
              "      <td>15.000000</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>24</th>\n",
              "      <td>10003400</td>\n",
              "      <td>32128372</td>\n",
              "      <td>Diltiazem</td>\n",
              "      <td>2137-02-28 15:34:00</td>\n",
              "      <td>2137-02-28 17:18:00</td>\n",
              "      <td>9.999999</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>11</th>\n",
              "      <td>10003400</td>\n",
              "      <td>32128372</td>\n",
              "      <td>Diltiazem</td>\n",
              "      <td>2137-02-28 17:18:00</td>\n",
              "      <td>2137-02-28 18:37:00</td>\n",
              "      <td>5.000000</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>10</th>\n",
              "      <td>10003400</td>\n",
              "      <td>32128372</td>\n",
              "      <td>Diltiazem</td>\n",
              "      <td>2137-02-28 18:37:00</td>\n",
              "      <td>2137-02-28 23:07:00</td>\n",
              "      <td>10.796223</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>41</th>\n",
              "      <td>10003400</td>\n",
              "      <td>32128372</td>\n",
              "      <td>Diltiazem</td>\n",
              "      <td>2137-02-28 23:07:00</td>\n",
              "      <td>2137-03-01 04:34:00</td>\n",
              "      <td>10.017182</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>0</th>\n",
              "      <td>10003400</td>\n",
              "      <td>32128372</td>\n",
              "      <td>Diltiazem</td>\n",
              "      <td>2137-03-01 04:34:00</td>\n",
              "      <td>2137-03-01 09:12:00</td>\n",
              "      <td>15.044460</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>2</th>\n",
              "      <td>10003400</td>\n",
              "      <td>32128372</td>\n",
              "      <td>Diltiazem</td>\n",
              "      <td>2137-03-01 09:12:00</td>\n",
              "      <td>2137-03-01 17:27:00</td>\n",
              "      <td>15.042425</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>15</th>\n",
              "      <td>10003400</td>\n",
              "      <td>32128372</td>\n",
              "      <td>Amiodarone 600/500</td>\n",
              "      <td>2137-03-01 14:16:00</td>\n",
              "      <td>2137-03-02 10:09:00</td>\n",
              "      <td>0.502934</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>23</th>\n",
              "      <td>10003400</td>\n",
              "      <td>32128372</td>\n",
              "      <td>Diltiazem</td>\n",
              "      <td>2137-03-01 17:27:00</td>\n",
              "      <td>2137-03-02 01:38:00</td>\n",
              "      <td>15.042770</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>29</th>\n",
              "      <td>10003400</td>\n",
              "      <td>32128372</td>\n",
              "      <td>Metoprolol</td>\n",
              "      <td>2137-03-01 21:55:00</td>\n",
              "      <td>2137-03-01 21:56:00</td>\n",
              "      <td>NaN</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>1</th>\n",
              "      <td>10003400</td>\n",
              "      <td>32128372</td>\n",
              "      <td>Diltiazem</td>\n",
              "      <td>2137-03-02 01:38:00</td>\n",
              "      <td>2137-03-02 09:52:00</td>\n",
              "      <td>15.182186</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>30</th>\n",
              "      <td>10003400</td>\n",
              "      <td>32128372</td>\n",
              "      <td>Metoprolol</td>\n",
              "      <td>2137-03-02 07:40:00</td>\n",
              "      <td>2137-03-02 07:41:00</td>\n",
              "      <td>NaN</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>38</th>\n",
              "      <td>10003400</td>\n",
              "      <td>32128372</td>\n",
              "      <td>Diltiazem</td>\n",
              "      <td>2137-03-02 09:52:00</td>\n",
              "      <td>2137-03-02 17:55:00</td>\n",
              "      <td>15.182186</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>14</th>\n",
              "      <td>10003400</td>\n",
              "      <td>32128372</td>\n",
              "      <td>Amiodarone 600/500</td>\n",
              "      <td>2137-03-02 10:09:00</td>\n",
              "      <td>2137-03-02 18:21:00</td>\n",
              "      <td>0.500000</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>16</th>\n",
              "      <td>10003400</td>\n",
              "      <td>32128372</td>\n",
              "      <td>Diltiazem</td>\n",
              "      <td>2137-03-02 17:55:00</td>\n",
              "      <td>2137-03-02 18:07:00</td>\n",
              "      <td>13.914999</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>5</th>\n",
              "      <td>10003400</td>\n",
              "      <td>32128372</td>\n",
              "      <td>Diltiazem</td>\n",
              "      <td>2137-03-02 18:07:00</td>\n",
              "      <td>2137-03-03 06:38:00</td>\n",
              "      <td>9.986683</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>32</th>\n",
              "      <td>10003400</td>\n",
              "      <td>32128372</td>\n",
              "      <td>Diltiazem</td>\n",
              "      <td>2137-03-03 06:38:00</td>\n",
              "      <td>2137-03-03 12:09:00</td>\n",
              "      <td>9.823768</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>34</th>\n",
              "      <td>10003400</td>\n",
              "      <td>32128372</td>\n",
              "      <td>Diltiazem</td>\n",
              "      <td>2137-03-03 12:09:00</td>\n",
              "      <td>2137-03-04 01:29:00</td>\n",
              "      <td>5.310450</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>22</th>\n",
              "      <td>10003400</td>\n",
              "      <td>32128372</td>\n",
              "      <td>Diltiazem</td>\n",
              "      <td>2137-03-04 01:29:00</td>\n",
              "      <td>2137-03-04 07:21:00</td>\n",
              "      <td>4.914810</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>9</th>\n",
              "      <td>10003400</td>\n",
              "      <td>38383343</td>\n",
              "      <td>Metoprolol</td>\n",
              "      <td>2137-08-26 12:00:00</td>\n",
              "      <td>2137-08-26 12:01:00</td>\n",
              "      <td>NaN</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>36</th>\n",
              "      <td>10003400</td>\n",
              "      <td>38383343</td>\n",
              "      <td>Metoprolol</td>\n",
              "      <td>2137-08-26 14:16:00</td>\n",
              "      <td>2137-08-26 14:17:00</td>\n",
              "      <td>NaN</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>20</th>\n",
              "      <td>10003400</td>\n",
              "      <td>38383343</td>\n",
              "      <td>Metoprolol</td>\n",
              "      <td>2137-08-26 16:18:00</td>\n",
              "      <td>2137-08-26 16:19:00</td>\n",
              "      <td>NaN</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>8</th>\n",
              "      <td>10003400</td>\n",
              "      <td>38383343</td>\n",
              "      <td>Metoprolol</td>\n",
              "      <td>2137-08-26 16:48:00</td>\n",
              "      <td>2137-08-26 16:49:00</td>\n",
              "      <td>NaN</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>26</th>\n",
              "      <td>10003400</td>\n",
              "      <td>38383343</td>\n",
              "      <td>Metoprolol</td>\n",
              "      <td>2137-08-26 19:07:00</td>\n",
              "      <td>2137-08-26 19:08:00</td>\n",
              "      <td>NaN</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>28</th>\n",
              "      <td>10003400</td>\n",
              "      <td>38383343</td>\n",
              "      <td>Metoprolol</td>\n",
              "      <td>2137-08-27 00:00:00</td>\n",
              "      <td>2137-08-27 00:01:00</td>\n",
              "      <td>NaN</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>31</th>\n",
              "      <td>10003400</td>\n",
              "      <td>38383343</td>\n",
              "      <td>Metoprolol</td>\n",
              "      <td>2137-08-27 06:08:00</td>\n",
              "      <td>2137-08-27 06:09:00</td>\n",
              "      <td>NaN</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>21</th>\n",
              "      <td>10003400</td>\n",
              "      <td>38383343</td>\n",
              "      <td>Metoprolol</td>\n",
              "      <td>2137-08-27 12:30:00</td>\n",
              "      <td>2137-08-27 12:31:00</td>\n",
              "      <td>NaN</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>17</th>\n",
              "      <td>10003400</td>\n",
              "      <td>38383343</td>\n",
              "      <td>Amiodarone</td>\n",
              "      <td>2137-08-28 21:11:00</td>\n",
              "      <td>2137-08-28 21:12:00</td>\n",
              "      <td>NaN</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>37</th>\n",
              "      <td>10003400</td>\n",
              "      <td>38383343</td>\n",
              "      <td>Metoprolol</td>\n",
              "      <td>2137-08-29 00:30:00</td>\n",
              "      <td>2137-08-29 00:31:00</td>\n",
              "      <td>NaN</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>18</th>\n",
              "      <td>10005866</td>\n",
              "      <td>34170353</td>\n",
              "      <td>Metoprolol</td>\n",
              "      <td>2149-10-03 11:30:00</td>\n",
              "      <td>2149-10-03 11:31:00</td>\n",
              "      <td>NaN</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>19</th>\n",
              "      <td>10005866</td>\n",
              "      <td>34170353</td>\n",
              "      <td>Metoprolol</td>\n",
              "      <td>2149-10-03 13:05:00</td>\n",
              "      <td>2149-10-03 13:06:00</td>\n",
              "      <td>NaN</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>25</th>\n",
              "      <td>10005866</td>\n",
              "      <td>34170353</td>\n",
              "      <td>Amiodarone 600/500</td>\n",
              "      <td>2149-10-03 14:42:00</td>\n",
              "      <td>2149-10-03 20:52:00</td>\n",
              "      <td>1.000000</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>13</th>\n",
              "      <td>10005866</td>\n",
              "      <td>34170353</td>\n",
              "      <td>Amiodarone 600/500</td>\n",
              "      <td>2149-10-03 20:52:00</td>\n",
              "      <td>2149-10-04 04:29:00</td>\n",
              "      <td>0.503282</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>39</th>\n",
              "      <td>10005866</td>\n",
              "      <td>34170353</td>\n",
              "      <td>Amiodarone 600/500</td>\n",
              "      <td>2149-10-04 04:29:00</td>\n",
              "      <td>2149-10-04 08:02:00</td>\n",
              "      <td>0.500000</td>\n",
              "    </tr>\n",
              "  </tbody>\n",
              "</table>\n",
              "</div>\n",
              "      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-855defd4-6e96-44f8-8359-17c7c98ee7b2')\"\n",
              "              title=\"Convert this dataframe to an interactive table.\"\n",
              "              style=\"display:none;\">\n",
              "        \n",
              "  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n",
              "       width=\"24px\">\n",
              "    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n",
              "    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n",
              "  </svg>\n",
              "      </button>\n",
              "      \n",
              "  <style>\n",
              "    .colab-df-container {\n",
              "      display:flex;\n",
              "      flex-wrap:wrap;\n",
              "      gap: 12px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert {\n",
              "      background-color: #E8F0FE;\n",
              "      border: none;\n",
              "      border-radius: 50%;\n",
              "      cursor: pointer;\n",
              "      display: none;\n",
              "      fill: #1967D2;\n",
              "      height: 32px;\n",
              "      padding: 0 0 0 0;\n",
              "      width: 32px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert:hover {\n",
              "      background-color: #E2EBFA;\n",
              "      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n",
              "      fill: #174EA6;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert {\n",
              "      background-color: #3B4455;\n",
              "      fill: #D2E3FC;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert:hover {\n",
              "      background-color: #434B5C;\n",
              "      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n",
              "      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n",
              "      fill: #FFFFFF;\n",
              "    }\n",
              "  </style>\n",
              "\n",
              "      <script>\n",
              "        const buttonEl =\n",
              "          document.querySelector('#df-855defd4-6e96-44f8-8359-17c7c98ee7b2 button.colab-df-convert');\n",
              "        buttonEl.style.display =\n",
              "          google.colab.kernel.accessAllowed ? 'block' : 'none';\n",
              "\n",
              "        async function convertToInteractive(key) {\n",
              "          const element = document.querySelector('#df-855defd4-6e96-44f8-8359-17c7c98ee7b2');\n",
              "          const dataTable =\n",
              "            await google.colab.kernel.invokeFunction('convertToInteractive',\n",
              "                                                     [key], {});\n",
              "          if (!dataTable) return;\n",
              "\n",
              "          const docLinkHtml = 'Like what you see? Visit the ' +\n",
              "            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n",
              "            + ' to learn more about interactive tables.';\n",
              "          element.innerHTML = '';\n",
              "          dataTable['output_type'] = 'display_data';\n",
              "          await google.colab.output.renderOutput(dataTable, element);\n",
              "          const docLink = document.createElement('div');\n",
              "          docLink.innerHTML = docLinkHtml;\n",
              "          element.appendChild(docLink);\n",
              "        }\n",
              "      </script>\n",
              "    </div>\n",
              "  </div>\n",
              "  "
            ]
          },
          "metadata": {}
        }
      ]
    },
    {
      "cell_type": "markdown",
      "source": [
        "Question 14: For the same medications as above, extract the data using the *emar* table."
      ],
      "metadata": {
        "id": "zLZfcyCnYGir"
      }
    },
    {
      "cell_type": "code",
      "source": [
        "df = run_query(f'''\n",
        "SELECT DISTINCT medication\n",
        "FROM `physionet-data.mimic_hosp.emar` \n",
        "WHERE medication LIKE \"%Amiodarone%\" AND subject_id IN ({id_str})\n",
        "''')\n",
        "display(df)"
      ],
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/",
          "height": 81
        },
        "id": "sNaNhYiW9NJD",
        "outputId": "3e4d64b3-de0e-4c7a-f180-86dc4116c572"
      },
      "execution_count": null,
      "outputs": [
        {
          "output_type": "display_data",
          "data": {
            "text/plain": [
              "   medication\n",
              "0  Amiodarone"
            ],
            "text/html": [
              "\n",
              "  <div id=\"df-f709f973-a999-4fc8-8ad9-19d73e667a3d\">\n",
              "    <div class=\"colab-df-container\">\n",
              "      <div>\n",
              "<style scoped>\n",
              "    .dataframe tbody tr th:only-of-type {\n",
              "        vertical-align: middle;\n",
              "    }\n",
              "\n",
              "    .dataframe tbody tr th {\n",
              "        vertical-align: top;\n",
              "    }\n",
              "\n",
              "    .dataframe thead th {\n",
              "        text-align: right;\n",
              "    }\n",
              "</style>\n",
              "<table border=\"1\" class=\"dataframe\">\n",
              "  <thead>\n",
              "    <tr style=\"text-align: right;\">\n",
              "      <th></th>\n",
              "      <th>medication</th>\n",
              "    </tr>\n",
              "  </thead>\n",
              "  <tbody>\n",
              "    <tr>\n",
              "      <th>0</th>\n",
              "      <td>Amiodarone</td>\n",
              "    </tr>\n",
              "  </tbody>\n",
              "</table>\n",
              "</div>\n",
              "      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-f709f973-a999-4fc8-8ad9-19d73e667a3d')\"\n",
              "              title=\"Convert this dataframe to an interactive table.\"\n",
              "              style=\"display:none;\">\n",
              "        \n",
              "  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n",
              "       width=\"24px\">\n",
              "    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n",
              "    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n",
              "  </svg>\n",
              "      </button>\n",
              "      \n",
              "  <style>\n",
              "    .colab-df-container {\n",
              "      display:flex;\n",
              "      flex-wrap:wrap;\n",
              "      gap: 12px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert {\n",
              "      background-color: #E8F0FE;\n",
              "      border: none;\n",
              "      border-radius: 50%;\n",
              "      cursor: pointer;\n",
              "      display: none;\n",
              "      fill: #1967D2;\n",
              "      height: 32px;\n",
              "      padding: 0 0 0 0;\n",
              "      width: 32px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert:hover {\n",
              "      background-color: #E2EBFA;\n",
              "      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n",
              "      fill: #174EA6;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert {\n",
              "      background-color: #3B4455;\n",
              "      fill: #D2E3FC;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert:hover {\n",
              "      background-color: #434B5C;\n",
              "      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n",
              "      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n",
              "      fill: #FFFFFF;\n",
              "    }\n",
              "  </style>\n",
              "\n",
              "      <script>\n",
              "        const buttonEl =\n",
              "          document.querySelector('#df-f709f973-a999-4fc8-8ad9-19d73e667a3d button.colab-df-convert');\n",
              "        buttonEl.style.display =\n",
              "          google.colab.kernel.accessAllowed ? 'block' : 'none';\n",
              "\n",
              "        async function convertToInteractive(key) {\n",
              "          const element = document.querySelector('#df-f709f973-a999-4fc8-8ad9-19d73e667a3d');\n",
              "          const dataTable =\n",
              "            await google.colab.kernel.invokeFunction('convertToInteractive',\n",
              "                                                     [key], {});\n",
              "          if (!dataTable) return;\n",
              "\n",
              "          const docLinkHtml = 'Like what you see? Visit the ' +\n",
              "            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n",
              "            + ' to learn more about interactive tables.';\n",
              "          element.innerHTML = '';\n",
              "          dataTable['output_type'] = 'display_data';\n",
              "          await google.colab.output.renderOutput(dataTable, element);\n",
              "          const docLink = document.createElement('div');\n",
              "          docLink.innerHTML = docLinkHtml;\n",
              "          element.appendChild(docLink);\n",
              "        }\n",
              "      </script>\n",
              "    </div>\n",
              "  </div>\n",
              "  "
            ]
          },
          "metadata": {}
        }
      ]
    },
    {
      "cell_type": "code",
      "source": [
        "df_emar = run_query(f'''\n",
        "SELECT subject_id, hadm_id, medication, charttime, event_txt\n",
        "FROM `physionet-data.mimic_hosp.emar` \n",
        "WHERE medication IN (\"Amiodarone\", \"Diltiazem\", \"Diltiazem Extended-Release\", \n",
        "                     \"Metoprolol Tartrate\", \"Metoprolol Succinate XL\") AND subject_id IN ({id_str})\n",
        "''')\n",
        "df_emar = df_emar.sort_values(['subject_id', 'charttime'])\n",
        "display(df_emar)"
      ],
      "metadata": {
        "id": "ebWqek6xYGqK",
        "colab": {
          "base_uri": "https://localhost:8080/",
          "height": 424
        },
        "outputId": "b832f408-93d4-4d4f-81ac-29f70899730c"
      },
      "execution_count": null,
      "outputs": [
        {
          "output_type": "display_data",
          "data": {
            "text/plain": [
              "     subject_id     hadm_id                  medication           charttime  \\\n",
              "146    10001884  29675586.0  Diltiazem Extended-Release 2130-04-09 09:16:00   \n",
              "93     10001884  26170293.0  Diltiazem Extended-Release 2130-04-16 00:45:00   \n",
              "85     10001884  26170293.0  Diltiazem Extended-Release 2130-04-16 14:16:00   \n",
              "13     10001884  26170293.0  Diltiazem Extended-Release 2130-04-17 07:56:00   \n",
              "379    10001884  26170293.0                   Diltiazem 2130-04-17 10:30:00   \n",
              "..          ...         ...                         ...                 ...   \n",
              "419    10005866  20364112.0         Metoprolol Tartrate 2149-10-23 08:29:00   \n",
              "312    10005866  20364112.0         Metoprolol Tartrate 2149-10-23 21:15:00   \n",
              "367    10005866  20364112.0         Metoprolol Tartrate 2149-10-24 08:13:00   \n",
              "38     10005866  20364112.0         Metoprolol Tartrate 2149-10-24 20:00:00   \n",
              "34     10005866  20364112.0         Metoprolol Tartrate 2149-10-25 08:00:00   \n",
              "\n",
              "        event_txt  \n",
              "146  Administered  \n",
              "93   Administered  \n",
              "85   Administered  \n",
              "13   Administered  \n",
              "379  Administered  \n",
              "..            ...  \n",
              "419  Administered  \n",
              "312  Administered  \n",
              "367  Administered  \n",
              "38      Not Given  \n",
              "34      Not Given  \n",
              "\n",
              "[435 rows x 5 columns]"
            ],
            "text/html": [
              "\n",
              "  <div id=\"df-c61ea3be-473d-4f2e-b165-91d6addf9372\">\n",
              "    <div class=\"colab-df-container\">\n",
              "      <div>\n",
              "<style scoped>\n",
              "    .dataframe tbody tr th:only-of-type {\n",
              "        vertical-align: middle;\n",
              "    }\n",
              "\n",
              "    .dataframe tbody tr th {\n",
              "        vertical-align: top;\n",
              "    }\n",
              "\n",
              "    .dataframe thead th {\n",
              "        text-align: right;\n",
              "    }\n",
              "</style>\n",
              "<table border=\"1\" class=\"dataframe\">\n",
              "  <thead>\n",
              "    <tr style=\"text-align: right;\">\n",
              "      <th></th>\n",
              "      <th>subject_id</th>\n",
              "      <th>hadm_id</th>\n",
              "      <th>medication</th>\n",
              "      <th>charttime</th>\n",
              "      <th>event_txt</th>\n",
              "    </tr>\n",
              "  </thead>\n",
              "  <tbody>\n",
              "    <tr>\n",
              "      <th>146</th>\n",
              "      <td>10001884</td>\n",
              "      <td>29675586.0</td>\n",
              "      <td>Diltiazem Extended-Release</td>\n",
              "      <td>2130-04-09 09:16:00</td>\n",
              "      <td>Administered</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>93</th>\n",
              "      <td>10001884</td>\n",
              "      <td>26170293.0</td>\n",
              "      <td>Diltiazem Extended-Release</td>\n",
              "      <td>2130-04-16 00:45:00</td>\n",
              "      <td>Administered</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>85</th>\n",
              "      <td>10001884</td>\n",
              "      <td>26170293.0</td>\n",
              "      <td>Diltiazem Extended-Release</td>\n",
              "      <td>2130-04-16 14:16:00</td>\n",
              "      <td>Administered</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>13</th>\n",
              "      <td>10001884</td>\n",
              "      <td>26170293.0</td>\n",
              "      <td>Diltiazem Extended-Release</td>\n",
              "      <td>2130-04-17 07:56:00</td>\n",
              "      <td>Administered</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>379</th>\n",
              "      <td>10001884</td>\n",
              "      <td>26170293.0</td>\n",
              "      <td>Diltiazem</td>\n",
              "      <td>2130-04-17 10:30:00</td>\n",
              "      <td>Administered</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>...</th>\n",
              "      <td>...</td>\n",
              "      <td>...</td>\n",
              "      <td>...</td>\n",
              "      <td>...</td>\n",
              "      <td>...</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>419</th>\n",
              "      <td>10005866</td>\n",
              "      <td>20364112.0</td>\n",
              "      <td>Metoprolol Tartrate</td>\n",
              "      <td>2149-10-23 08:29:00</td>\n",
              "      <td>Administered</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>312</th>\n",
              "      <td>10005866</td>\n",
              "      <td>20364112.0</td>\n",
              "      <td>Metoprolol Tartrate</td>\n",
              "      <td>2149-10-23 21:15:00</td>\n",
              "      <td>Administered</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>367</th>\n",
              "      <td>10005866</td>\n",
              "      <td>20364112.0</td>\n",
              "      <td>Metoprolol Tartrate</td>\n",
              "      <td>2149-10-24 08:13:00</td>\n",
              "      <td>Administered</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>38</th>\n",
              "      <td>10005866</td>\n",
              "      <td>20364112.0</td>\n",
              "      <td>Metoprolol Tartrate</td>\n",
              "      <td>2149-10-24 20:00:00</td>\n",
              "      <td>Not Given</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>34</th>\n",
              "      <td>10005866</td>\n",
              "      <td>20364112.0</td>\n",
              "      <td>Metoprolol Tartrate</td>\n",
              "      <td>2149-10-25 08:00:00</td>\n",
              "      <td>Not Given</td>\n",
              "    </tr>\n",
              "  </tbody>\n",
              "</table>\n",
              "<p>435 rows Ã— 5 columns</p>\n",
              "</div>\n",
              "      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-c61ea3be-473d-4f2e-b165-91d6addf9372')\"\n",
              "              title=\"Convert this dataframe to an interactive table.\"\n",
              "              style=\"display:none;\">\n",
              "        \n",
              "  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n",
              "       width=\"24px\">\n",
              "    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n",
              "    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n",
              "  </svg>\n",
              "      </button>\n",
              "      \n",
              "  <style>\n",
              "    .colab-df-container {\n",
              "      display:flex;\n",
              "      flex-wrap:wrap;\n",
              "      gap: 12px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert {\n",
              "      background-color: #E8F0FE;\n",
              "      border: none;\n",
              "      border-radius: 50%;\n",
              "      cursor: pointer;\n",
              "      display: none;\n",
              "      fill: #1967D2;\n",
              "      height: 32px;\n",
              "      padding: 0 0 0 0;\n",
              "      width: 32px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert:hover {\n",
              "      background-color: #E2EBFA;\n",
              "      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n",
              "      fill: #174EA6;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert {\n",
              "      background-color: #3B4455;\n",
              "      fill: #D2E3FC;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert:hover {\n",
              "      background-color: #434B5C;\n",
              "      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n",
              "      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n",
              "      fill: #FFFFFF;\n",
              "    }\n",
              "  </style>\n",
              "\n",
              "      <script>\n",
              "        const buttonEl =\n",
              "          document.querySelector('#df-c61ea3be-473d-4f2e-b165-91d6addf9372 button.colab-df-convert');\n",
              "        buttonEl.style.display =\n",
              "          google.colab.kernel.accessAllowed ? 'block' : 'none';\n",
              "\n",
              "        async function convertToInteractive(key) {\n",
              "          const element = document.querySelector('#df-c61ea3be-473d-4f2e-b165-91d6addf9372');\n",
              "          const dataTable =\n",
              "            await google.colab.kernel.invokeFunction('convertToInteractive',\n",
              "                                                     [key], {});\n",
              "          if (!dataTable) return;\n",
              "\n",
              "          const docLinkHtml = 'Like what you see? Visit the ' +\n",
              "            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n",
              "            + ' to learn more about interactive tables.';\n",
              "          element.innerHTML = '';\n",
              "          dataTable['output_type'] = 'display_data';\n",
              "          await google.colab.output.renderOutput(dataTable, element);\n",
              "          const docLink = document.createElement('div');\n",
              "          docLink.innerHTML = docLinkHtml;\n",
              "          element.appendChild(docLink);\n",
              "        }\n",
              "      </script>\n",
              "    </div>\n",
              "  </div>\n",
              "  "
            ]
          },
          "metadata": {}
        }
      ]
    },
    {
      "cell_type": "markdown",
      "source": [
        "Question 15: In Python, filter and display both dataframes for the below `subject_id`."
      ],
      "metadata": {
        "id": "bucugKaEHCEJ"
      }
    },
    {
      "cell_type": "code",
      "source": [
        "subject_id = 10002443\n",
        "\n",
        "df_inp[df_inp[\"subject_id\"] == subject_id]"
      ],
      "metadata": {
        "id": "ZulUEmX8HE3d",
        "colab": {
          "base_uri": "https://localhost:8080/",
          "height": 81
        },
        "outputId": "df61720e-f046-4b19-f1c0-509f4990e6d7"
      },
      "execution_count": null,
      "outputs": [
        {
          "output_type": "execute_result",
          "data": {
            "text/plain": [
              "   subject_id   stay_id       label           starttime             endtime  \\\n",
              "7    10002443  35044219  Metoprolol 2183-10-18 21:10:00 2183-10-18 21:11:00   \n",
              "\n",
              "   rate  \n",
              "7   NaN  "
            ],
            "text/html": [
              "\n",
              "  <div id=\"df-9bf21a52-a2da-4571-b773-9088a965b53c\">\n",
              "    <div class=\"colab-df-container\">\n",
              "      <div>\n",
              "<style scoped>\n",
              "    .dataframe tbody tr th:only-of-type {\n",
              "        vertical-align: middle;\n",
              "    }\n",
              "\n",
              "    .dataframe tbody tr th {\n",
              "        vertical-align: top;\n",
              "    }\n",
              "\n",
              "    .dataframe thead th {\n",
              "        text-align: right;\n",
              "    }\n",
              "</style>\n",
              "<table border=\"1\" class=\"dataframe\">\n",
              "  <thead>\n",
              "    <tr style=\"text-align: right;\">\n",
              "      <th></th>\n",
              "      <th>subject_id</th>\n",
              "      <th>stay_id</th>\n",
              "      <th>label</th>\n",
              "      <th>starttime</th>\n",
              "      <th>endtime</th>\n",
              "      <th>rate</th>\n",
              "    </tr>\n",
              "  </thead>\n",
              "  <tbody>\n",
              "    <tr>\n",
              "      <th>7</th>\n",
              "      <td>10002443</td>\n",
              "      <td>35044219</td>\n",
              "      <td>Metoprolol</td>\n",
              "      <td>2183-10-18 21:10:00</td>\n",
              "      <td>2183-10-18 21:11:00</td>\n",
              "      <td>NaN</td>\n",
              "    </tr>\n",
              "  </tbody>\n",
              "</table>\n",
              "</div>\n",
              "      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-9bf21a52-a2da-4571-b773-9088a965b53c')\"\n",
              "              title=\"Convert this dataframe to an interactive table.\"\n",
              "              style=\"display:none;\">\n",
              "        \n",
              "  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n",
              "       width=\"24px\">\n",
              "    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n",
              "    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n",
              "  </svg>\n",
              "      </button>\n",
              "      \n",
              "  <style>\n",
              "    .colab-df-container {\n",
              "      display:flex;\n",
              "      flex-wrap:wrap;\n",
              "      gap: 12px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert {\n",
              "      background-color: #E8F0FE;\n",
              "      border: none;\n",
              "      border-radius: 50%;\n",
              "      cursor: pointer;\n",
              "      display: none;\n",
              "      fill: #1967D2;\n",
              "      height: 32px;\n",
              "      padding: 0 0 0 0;\n",
              "      width: 32px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert:hover {\n",
              "      background-color: #E2EBFA;\n",
              "      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n",
              "      fill: #174EA6;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert {\n",
              "      background-color: #3B4455;\n",
              "      fill: #D2E3FC;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert:hover {\n",
              "      background-color: #434B5C;\n",
              "      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n",
              "      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n",
              "      fill: #FFFFFF;\n",
              "    }\n",
              "  </style>\n",
              "\n",
              "      <script>\n",
              "        const buttonEl =\n",
              "          document.querySelector('#df-9bf21a52-a2da-4571-b773-9088a965b53c button.colab-df-convert');\n",
              "        buttonEl.style.display =\n",
              "          google.colab.kernel.accessAllowed ? 'block' : 'none';\n",
              "\n",
              "        async function convertToInteractive(key) {\n",
              "          const element = document.querySelector('#df-9bf21a52-a2da-4571-b773-9088a965b53c');\n",
              "          const dataTable =\n",
              "            await google.colab.kernel.invokeFunction('convertToInteractive',\n",
              "                                                     [key], {});\n",
              "          if (!dataTable) return;\n",
              "\n",
              "          const docLinkHtml = 'Like what you see? Visit the ' +\n",
              "            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n",
              "            + ' to learn more about interactive tables.';\n",
              "          element.innerHTML = '';\n",
              "          dataTable['output_type'] = 'display_data';\n",
              "          await google.colab.output.renderOutput(dataTable, element);\n",
              "          const docLink = document.createElement('div');\n",
              "          docLink.innerHTML = docLinkHtml;\n",
              "          element.appendChild(docLink);\n",
              "        }\n",
              "      </script>\n",
              "    </div>\n",
              "  </div>\n",
              "  "
            ]
          },
          "metadata": {},
          "execution_count": 353
        }
      ]
    },
    {
      "cell_type": "code",
      "source": [
        "df_emar[df_emar[\"subject_id\"] == subject_id]"
      ],
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/",
          "height": 300
        },
        "id": "aZ3WXQbpA8rD",
        "outputId": "b61485d2-99ad-468a-d664-0f29c1abe28b"
      },
      "execution_count": null,
      "outputs": [
        {
          "output_type": "execute_result",
          "data": {
            "text/plain": [
              "     subject_id     hadm_id               medication           charttime  \\\n",
              "411    10002443  21329021.0      Metoprolol Tartrate 2183-10-18 21:05:00   \n",
              "371    10002443  21329021.0      Metoprolol Tartrate 2183-10-18 21:10:00   \n",
              "130    10002443  21329021.0      Metoprolol Tartrate 2183-10-18 22:12:00   \n",
              "102    10002443  21329021.0      Metoprolol Tartrate 2183-10-19 05:15:00   \n",
              "365    10002443  21329021.0      Metoprolol Tartrate 2183-10-19 12:38:00   \n",
              "320    10002443  21329021.0      Metoprolol Tartrate 2183-10-19 18:14:00   \n",
              "179    10002443  21329021.0      Metoprolol Tartrate 2183-10-19 22:27:00   \n",
              "225    10002443  21329021.0  Metoprolol Succinate XL 2183-10-20 08:27:00   \n",
              "\n",
              "        event_txt  \n",
              "411  Administered  \n",
              "371  Administered  \n",
              "130  Administered  \n",
              "102  Administered  \n",
              "365  Administered  \n",
              "320  Administered  \n",
              "179  Administered  \n",
              "225  Administered  "
            ],
            "text/html": [
              "\n",
              "  <div id=\"df-54765c24-cc9d-46db-9ef3-adba1971533a\">\n",
              "    <div class=\"colab-df-container\">\n",
              "      <div>\n",
              "<style scoped>\n",
              "    .dataframe tbody tr th:only-of-type {\n",
              "        vertical-align: middle;\n",
              "    }\n",
              "\n",
              "    .dataframe tbody tr th {\n",
              "        vertical-align: top;\n",
              "    }\n",
              "\n",
              "    .dataframe thead th {\n",
              "        text-align: right;\n",
              "    }\n",
              "</style>\n",
              "<table border=\"1\" class=\"dataframe\">\n",
              "  <thead>\n",
              "    <tr style=\"text-align: right;\">\n",
              "      <th></th>\n",
              "      <th>subject_id</th>\n",
              "      <th>hadm_id</th>\n",
              "      <th>medication</th>\n",
              "      <th>charttime</th>\n",
              "      <th>event_txt</th>\n",
              "    </tr>\n",
              "  </thead>\n",
              "  <tbody>\n",
              "    <tr>\n",
              "      <th>411</th>\n",
              "      <td>10002443</td>\n",
              "      <td>21329021.0</td>\n",
              "      <td>Metoprolol Tartrate</td>\n",
              "      <td>2183-10-18 21:05:00</td>\n",
              "      <td>Administered</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>371</th>\n",
              "      <td>10002443</td>\n",
              "      <td>21329021.0</td>\n",
              "      <td>Metoprolol Tartrate</td>\n",
              "      <td>2183-10-18 21:10:00</td>\n",
              "      <td>Administered</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>130</th>\n",
              "      <td>10002443</td>\n",
              "      <td>21329021.0</td>\n",
              "      <td>Metoprolol Tartrate</td>\n",
              "      <td>2183-10-18 22:12:00</td>\n",
              "      <td>Administered</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>102</th>\n",
              "      <td>10002443</td>\n",
              "      <td>21329021.0</td>\n",
              "      <td>Metoprolol Tartrate</td>\n",
              "      <td>2183-10-19 05:15:00</td>\n",
              "      <td>Administered</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>365</th>\n",
              "      <td>10002443</td>\n",
              "      <td>21329021.0</td>\n",
              "      <td>Metoprolol Tartrate</td>\n",
              "      <td>2183-10-19 12:38:00</td>\n",
              "      <td>Administered</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>320</th>\n",
              "      <td>10002443</td>\n",
              "      <td>21329021.0</td>\n",
              "      <td>Metoprolol Tartrate</td>\n",
              "      <td>2183-10-19 18:14:00</td>\n",
              "      <td>Administered</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>179</th>\n",
              "      <td>10002443</td>\n",
              "      <td>21329021.0</td>\n",
              "      <td>Metoprolol Tartrate</td>\n",
              "      <td>2183-10-19 22:27:00</td>\n",
              "      <td>Administered</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>225</th>\n",
              "      <td>10002443</td>\n",
              "      <td>21329021.0</td>\n",
              "      <td>Metoprolol Succinate XL</td>\n",
              "      <td>2183-10-20 08:27:00</td>\n",
              "      <td>Administered</td>\n",
              "    </tr>\n",
              "  </tbody>\n",
              "</table>\n",
              "</div>\n",
              "      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-54765c24-cc9d-46db-9ef3-adba1971533a')\"\n",
              "              title=\"Convert this dataframe to an interactive table.\"\n",
              "              style=\"display:none;\">\n",
              "        \n",
              "  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n",
              "       width=\"24px\">\n",
              "    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n",
              "    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n",
              "  </svg>\n",
              "      </button>\n",
              "      \n",
              "  <style>\n",
              "    .colab-df-container {\n",
              "      display:flex;\n",
              "      flex-wrap:wrap;\n",
              "      gap: 12px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert {\n",
              "      background-color: #E8F0FE;\n",
              "      border: none;\n",
              "      border-radius: 50%;\n",
              "      cursor: pointer;\n",
              "      display: none;\n",
              "      fill: #1967D2;\n",
              "      height: 32px;\n",
              "      padding: 0 0 0 0;\n",
              "      width: 32px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert:hover {\n",
              "      background-color: #E2EBFA;\n",
              "      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n",
              "      fill: #174EA6;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert {\n",
              "      background-color: #3B4455;\n",
              "      fill: #D2E3FC;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert:hover {\n",
              "      background-color: #434B5C;\n",
              "      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n",
              "      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n",
              "      fill: #FFFFFF;\n",
              "    }\n",
              "  </style>\n",
              "\n",
              "      <script>\n",
              "        const buttonEl =\n",
              "          document.querySelector('#df-54765c24-cc9d-46db-9ef3-adba1971533a button.colab-df-convert');\n",
              "        buttonEl.style.display =\n",
              "          google.colab.kernel.accessAllowed ? 'block' : 'none';\n",
              "\n",
              "        async function convertToInteractive(key) {\n",
              "          const element = document.querySelector('#df-54765c24-cc9d-46db-9ef3-adba1971533a');\n",
              "          const dataTable =\n",
              "            await google.colab.kernel.invokeFunction('convertToInteractive',\n",
              "                                                     [key], {});\n",
              "          if (!dataTable) return;\n",
              "\n",
              "          const docLinkHtml = 'Like what you see? Visit the ' +\n",
              "            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n",
              "            + ' to learn more about interactive tables.';\n",
              "          element.innerHTML = '';\n",
              "          dataTable['output_type'] = 'display_data';\n",
              "          await google.colab.output.renderOutput(dataTable, element);\n",
              "          const docLink = document.createElement('div');\n",
              "          docLink.innerHTML = docLinkHtml;\n",
              "          element.appendChild(docLink);\n",
              "        }\n",
              "      </script>\n",
              "    </div>\n",
              "  </div>\n",
              "  "
            ]
          },
          "metadata": {},
          "execution_count": 354
        }
      ]
    },
    {
      "cell_type": "markdown",
      "source": [
        "Question 16: Which do you think is the \"correct\" source of information? Justify your response."
      ],
      "metadata": {
        "id": "g03X4YkYYIFh"
      }
    },
    {
      "cell_type": "markdown",
      "source": [
        "Answer: it depends on what we want but the information we can find in emar is a more detailed look into the medications administered to the patient every time they take a dosis is registered, unlike in inputevents which contains information on continuous treatments. "
      ],
      "metadata": {
        "id": "15z-VX47HcH0"
      }
    },
    {
      "cell_type": "markdown",
      "source": [
        "Repeat the above for another `subject_id`."
      ],
      "metadata": {
        "id": "05I6WBU0HdVs"
      }
    },
    {
      "cell_type": "code",
      "source": [
        "subject_id = 10001884\n",
        "df_inp[df_inp[\"subject_id\"] == subject_id]"
      ],
      "metadata": {
        "id": "uD7_S2UEHcVg",
        "colab": {
          "base_uri": "https://localhost:8080/",
          "height": 49
        },
        "outputId": "4c849373-738e-4f31-d0ff-074a30450117"
      },
      "execution_count": null,
      "outputs": [
        {
          "output_type": "execute_result",
          "data": {
            "text/plain": [
              "Empty DataFrame\n",
              "Columns: [subject_id, stay_id, label, starttime, endtime, rate]\n",
              "Index: []"
            ],
            "text/html": [
              "\n",
              "  <div id=\"df-7f537368-a71f-4c68-a3b1-05349fb921b8\">\n",
              "    <div class=\"colab-df-container\">\n",
              "      <div>\n",
              "<style scoped>\n",
              "    .dataframe tbody tr th:only-of-type {\n",
              "        vertical-align: middle;\n",
              "    }\n",
              "\n",
              "    .dataframe tbody tr th {\n",
              "        vertical-align: top;\n",
              "    }\n",
              "\n",
              "    .dataframe thead th {\n",
              "        text-align: right;\n",
              "    }\n",
              "</style>\n",
              "<table border=\"1\" class=\"dataframe\">\n",
              "  <thead>\n",
              "    <tr style=\"text-align: right;\">\n",
              "      <th></th>\n",
              "      <th>subject_id</th>\n",
              "      <th>stay_id</th>\n",
              "      <th>label</th>\n",
              "      <th>starttime</th>\n",
              "      <th>endtime</th>\n",
              "      <th>rate</th>\n",
              "    </tr>\n",
              "  </thead>\n",
              "  <tbody>\n",
              "  </tbody>\n",
              "</table>\n",
              "</div>\n",
              "      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-7f537368-a71f-4c68-a3b1-05349fb921b8')\"\n",
              "              title=\"Convert this dataframe to an interactive table.\"\n",
              "              style=\"display:none;\">\n",
              "        \n",
              "  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n",
              "       width=\"24px\">\n",
              "    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n",
              "    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n",
              "  </svg>\n",
              "      </button>\n",
              "      \n",
              "  <style>\n",
              "    .colab-df-container {\n",
              "      display:flex;\n",
              "      flex-wrap:wrap;\n",
              "      gap: 12px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert {\n",
              "      background-color: #E8F0FE;\n",
              "      border: none;\n",
              "      border-radius: 50%;\n",
              "      cursor: pointer;\n",
              "      display: none;\n",
              "      fill: #1967D2;\n",
              "      height: 32px;\n",
              "      padding: 0 0 0 0;\n",
              "      width: 32px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert:hover {\n",
              "      background-color: #E2EBFA;\n",
              "      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n",
              "      fill: #174EA6;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert {\n",
              "      background-color: #3B4455;\n",
              "      fill: #D2E3FC;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert:hover {\n",
              "      background-color: #434B5C;\n",
              "      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n",
              "      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n",
              "      fill: #FFFFFF;\n",
              "    }\n",
              "  </style>\n",
              "\n",
              "      <script>\n",
              "        const buttonEl =\n",
              "          document.querySelector('#df-7f537368-a71f-4c68-a3b1-05349fb921b8 button.colab-df-convert');\n",
              "        buttonEl.style.display =\n",
              "          google.colab.kernel.accessAllowed ? 'block' : 'none';\n",
              "\n",
              "        async function convertToInteractive(key) {\n",
              "          const element = document.querySelector('#df-7f537368-a71f-4c68-a3b1-05349fb921b8');\n",
              "          const dataTable =\n",
              "            await google.colab.kernel.invokeFunction('convertToInteractive',\n",
              "                                                     [key], {});\n",
              "          if (!dataTable) return;\n",
              "\n",
              "          const docLinkHtml = 'Like what you see? Visit the ' +\n",
              "            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n",
              "            + ' to learn more about interactive tables.';\n",
              "          element.innerHTML = '';\n",
              "          dataTable['output_type'] = 'display_data';\n",
              "          await google.colab.output.renderOutput(dataTable, element);\n",
              "          const docLink = document.createElement('div');\n",
              "          docLink.innerHTML = docLinkHtml;\n",
              "          element.appendChild(docLink);\n",
              "        }\n",
              "      </script>\n",
              "    </div>\n",
              "  </div>\n",
              "  "
            ]
          },
          "metadata": {},
          "execution_count": 355
        }
      ]
    },
    {
      "cell_type": "code",
      "source": [
        "df_emar[df_emar[\"subject_id\"] == subject_id]"
      ],
      "metadata": {
        "id": "u2i98FjDCK-D",
        "outputId": "4d05d0e3-6989-49a3-b7d0-321f537180db",
        "colab": {
          "base_uri": "https://localhost:8080/",
          "height": 424
        }
      },
      "execution_count": null,
      "outputs": [
        {
          "output_type": "execute_result",
          "data": {
            "text/plain": [
              "     subject_id     hadm_id                  medication           charttime  \\\n",
              "146    10001884  29675586.0  Diltiazem Extended-Release 2130-04-09 09:16:00   \n",
              "93     10001884  26170293.0  Diltiazem Extended-Release 2130-04-16 00:45:00   \n",
              "85     10001884  26170293.0  Diltiazem Extended-Release 2130-04-16 14:16:00   \n",
              "13     10001884  26170293.0  Diltiazem Extended-Release 2130-04-17 07:56:00   \n",
              "379    10001884  26170293.0                   Diltiazem 2130-04-17 10:30:00   \n",
              "..          ...         ...                         ...                 ...   \n",
              "395    10001884  26184834.0  Diltiazem Extended-Release 2131-01-08 20:19:00   \n",
              "204    10001884  26184834.0  Diltiazem Extended-Release 2131-01-09 08:04:00   \n",
              "281    10001884  26184834.0  Diltiazem Extended-Release 2131-01-09 20:02:00   \n",
              "75     10001884  26184834.0  Diltiazem Extended-Release 2131-01-10 08:48:00   \n",
              "7      10001884  26184834.0  Diltiazem Extended-Release 2131-01-10 19:45:00   \n",
              "\n",
              "        event_txt  \n",
              "146  Administered  \n",
              "93   Administered  \n",
              "85   Administered  \n",
              "13   Administered  \n",
              "379  Administered  \n",
              "..            ...  \n",
              "395  Administered  \n",
              "204  Administered  \n",
              "281  Administered  \n",
              "75   Administered  \n",
              "7    Administered  \n",
              "\n",
              "[93 rows x 5 columns]"
            ],
            "text/html": [
              "\n",
              "  <div id=\"df-3866ff84-6328-4624-a848-e0d12e722389\">\n",
              "    <div class=\"colab-df-container\">\n",
              "      <div>\n",
              "<style scoped>\n",
              "    .dataframe tbody tr th:only-of-type {\n",
              "        vertical-align: middle;\n",
              "    }\n",
              "\n",
              "    .dataframe tbody tr th {\n",
              "        vertical-align: top;\n",
              "    }\n",
              "\n",
              "    .dataframe thead th {\n",
              "        text-align: right;\n",
              "    }\n",
              "</style>\n",
              "<table border=\"1\" class=\"dataframe\">\n",
              "  <thead>\n",
              "    <tr style=\"text-align: right;\">\n",
              "      <th></th>\n",
              "      <th>subject_id</th>\n",
              "      <th>hadm_id</th>\n",
              "      <th>medication</th>\n",
              "      <th>charttime</th>\n",
              "      <th>event_txt</th>\n",
              "    </tr>\n",
              "  </thead>\n",
              "  <tbody>\n",
              "    <tr>\n",
              "      <th>146</th>\n",
              "      <td>10001884</td>\n",
              "      <td>29675586.0</td>\n",
              "      <td>Diltiazem Extended-Release</td>\n",
              "      <td>2130-04-09 09:16:00</td>\n",
              "      <td>Administered</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>93</th>\n",
              "      <td>10001884</td>\n",
              "      <td>26170293.0</td>\n",
              "      <td>Diltiazem Extended-Release</td>\n",
              "      <td>2130-04-16 00:45:00</td>\n",
              "      <td>Administered</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>85</th>\n",
              "      <td>10001884</td>\n",
              "      <td>26170293.0</td>\n",
              "      <td>Diltiazem Extended-Release</td>\n",
              "      <td>2130-04-16 14:16:00</td>\n",
              "      <td>Administered</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>13</th>\n",
              "      <td>10001884</td>\n",
              "      <td>26170293.0</td>\n",
              "      <td>Diltiazem Extended-Release</td>\n",
              "      <td>2130-04-17 07:56:00</td>\n",
              "      <td>Administered</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>379</th>\n",
              "      <td>10001884</td>\n",
              "      <td>26170293.0</td>\n",
              "      <td>Diltiazem</td>\n",
              "      <td>2130-04-17 10:30:00</td>\n",
              "      <td>Administered</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>...</th>\n",
              "      <td>...</td>\n",
              "      <td>...</td>\n",
              "      <td>...</td>\n",
              "      <td>...</td>\n",
              "      <td>...</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>395</th>\n",
              "      <td>10001884</td>\n",
              "      <td>26184834.0</td>\n",
              "      <td>Diltiazem Extended-Release</td>\n",
              "      <td>2131-01-08 20:19:00</td>\n",
              "      <td>Administered</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>204</th>\n",
              "      <td>10001884</td>\n",
              "      <td>26184834.0</td>\n",
              "      <td>Diltiazem Extended-Release</td>\n",
              "      <td>2131-01-09 08:04:00</td>\n",
              "      <td>Administered</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>281</th>\n",
              "      <td>10001884</td>\n",
              "      <td>26184834.0</td>\n",
              "      <td>Diltiazem Extended-Release</td>\n",
              "      <td>2131-01-09 20:02:00</td>\n",
              "      <td>Administered</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>75</th>\n",
              "      <td>10001884</td>\n",
              "      <td>26184834.0</td>\n",
              "      <td>Diltiazem Extended-Release</td>\n",
              "      <td>2131-01-10 08:48:00</td>\n",
              "      <td>Administered</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>7</th>\n",
              "      <td>10001884</td>\n",
              "      <td>26184834.0</td>\n",
              "      <td>Diltiazem Extended-Release</td>\n",
              "      <td>2131-01-10 19:45:00</td>\n",
              "      <td>Administered</td>\n",
              "    </tr>\n",
              "  </tbody>\n",
              "</table>\n",
              "<p>93 rows Ã— 5 columns</p>\n",
              "</div>\n",
              "      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-3866ff84-6328-4624-a848-e0d12e722389')\"\n",
              "              title=\"Convert this dataframe to an interactive table.\"\n",
              "              style=\"display:none;\">\n",
              "        \n",
              "  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n",
              "       width=\"24px\">\n",
              "    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n",
              "    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n",
              "  </svg>\n",
              "      </button>\n",
              "      \n",
              "  <style>\n",
              "    .colab-df-container {\n",
              "      display:flex;\n",
              "      flex-wrap:wrap;\n",
              "      gap: 12px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert {\n",
              "      background-color: #E8F0FE;\n",
              "      border: none;\n",
              "      border-radius: 50%;\n",
              "      cursor: pointer;\n",
              "      display: none;\n",
              "      fill: #1967D2;\n",
              "      height: 32px;\n",
              "      padding: 0 0 0 0;\n",
              "      width: 32px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert:hover {\n",
              "      background-color: #E2EBFA;\n",
              "      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n",
              "      fill: #174EA6;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert {\n",
              "      background-color: #3B4455;\n",
              "      fill: #D2E3FC;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert:hover {\n",
              "      background-color: #434B5C;\n",
              "      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n",
              "      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n",
              "      fill: #FFFFFF;\n",
              "    }\n",
              "  </style>\n",
              "\n",
              "      <script>\n",
              "        const buttonEl =\n",
              "          document.querySelector('#df-3866ff84-6328-4624-a848-e0d12e722389 button.colab-df-convert');\n",
              "        buttonEl.style.display =\n",
              "          google.colab.kernel.accessAllowed ? 'block' : 'none';\n",
              "\n",
              "        async function convertToInteractive(key) {\n",
              "          const element = document.querySelector('#df-3866ff84-6328-4624-a848-e0d12e722389');\n",
              "          const dataTable =\n",
              "            await google.colab.kernel.invokeFunction('convertToInteractive',\n",
              "                                                     [key], {});\n",
              "          if (!dataTable) return;\n",
              "\n",
              "          const docLinkHtml = 'Like what you see? Visit the ' +\n",
              "            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n",
              "            + ' to learn more about interactive tables.';\n",
              "          element.innerHTML = '';\n",
              "          dataTable['output_type'] = 'display_data';\n",
              "          await google.colab.output.renderOutput(dataTable, element);\n",
              "          const docLink = document.createElement('div');\n",
              "          docLink.innerHTML = docLinkHtml;\n",
              "          element.appendChild(docLink);\n",
              "        }\n",
              "      </script>\n",
              "    </div>\n",
              "  </div>\n",
              "  "
            ]
          },
          "metadata": {},
          "execution_count": 356
        }
      ]
    },
    {
      "cell_type": "markdown",
      "source": [
        "Question 17 (bonus): You should find that there are no rows in the first dataframe for this subject (i.e. no rows in *inputevents*), but there are rows in *emar*. Can you explain why?"
      ],
      "metadata": {
        "id": "ZslxxfbUHnYL"
      }
    },
    {
      "cell_type": "markdown",
      "source": [
        "Answer: There was no end time?"
      ],
      "metadata": {
        "id": "mXfYsiBsLlYH"
      }
    },
    {
      "cell_type": "markdown",
      "source": [
        "## Putting it all together\n",
        "\n",
        "Question 18: Copy your current cohort query from Question 12 above.\n",
        "Add a final exclusion which removes patients who have had any administration of metoprolol, diltiazem, or amiodarone between 12 hours before and 4 hours after ICU admission."
      ],
      "metadata": {
        "id": "O2mbvf-YGKB4"
      }
    },
    {
      "cell_type": "code",
      "source": [
        "# answer\n",
        "df = run_query(f'''\n",
        "SELECT he.subject_id, ic.hadm_id, ic.stay_id, he.charttime, he.medication, ic.intime\n",
        ", CASE WHEN he.charttime > date_add(ic.intime, INTERVAL -12 HOUR) AND he.charttime < date_add(ic.intime, INTERVAL 4 HOUR) THEN 1 ELSE 0 END as exclude_medications\n",
        "FROM `physionet-data.mimic_hosp.emar` he\n",
        "INNER JOIN `physionet-data.mimic_icu.icustays` ic\n",
        "    ON he.subject_id = ic.subject_id\n",
        "WHERE he.subject_id IN ({id_str}) AND medication IN (\"Amiodarone\", \"Diltiazem\", \"Diltiazem Extended-Release\", \n",
        "                                                     \"Metoprolol Tartrate\", \"Metoprolol Succinate XL\")\n",
        "''')\n",
        "df.sort_values('subject_id', inplace=True)\n",
        "display(df)"
      ],
      "metadata": {
        "id": "EMiwaX3yQceY",
        "colab": {
          "base_uri": "https://localhost:8080/",
          "height": 424
        },
        "outputId": "0b1ff296-95c2-4e10-a73f-534cdf0ce78f"
      },
      "execution_count": null,
      "outputs": [
        {
          "output_type": "display_data",
          "data": {
            "text/plain": [
              "     subject_id   hadm_id   stay_id           charttime  \\\n",
              "789    10001884  26184834  37510196 2130-06-24 09:41:00   \n",
              "722    10001884  26184834  37510196 2130-11-29 08:28:00   \n",
              "203    10001884  26184834  37510196 2130-08-22 20:20:00   \n",
              "818    10001884  26184834  37510196 2130-11-30 08:10:00   \n",
              "819    10001884  26184834  37510196 2130-10-10 12:45:00   \n",
              "..          ...       ...       ...                 ...   \n",
              "379    10005866  20364112  34170353 2149-10-09 13:29:00   \n",
              "319    10005866  20364112  34170353 2149-10-03 17:26:00   \n",
              "320    10005866  20364112  34170353 2149-10-23 00:20:00   \n",
              "79     10005866  20364112  34170353 2149-10-13 13:11:00   \n",
              "0      10005866  20364112  34170353 2149-10-03 14:41:00   \n",
              "\n",
              "                     medication              intime  exclude_medications  \n",
              "789  Diltiazem Extended-Release 2131-01-11 04:20:05                    0  \n",
              "722  Diltiazem Extended-Release 2131-01-11 04:20:05                    0  \n",
              "203  Diltiazem Extended-Release 2131-01-11 04:20:05                    0  \n",
              "818  Diltiazem Extended-Release 2131-01-11 04:20:05                    0  \n",
              "819                   Diltiazem 2131-01-11 04:20:05                    0  \n",
              "..                          ...                 ...                  ...  \n",
              "379         Metoprolol Tartrate 2149-10-02 12:48:08                    0  \n",
              "319         Metoprolol Tartrate 2149-10-02 12:48:08                    0  \n",
              "320         Metoprolol Tartrate 2149-10-02 12:48:08                    0  \n",
              "79          Metoprolol Tartrate 2149-10-02 12:48:08                    0  \n",
              "0                    Amiodarone 2149-10-02 12:48:08                    0  \n",
              "\n",
              "[923 rows x 7 columns]"
            ],
            "text/html": [
              "\n",
              "  <div id=\"df-f54a944c-612a-4725-8a4a-6813da1ee4fe\">\n",
              "    <div class=\"colab-df-container\">\n",
              "      <div>\n",
              "<style scoped>\n",
              "    .dataframe tbody tr th:only-of-type {\n",
              "        vertical-align: middle;\n",
              "    }\n",
              "\n",
              "    .dataframe tbody tr th {\n",
              "        vertical-align: top;\n",
              "    }\n",
              "\n",
              "    .dataframe thead th {\n",
              "        text-align: right;\n",
              "    }\n",
              "</style>\n",
              "<table border=\"1\" class=\"dataframe\">\n",
              "  <thead>\n",
              "    <tr style=\"text-align: right;\">\n",
              "      <th></th>\n",
              "      <th>subject_id</th>\n",
              "      <th>hadm_id</th>\n",
              "      <th>stay_id</th>\n",
              "      <th>charttime</th>\n",
              "      <th>medication</th>\n",
              "      <th>intime</th>\n",
              "      <th>exclude_medications</th>\n",
              "    </tr>\n",
              "  </thead>\n",
              "  <tbody>\n",
              "    <tr>\n",
              "      <th>789</th>\n",
              "      <td>10001884</td>\n",
              "      <td>26184834</td>\n",
              "      <td>37510196</td>\n",
              "      <td>2130-06-24 09:41:00</td>\n",
              "      <td>Diltiazem Extended-Release</td>\n",
              "      <td>2131-01-11 04:20:05</td>\n",
              "      <td>0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>722</th>\n",
              "      <td>10001884</td>\n",
              "      <td>26184834</td>\n",
              "      <td>37510196</td>\n",
              "      <td>2130-11-29 08:28:00</td>\n",
              "      <td>Diltiazem Extended-Release</td>\n",
              "      <td>2131-01-11 04:20:05</td>\n",
              "      <td>0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>203</th>\n",
              "      <td>10001884</td>\n",
              "      <td>26184834</td>\n",
              "      <td>37510196</td>\n",
              "      <td>2130-08-22 20:20:00</td>\n",
              "      <td>Diltiazem Extended-Release</td>\n",
              "      <td>2131-01-11 04:20:05</td>\n",
              "      <td>0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>818</th>\n",
              "      <td>10001884</td>\n",
              "      <td>26184834</td>\n",
              "      <td>37510196</td>\n",
              "      <td>2130-11-30 08:10:00</td>\n",
              "      <td>Diltiazem Extended-Release</td>\n",
              "      <td>2131-01-11 04:20:05</td>\n",
              "      <td>0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>819</th>\n",
              "      <td>10001884</td>\n",
              "      <td>26184834</td>\n",
              "      <td>37510196</td>\n",
              "      <td>2130-10-10 12:45:00</td>\n",
              "      <td>Diltiazem</td>\n",
              "      <td>2131-01-11 04:20:05</td>\n",
              "      <td>0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>...</th>\n",
              "      <td>...</td>\n",
              "      <td>...</td>\n",
              "      <td>...</td>\n",
              "      <td>...</td>\n",
              "      <td>...</td>\n",
              "      <td>...</td>\n",
              "      <td>...</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>379</th>\n",
              "      <td>10005866</td>\n",
              "      <td>20364112</td>\n",
              "      <td>34170353</td>\n",
              "      <td>2149-10-09 13:29:00</td>\n",
              "      <td>Metoprolol Tartrate</td>\n",
              "      <td>2149-10-02 12:48:08</td>\n",
              "      <td>0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>319</th>\n",
              "      <td>10005866</td>\n",
              "      <td>20364112</td>\n",
              "      <td>34170353</td>\n",
              "      <td>2149-10-03 17:26:00</td>\n",
              "      <td>Metoprolol Tartrate</td>\n",
              "      <td>2149-10-02 12:48:08</td>\n",
              "      <td>0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>320</th>\n",
              "      <td>10005866</td>\n",
              "      <td>20364112</td>\n",
              "      <td>34170353</td>\n",
              "      <td>2149-10-23 00:20:00</td>\n",
              "      <td>Metoprolol Tartrate</td>\n",
              "      <td>2149-10-02 12:48:08</td>\n",
              "      <td>0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>79</th>\n",
              "      <td>10005866</td>\n",
              "      <td>20364112</td>\n",
              "      <td>34170353</td>\n",
              "      <td>2149-10-13 13:11:00</td>\n",
              "      <td>Metoprolol Tartrate</td>\n",
              "      <td>2149-10-02 12:48:08</td>\n",
              "      <td>0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>0</th>\n",
              "      <td>10005866</td>\n",
              "      <td>20364112</td>\n",
              "      <td>34170353</td>\n",
              "      <td>2149-10-03 14:41:00</td>\n",
              "      <td>Amiodarone</td>\n",
              "      <td>2149-10-02 12:48:08</td>\n",
              "      <td>0</td>\n",
              "    </tr>\n",
              "  </tbody>\n",
              "</table>\n",
              "<p>923 rows Ã— 7 columns</p>\n",
              "</div>\n",
              "      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-f54a944c-612a-4725-8a4a-6813da1ee4fe')\"\n",
              "              title=\"Convert this dataframe to an interactive table.\"\n",
              "              style=\"display:none;\">\n",
              "        \n",
              "  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n",
              "       width=\"24px\">\n",
              "    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n",
              "    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n",
              "  </svg>\n",
              "      </button>\n",
              "      \n",
              "  <style>\n",
              "    .colab-df-container {\n",
              "      display:flex;\n",
              "      flex-wrap:wrap;\n",
              "      gap: 12px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert {\n",
              "      background-color: #E8F0FE;\n",
              "      border: none;\n",
              "      border-radius: 50%;\n",
              "      cursor: pointer;\n",
              "      display: none;\n",
              "      fill: #1967D2;\n",
              "      height: 32px;\n",
              "      padding: 0 0 0 0;\n",
              "      width: 32px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert:hover {\n",
              "      background-color: #E2EBFA;\n",
              "      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n",
              "      fill: #174EA6;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert {\n",
              "      background-color: #3B4455;\n",
              "      fill: #D2E3FC;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert:hover {\n",
              "      background-color: #434B5C;\n",
              "      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n",
              "      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n",
              "      fill: #FFFFFF;\n",
              "    }\n",
              "  </style>\n",
              "\n",
              "      <script>\n",
              "        const buttonEl =\n",
              "          document.querySelector('#df-f54a944c-612a-4725-8a4a-6813da1ee4fe button.colab-df-convert');\n",
              "        buttonEl.style.display =\n",
              "          google.colab.kernel.accessAllowed ? 'block' : 'none';\n",
              "\n",
              "        async function convertToInteractive(key) {\n",
              "          const element = document.querySelector('#df-f54a944c-612a-4725-8a4a-6813da1ee4fe');\n",
              "          const dataTable =\n",
              "            await google.colab.kernel.invokeFunction('convertToInteractive',\n",
              "                                                     [key], {});\n",
              "          if (!dataTable) return;\n",
              "\n",
              "          const docLinkHtml = 'Like what you see? Visit the ' +\n",
              "            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n",
              "            + ' to learn more about interactive tables.';\n",
              "          element.innerHTML = '';\n",
              "          dataTable['output_type'] = 'display_data';\n",
              "          await google.colab.output.renderOutput(dataTable, element);\n",
              "          const docLink = document.createElement('div');\n",
              "          docLink.innerHTML = docLinkHtml;\n",
              "          element.appendChild(docLink);\n",
              "        }\n",
              "      </script>\n",
              "    </div>\n",
              "  </div>\n",
              "  "
            ]
          },
          "metadata": {}
        }
      ]
    },
    {
      "cell_type": "code",
      "source": [
        "# answer\n",
        "df = run_query(f'''\n",
        "SELECT ic.stay_id \n",
        ", MAX(CASE WHEN he.charttime > date_add(ic.intime, INTERVAL -12 HOUR) AND he.charttime < date_add(ic.intime, INTERVAL 4 HOUR) THEN 1 ELSE 0 END) as exclude_medications\n",
        "FROM `physionet-data.mimic_hosp.emar` he\n",
        "INNER JOIN `physionet-data.mimic_icu.icustays` ic\n",
        "    ON he.subject_id = ic.subject_id\n",
        "WHERE he.subject_id IN ({id_str}) AND medication IN (\"Amiodarone\", \"Diltiazem\", \"Diltiazem Extended-Release\", \n",
        "                                                     \"Metoprolol Tartrate\", \"Metoprolol Succinate XL\")\n",
        "GROUP BY ic.stay_id\n",
        "''')\n",
        "display(df)"
      ],
      "metadata": {
        "id": "F93-2sKrFcAi",
        "outputId": "9e40594c-c4d1-4080-a6d0-28039b09fd98",
        "colab": {
          "base_uri": "https://localhost:8080/",
          "height": 269
        }
      },
      "execution_count": null,
      "outputs": [
        {
          "output_type": "display_data",
          "data": {
            "text/plain": [
              "    stay_id  exclude_medications\n",
              "0  37510196                    1\n",
              "1  38383343                    1\n",
              "2  32128372                    0\n",
              "3  34577403                    0\n",
              "4  34170353                    0\n",
              "5  35044219                    0\n",
              "6  36753294                    0"
            ],
            "text/html": [
              "\n",
              "  <div id=\"df-7d9c380d-1603-4d86-9acf-c02a9852c890\">\n",
              "    <div class=\"colab-df-container\">\n",
              "      <div>\n",
              "<style scoped>\n",
              "    .dataframe tbody tr th:only-of-type {\n",
              "        vertical-align: middle;\n",
              "    }\n",
              "\n",
              "    .dataframe tbody tr th {\n",
              "        vertical-align: top;\n",
              "    }\n",
              "\n",
              "    .dataframe thead th {\n",
              "        text-align: right;\n",
              "    }\n",
              "</style>\n",
              "<table border=\"1\" class=\"dataframe\">\n",
              "  <thead>\n",
              "    <tr style=\"text-align: right;\">\n",
              "      <th></th>\n",
              "      <th>stay_id</th>\n",
              "      <th>exclude_medications</th>\n",
              "    </tr>\n",
              "  </thead>\n",
              "  <tbody>\n",
              "    <tr>\n",
              "      <th>0</th>\n",
              "      <td>37510196</td>\n",
              "      <td>1</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>1</th>\n",
              "      <td>38383343</td>\n",
              "      <td>1</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>2</th>\n",
              "      <td>32128372</td>\n",
              "      <td>0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>3</th>\n",
              "      <td>34577403</td>\n",
              "      <td>0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>4</th>\n",
              "      <td>34170353</td>\n",
              "      <td>0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>5</th>\n",
              "      <td>35044219</td>\n",
              "      <td>0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>6</th>\n",
              "      <td>36753294</td>\n",
              "      <td>0</td>\n",
              "    </tr>\n",
              "  </tbody>\n",
              "</table>\n",
              "</div>\n",
              "      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-7d9c380d-1603-4d86-9acf-c02a9852c890')\"\n",
              "              title=\"Convert this dataframe to an interactive table.\"\n",
              "              style=\"display:none;\">\n",
              "        \n",
              "  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n",
              "       width=\"24px\">\n",
              "    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n",
              "    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n",
              "  </svg>\n",
              "      </button>\n",
              "      \n",
              "  <style>\n",
              "    .colab-df-container {\n",
              "      display:flex;\n",
              "      flex-wrap:wrap;\n",
              "      gap: 12px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert {\n",
              "      background-color: #E8F0FE;\n",
              "      border: none;\n",
              "      border-radius: 50%;\n",
              "      cursor: pointer;\n",
              "      display: none;\n",
              "      fill: #1967D2;\n",
              "      height: 32px;\n",
              "      padding: 0 0 0 0;\n",
              "      width: 32px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert:hover {\n",
              "      background-color: #E2EBFA;\n",
              "      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n",
              "      fill: #174EA6;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert {\n",
              "      background-color: #3B4455;\n",
              "      fill: #D2E3FC;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert:hover {\n",
              "      background-color: #434B5C;\n",
              "      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n",
              "      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n",
              "      fill: #FFFFFF;\n",
              "    }\n",
              "  </style>\n",
              "\n",
              "      <script>\n",
              "        const buttonEl =\n",
              "          document.querySelector('#df-7d9c380d-1603-4d86-9acf-c02a9852c890 button.colab-df-convert');\n",
              "        buttonEl.style.display =\n",
              "          google.colab.kernel.accessAllowed ? 'block' : 'none';\n",
              "\n",
              "        async function convertToInteractive(key) {\n",
              "          const element = document.querySelector('#df-7d9c380d-1603-4d86-9acf-c02a9852c890');\n",
              "          const dataTable =\n",
              "            await google.colab.kernel.invokeFunction('convertToInteractive',\n",
              "                                                     [key], {});\n",
              "          if (!dataTable) return;\n",
              "\n",
              "          const docLinkHtml = 'Like what you see? Visit the ' +\n",
              "            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n",
              "            + ' to learn more about interactive tables.';\n",
              "          element.innerHTML = '';\n",
              "          dataTable['output_type'] = 'display_data';\n",
              "          await google.colab.output.renderOutput(dataTable, element);\n",
              "          const docLink = document.createElement('div');\n",
              "          docLink.innerHTML = docLinkHtml;\n",
              "          element.appendChild(docLink);\n",
              "        }\n",
              "      </script>\n",
              "    </div>\n",
              "  </div>\n",
              "  "
            ]
          },
          "metadata": {}
        }
      ]
    },
    {
      "cell_type": "code",
      "source": [
        "df = run_query(f'''\n",
        "WITH heart AS\n",
        "(\n",
        "  WITH rates AS\n",
        "  (\n",
        "    SELECT DISTINCT a.stay_id, a.first_heart_rate\n",
        "    , CASE WHEN a.first_heart_rate > 110 THEN 1 ELSE 0 END AS exclude_first_heart_rate\n",
        "    FROM\n",
        "    (SELECT ce.subject_id, ce.stay_id, ce.charttime, ce.valuenum\n",
        "    , FIRST_VALUE(ce.valuenum) OVER (PARTITION BY ce.stay_id ORDER BY ce.charttime) AS first_heart_rate\n",
        "    FROM `physionet-data.mimic_icu.chartevents` ce\n",
        "    WHERE ce.subject_id IN ({id_str}) AND ce.itemid = 220045) a\n",
        "  )\n",
        "  SELECT rh.stay_id, rt.first_heart_rate, rt.exclude_first_heart_rate, rh.first_heart_rhythm, rh.exclude_first_heart_rhythm\n",
        "  FROM  (SELECT DISTINCT b.stay_id, b.first_heart_rhythm\n",
        "        , CASE WHEN b.first_heart_rhythm = \"AF (Atrial Fibrillation)\" THEN 1 ELSE 0 END AS exclude_first_heart_rhythm\n",
        "        FROM\n",
        "        (SELECT ce.subject_id, ce.stay_id, ce.charttime, ce.value\n",
        "        , FIRST_VALUE(ce.value) OVER (PARTITION BY ce.stay_id ORDER BY ce.charttime) AS first_heart_rhythm\n",
        "        FROM `physionet-data.mimic_icu.chartevents` ce\n",
        "        INNER JOIN `physionet-data.mimic_icu.d_items` di\n",
        "              ON ce.itemid = di.itemid\n",
        "        WHERE ce.subject_id IN ({id_str}) AND ce.itemid = 220048) b) rh\n",
        "  INNER JOIN rates rt\n",
        "      ON rt.stay_id = rh.stay_id\n",
        ")\n",
        "\n",
        "SELECT ie.subject_id, ie.hadm_id, ie.stay_id\n",
        ", CASE WHEN age.anchor_age >= 16 THEN 0 ELSE 1 END AS exclude_non_adult\n",
        ", CASE WHEN ie.LOS > 4/24 THEN 0 ELSE 1 END AS exclude_short_stays\n",
        ", CASE WHEN ROW_NUMBER() OVER (PARTITION BY ie.subject_id ORDER BY ie.intime) = 1 THEN 0 ELSE 1 END AS exclude_readmission\n",
        ", CASE WHEN cd.admission_location = \"TRANSFER FROM HOSPITAL\" THEN 1 ELSE 0 END as exclude_other_hospitals\n",
        ", ht.exclude_first_heart_rate\n",
        ", ht.exclude_first_heart_rhythm\n",
        ", ch.exclude_chronic\n",
        ", Ifnull(tp.exclude_troponin, 0) as exclude_troponin\n",
        ", Ifnull(md.exclude_medications, 0) as exclude_medications\n",
        "FROM `physionet-data.mimic_icu.icustays` ie\n",
        "INNER JOIN `physionet-data.mimic_derived.age` age\n",
        "    ON ie.hadm_id = age.hadm_id\n",
        "LEFT JOIN `physionet-data.mimic_core.admissions`  cd\n",
        "    ON ie.hadm_id = cd.hadm_id\n",
        "LEFT JOIN heart ht\n",
        "    ON ht.stay_id = ie.stay_id\n",
        "LEFT JOIN (SELECT dg.subject_id, \n",
        "          MAX(CASE WHEN icd_code IN (\"I482\", \"I4820\") THEN 1 ELSE 0 END) AS exclude_chronic\n",
        "          FROM `physionet-data.mimic_hosp.diagnoses_icd` dg\n",
        "          WHERE dg.subject_id IN ({id_str}) \n",
        "          GROUP BY subject_id) ch\n",
        "    ON ie.subject_id = ch.subject_id\n",
        "LEFT JOIN (SELECT ce.stay_id\n",
        "          , MAX(CASE WHEN ce.charttime > date_add(ic.intime, INTERVAL -72 HOUR) AND ce.charttime < date_add(ic.intime, INTERVAL 4 HOUR)\n",
        "            AND ce.valuenum > .01 THEN 1 ELSE 0 END) as exclude_troponin\n",
        "          FROM `physionet-data.mimic_icu.chartevents` ce\n",
        "          INNER JOIN `physionet-data.mimic_icu.icustays` ic\n",
        "              ON ce.stay_id = ic.stay_id\n",
        "          WHERE ce.subject_id IN ({id_str}) AND ce.itemid = 227429\n",
        "          GROUP BY ce.stay_id) tp\n",
        "    ON ie.stay_id = tp.stay_id\n",
        "LEFT JOIN (SELECT ic.stay_id \n",
        "          , MAX(CASE WHEN he.charttime > date_add(ic.intime, INTERVAL -12 HOUR) AND he.charttime < date_add(ic.intime, INTERVAL 4 HOUR) THEN 1 ELSE 0 END) as exclude_medications\n",
        "          FROM `physionet-data.mimic_hosp.emar` he\n",
        "          INNER JOIN `physionet-data.mimic_icu.icustays` ic\n",
        "              ON he.subject_id = ic.subject_id\n",
        "          WHERE he.subject_id IN ({id_str}) AND medication IN (\"Amiodarone\", \"Diltiazem\", \"Diltiazem Extended-Release\", \n",
        "                                                              \"Metoprolol Tartrate\", \"Metoprolol Succinate XL\")\n",
        "          GROUP BY ic.stay_id) md\n",
        "    ON ie.stay_id = md.stay_id\n",
        "\n",
        "WHERE ie.subject_id IN ({id_str})\n",
        "''')\n",
        "# note \"inplace\" -> this argument tells the dataframe to be modified in-place\n",
        "# i.e., we don't need to do df = df.sort_values(), we can just call the function as-is\n",
        "# be careful with inplace! if you do:\n",
        "#   df = df.sort_values(inplace=True), it will set `df` to None\n",
        "# ... because you're using it wrong (either re-assign the variable, or use the inplace arg, but not both!)\n",
        "df.sort_values('subject_id', inplace=True)\n",
        "display(df)"
      ],
      "metadata": {
        "id": "gU3e2hgZF5qR",
        "outputId": "98c195eb-4a86-4856-a12f-84b136eb1806",
        "colab": {
          "base_uri": "https://localhost:8080/",
          "height": 396
        }
      },
      "execution_count": null,
      "outputs": [
        {
          "output_type": "display_data",
          "data": {
            "text/plain": [
              "   subject_id   hadm_id   stay_id  exclude_non_adult  exclude_short_stays  \\\n",
              "7    10000032  29079034  39553978                  0                    0   \n",
              "2    10001884  26184834  37510196                  0                    0   \n",
              "1    10002223  22494570  39638202                  0                    0   \n",
              "0    10002443  21329021  35044219                  0                    0   \n",
              "8    10002495  24982426  36753294                  0                    0   \n",
              "4    10003400  20214994  32128372                  0                    0   \n",
              "5    10003400  23559586  34577403                  0                    0   \n",
              "6    10003400  23559586  38383343                  0                    0   \n",
              "3    10005866  20364112  34170353                  0                    0   \n",
              "\n",
              "   exclude_readmission  exclude_other_hospitals  exclude_first_heart_rate  \\\n",
              "7                    0                        0                         0   \n",
              "2                    0                        0                         0   \n",
              "1                    0                        0                         0   \n",
              "0                    0                        1                         0   \n",
              "8                    0                        1                         1   \n",
              "4                    0                        0                         1   \n",
              "5                    1                        1                         0   \n",
              "6                    1                        1                         0   \n",
              "3                    0                        0                         0   \n",
              "\n",
              "   exclude_first_heart_rhythm  exclude_chronic  exclude_troponin  \\\n",
              "7                           0                0                 0   \n",
              "2                           0                0                 1   \n",
              "1                           0                0                 0   \n",
              "0                           0                0                 0   \n",
              "8                           0                0                 1   \n",
              "4                           1                1                 0   \n",
              "5                           1                1                 0   \n",
              "6                           1                1                 0   \n",
              "3                           0                0                 0   \n",
              "\n",
              "   exclude_medications  \n",
              "7                    0  \n",
              "2                    1  \n",
              "1                    0  \n",
              "0                    0  \n",
              "8                    0  \n",
              "4                    0  \n",
              "5                    0  \n",
              "6                    1  \n",
              "3                    0  "
            ],
            "text/html": [
              "\n",
              "  <div id=\"df-46d23c33-8b01-4e69-a0b2-47982d94e6d7\">\n",
              "    <div class=\"colab-df-container\">\n",
              "      <div>\n",
              "<style scoped>\n",
              "    .dataframe tbody tr th:only-of-type {\n",
              "        vertical-align: middle;\n",
              "    }\n",
              "\n",
              "    .dataframe tbody tr th {\n",
              "        vertical-align: top;\n",
              "    }\n",
              "\n",
              "    .dataframe thead th {\n",
              "        text-align: right;\n",
              "    }\n",
              "</style>\n",
              "<table border=\"1\" class=\"dataframe\">\n",
              "  <thead>\n",
              "    <tr style=\"text-align: right;\">\n",
              "      <th></th>\n",
              "      <th>subject_id</th>\n",
              "      <th>hadm_id</th>\n",
              "      <th>stay_id</th>\n",
              "      <th>exclude_non_adult</th>\n",
              "      <th>exclude_short_stays</th>\n",
              "      <th>exclude_readmission</th>\n",
              "      <th>exclude_other_hospitals</th>\n",
              "      <th>exclude_first_heart_rate</th>\n",
              "      <th>exclude_first_heart_rhythm</th>\n",
              "      <th>exclude_chronic</th>\n",
              "      <th>exclude_troponin</th>\n",
              "      <th>exclude_medications</th>\n",
              "    </tr>\n",
              "  </thead>\n",
              "  <tbody>\n",
              "    <tr>\n",
              "      <th>7</th>\n",
              "      <td>10000032</td>\n",
              "      <td>29079034</td>\n",
              "      <td>39553978</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>2</th>\n",
              "      <td>10001884</td>\n",
              "      <td>26184834</td>\n",
              "      <td>37510196</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>1</td>\n",
              "      <td>1</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>1</th>\n",
              "      <td>10002223</td>\n",
              "      <td>22494570</td>\n",
              "      <td>39638202</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>0</th>\n",
              "      <td>10002443</td>\n",
              "      <td>21329021</td>\n",
              "      <td>35044219</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>1</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>8</th>\n",
              "      <td>10002495</td>\n",
              "      <td>24982426</td>\n",
              "      <td>36753294</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>1</td>\n",
              "      <td>1</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>1</td>\n",
              "      <td>0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>4</th>\n",
              "      <td>10003400</td>\n",
              "      <td>20214994</td>\n",
              "      <td>32128372</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>1</td>\n",
              "      <td>1</td>\n",
              "      <td>1</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>5</th>\n",
              "      <td>10003400</td>\n",
              "      <td>23559586</td>\n",
              "      <td>34577403</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>1</td>\n",
              "      <td>1</td>\n",
              "      <td>0</td>\n",
              "      <td>1</td>\n",
              "      <td>1</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>6</th>\n",
              "      <td>10003400</td>\n",
              "      <td>23559586</td>\n",
              "      <td>38383343</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>1</td>\n",
              "      <td>1</td>\n",
              "      <td>0</td>\n",
              "      <td>1</td>\n",
              "      <td>1</td>\n",
              "      <td>0</td>\n",
              "      <td>1</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>3</th>\n",
              "      <td>10005866</td>\n",
              "      <td>20364112</td>\n",
              "      <td>34170353</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "    </tr>\n",
              "  </tbody>\n",
              "</table>\n",
              "</div>\n",
              "      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-46d23c33-8b01-4e69-a0b2-47982d94e6d7')\"\n",
              "              title=\"Convert this dataframe to an interactive table.\"\n",
              "              style=\"display:none;\">\n",
              "        \n",
              "  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n",
              "       width=\"24px\">\n",
              "    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n",
              "    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n",
              "  </svg>\n",
              "      </button>\n",
              "      \n",
              "  <style>\n",
              "    .colab-df-container {\n",
              "      display:flex;\n",
              "      flex-wrap:wrap;\n",
              "      gap: 12px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert {\n",
              "      background-color: #E8F0FE;\n",
              "      border: none;\n",
              "      border-radius: 50%;\n",
              "      cursor: pointer;\n",
              "      display: none;\n",
              "      fill: #1967D2;\n",
              "      height: 32px;\n",
              "      padding: 0 0 0 0;\n",
              "      width: 32px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert:hover {\n",
              "      background-color: #E2EBFA;\n",
              "      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n",
              "      fill: #174EA6;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert {\n",
              "      background-color: #3B4455;\n",
              "      fill: #D2E3FC;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert:hover {\n",
              "      background-color: #434B5C;\n",
              "      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n",
              "      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n",
              "      fill: #FFFFFF;\n",
              "    }\n",
              "  </style>\n",
              "\n",
              "      <script>\n",
              "        const buttonEl =\n",
              "          document.querySelector('#df-46d23c33-8b01-4e69-a0b2-47982d94e6d7 button.colab-df-convert');\n",
              "        buttonEl.style.display =\n",
              "          google.colab.kernel.accessAllowed ? 'block' : 'none';\n",
              "\n",
              "        async function convertToInteractive(key) {\n",
              "          const element = document.querySelector('#df-46d23c33-8b01-4e69-a0b2-47982d94e6d7');\n",
              "          const dataTable =\n",
              "            await google.colab.kernel.invokeFunction('convertToInteractive',\n",
              "                                                     [key], {});\n",
              "          if (!dataTable) return;\n",
              "\n",
              "          const docLinkHtml = 'Like what you see? Visit the ' +\n",
              "            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n",
              "            + ' to learn more about interactive tables.';\n",
              "          element.innerHTML = '';\n",
              "          dataTable['output_type'] = 'display_data';\n",
              "          await google.colab.output.renderOutput(dataTable, element);\n",
              "          const docLink = document.createElement('div');\n",
              "          docLink.innerHTML = docLinkHtml;\n",
              "          element.appendChild(docLink);\n",
              "        }\n",
              "      </script>\n",
              "    </div>\n",
              "  </div>\n",
              "  "
            ]
          },
          "metadata": {}
        }
      ]
    },
    {
      "cell_type": "markdown",
      "source": [
        "Done! Congrats :)\n",
        "\n",
        "You just reproduced the cohort from this paper: https://www.sciencedirect.com/science/article/pii/S0883944121002525\n",
        "\n",
        "This will be a key piece of the future reproduction project."
      ],
      "metadata": {
        "id": "IRLaLLCIL7sF"
      }
    }
  ],
  "metadata": {
    "kernelspec": {
      "display_name": "Python 3",
      "name": "python3"
    },
    "language_info": {
      "name": "python"
    },
    "colab": {
      "name": "Copy of data-extraction-assignment.ipynb",
      "provenance": [],
      "collapsed_sections": [],
      "include_colab_link": true
    }
  },
  "nbformat": 4,
  "nbformat_minor": 0
}